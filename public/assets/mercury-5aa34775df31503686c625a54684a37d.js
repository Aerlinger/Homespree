window.Mercury={config:{toolbars:{primary:{save:["Save","Save this page"],preview:["Preview","Preview this page",{toggle:!0,mode:!0}],sep1:" ",undoredo:{undo:["Undo","Undo your last action"],redo:["Redo","Redo your last action"],sep:" "},insertLink:["Link","Insert Link",{modal:"/mercury/modals/link.html",regions:["full","markdown"]}],insertMedia:["Media","Insert Media (images and videos)",{modal:"/mercury/modals/media.html",regions:["full","markdown"]}],insertTable:["Table","Insert Table",{modal:"/mercury/modals/table.html",regions:["full","markdown"]}],insertCharacter:["Character","Special Characters",{modal:"/mercury/modals/character.html",regions:["full","markdown"]}],snippetPanel:["Snippet","Snippet Panel",{panel:"/mercury/panels/snippets.html"}],sep2:" ",historyPanel:["History","Page Version History",{panel:"/mercury/panels/history.html"}],sep3:" ",notesPanel:["Notes","Page Notes",{panel:"/mercury/panels/notes.html"}]},editable:{_regions:["full","markdown"],predefined:{style:["Style",null,{select:"/mercury/selects/style.html",preload:!0}],sep1:" ",formatblock:["Block Format",null,{select:"/mercury/selects/formatblock.html",preload:!0}],sep2:"-"},colors:{backColor:["Background Color",null,{palette:"/mercury/palettes/backcolor.html",context:!0,preload:!0,regions:["full"]}],sep1:" ",foreColor:["Text Color",null,{palette:"/mercury/palettes/forecolor.html",context:!0,preload:!0,regions:["full"]}],sep2:"-"},decoration:{bold:["Bold",null,{context:!0}],italic:["Italicize",null,{context:!0}],overline:["Overline",null,{context:!0,regions:["full"]}],strikethrough:["Strikethrough",null,{context:!0,regions:["full"]}],underline:["Underline",null,{context:!0,regions:["full"]}],sep:"-"},script:{subscript:["Subscript",null,{context:!0}],superscript:["Superscript",null,{context:!0}],sep:"-"},justify:{justifyLeft:["Align Left",null,{context:!0,regions:["full"]}],justifyCenter:["Center",null,{context:!0,regions:["full"]}],justifyRight:["Align Right",null,{context:!0,regions:["full"]}],justifyFull:["Justify Full",null,{context:!0,regions:["full"]}],sep:"-"},list:{insertUnorderedList:["Unordered List",null,{context:!0}],insertOrderedList:["Numbered List",null,{context:!0}],sep:"-"},indent:{outdent:["Decrease Indentation"],indent:["Increase Indentation"],sep:"-"},table:{_context:!0,insertRowBefore:["Insert Table Row","Insert a table row before the cursor",{regions:["full"]}],insertRowAfter:["Insert Table Row","Insert a table row after the cursor",{regions:["full"]}],deleteRow:["Delete Table Row","Delete this table row",{regions:["full"]}],insertColumnBefore:["Insert Table Column","Insert a table column before the cursor",{regions:["full"]}],insertColumnAfter:["Insert Table Column","Insert a table column after the cursor",{regions:["full"]}],deleteColumn:["Delete Table Column","Delete this table column",{regions:["full"]}],sep1:" ",increaseColspan:["Increase Cell Columns","Increase the cells colspan"],decreaseColspan:["Decrease Cell Columns","Decrease the cells colspan and add a new cell"],increaseRowspan:["Increase Cell Rows","Increase the cells rowspan"],decreaseRowspan:["Decrease Cell Rows","Decrease the cells rowspan and add a new cell"],sep2:"-"},rules:{horizontalRule:["Horizontal Rule","Insert a horizontal rule"],sep1:"-"},formatting:{removeFormatting:["Remove Formatting","Remove formatting for the selection",{regions:["full"]}],sep2:" "},editors:{htmlEditor:["Edit HTML","Edit the HTML content",{regions:["full"]}]}},snippets:{_custom:!0,actions:{editSnippet:["Edit Snippet Settings"],sep1:" ",removeSnippet:["Remove Snippet"]}}},regions:{attribute:"data-mercury",identifier:"id",dataAttributes:[]},snippets:{method:"POST",optionsUrl:"/mercury/snippets/:name/options.html",previewUrl:"/mercury/snippets/:name/preview.html"},uploading:{enabled:!0,allowedMimeTypes:["image/jpeg","image/gif","image/png"],maxFileSize:1235242880,inputName:"image[image]",url:"/mercury/images",handler:!1},localization:{enabled:!1,preferredLocale:"swedish_chef-BORK"},behaviors:{htmlEditor:function(){Mercury.modal("/mercury/modals/htmleditor.html",{title:"HTML Editor",fullHeight:!0,handler:"htmlEditor"})}},globalBehaviors:{exit:function(){window.location.href=this.iframeSrc()},barrelRoll:function(){$("body").css({webkitTransform:"rotate(360deg)"})}},csrfSelector:'meta[name="csrf-token"]',csrfHeader:"X-CSRF-Token",editorUrlRegEx:/([http|https]:\/\/.[^\/]*)\/editor\/?(.*)/i,nonHijackableClasses:[],pasting:{sanitize:"whitelist",whitelist:{h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],table:[],thead:[],tbody:[],tfoot:[],tr:[],th:["colspan","rowspan"],td:["colspan","rowspan"],div:["class"],span:["class"],ul:[],ol:[],li:[],b:[],strong:[],i:[],em:[],u:[],strike:[],br:[],p:[],hr:[],a:["href","target","title","name"],img:["src","title","alt"]}},injectedStyles:'[data-mercury]       { min-height: 10px; outline: 1px dotted #09F } [data-mercury]:focus { outline: none; -webkit-box-shadow: 0 0 10px #09F, 0 0 1px #045; box-shadow: 0 0 10px #09F, 0 0 1px #045 }[data-mercury].focus { outline: none; -webkit-box-shadow: 0 0 10px #09F, 0 0 1px #045; box-shadow: 0 0 10px #09F, 0 0 1px #045 }[data-mercury]:after { content: "."; display: block; visibility: hidden; clear: both; height: 0; overflow: hidden; }[data-mercury] table { border: 1px dotted red; min-width: 6px; }[data-mercury] th    { border: 1px dotted red; min-width: 6px; }[data-mercury] td    { border: 1px dotted red; min-width: 6px; }[data-mercury] .mercury-textarea       { border: 0; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; resize: none; }[data-mercury] .mercury-textarea:focus { outline: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; }'},silent:!1,debug:!1},/*!
 * jQuery UI 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
function(e,t){function i(t,i){var s=t.nodeName.toLowerCase();return"area"===s?(i=t.parentNode,s=i.name,t.href&&s&&"map"===i.nodeName.toLowerCase()?(t=e("img[usemap=#"+s+"]")[0],!!t&&n(t)):!1):(/input|select|textarea|button|object/.test(s)?!t.disabled:"a"==s?t.href||i:i)&&n(t)}function n(t){return!e(t).parents().andSelf().filter(function(){return"hidden"===e.curCSS(this,"visibility")||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.8.13",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,i){return"number"==typeof t?this.each(function(){var n=this;setTimeout(function(){e(n).focus(),i&&i.call(n)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length){i=e(this[0]);for(var n;i.length&&i[0]!==document;){if(n=i.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(n=parseInt(i.css("zIndex"),10),!isNaN(n)&&0!==n))return n;i=i.parent()}}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.each(["Width","Height"],function(i,n){function s(t,i,n,s){return e.each(o,function(){i-=parseFloat(e.curCSS(t,"padding"+this,!0))||0,n&&(i-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0),s&&(i-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)}),i}var o="Width"===n?["Left","Right"]:["Top","Bottom"],r=n.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?a["inner"+n].call(this):this.each(function(){e(this).css(r,s(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?a["outer"+n].call(this,t):this.each(function(){e(this).css(r,s(this,t,!0,i)+"px")})}}),e.extend(e.expr[":"],{data:function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),s=isNaN(n);return(s||n>=0)&&i(t,!s)}}),e(function(){var t=document.body,i=t.appendChild(i=document.createElement("div"));e.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=100===i.offsetHeight,e.support.selectstart="onselectstart"in i,t.removeChild(i).style.display="none"}),e.extend(e.ui,{plugin:{add:function(t,i,n){t=e.ui[t].prototype;for(var s in n)t.plugins[s]=t.plugins[s]||[],t.plugins[s].push([i,n[s]])},call:function(e,t,i){if((t=e.plugins[t])&&e.element[0].parentNode)for(var n=0;n<t.length;n++)e.options[t[n][0]]&&t[n][1].apply(e.element,i)}},contains:function(e,t){return document.compareDocumentPosition?16&e.compareDocumentPosition(t):e!==t&&e.contains(t)},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;i=i&&"left"===i?"scrollLeft":"scrollTop";var n=!1;return t[i]>0?!0:(t[i]=1,n=t[i]>0,t[i]=0,n)},isOverAxis:function(e,t,i){return e>t&&t+i>e},isOver:function(t,i,n,s,o,r){return e.ui.isOverAxis(t,n,o)&&e.ui.isOverAxis(i,s,r)}}))}(jQuery),/*!
 * jQuery UI Widget 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
function(e,t){if(e.cleanData){var i=e.cleanData;e.cleanData=function(t){for(var n,s=0;null!=(n=t[s]);s++)e(n).triggerHandler("remove");i(t)}}else{var n=e.fn.remove;e.fn.remove=function(t,i){return this.each(function(){return i||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){e(this).triggerHandler("remove")}),n.call(e(this),t,i)})}}e.widget=function(t,i,n){var s,o=t.split(".")[0];t=t.split(".")[1],s=o+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][s]=function(i){return!!e.data(i,t)},e[o]=e[o]||{},e[o][t]=function(e,t){arguments.length&&this._createWidget(e,t)},i=new i,i.options=e.extend(!0,{},i.options),e[o][t].prototype=e.extend(!0,i,{namespace:o,widgetName:t,widgetEventPrefix:e[o][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},n),e.widget.bridge(t,e[o][t])},e.widget.bridge=function(i,n){e.fn[i]=function(s){var o="string"==typeof s,r=Array.prototype.slice.call(arguments,1),a=this;return s=!o&&r.length?e.extend.apply(null,[!0,s].concat(r)):s,o&&"_"===s.charAt(0)?a:(o?this.each(function(){var n=e.data(this,i),o=n&&e.isFunction(n[s])?n[s].apply(n,r):n;return o!==n&&o!==t?(a=o,!1):void 0}):this.each(function(){var t=e.data(this,i);t?t.option(s||{})._init():e.data(this,i,new n(s,this))}),a)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,i){e.data(i,this.widgetName,this),this.element=e(i),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var n=this;this.element.bind("remove."+this.widgetName,function(){n.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(i,n){var s=i;if(0===arguments.length)return e.extend({},this.options);if("string"==typeof i){if(n===t)return this.options[i];s={},s[i]=n}return this._setOptions(s),this},_setOptions:function(t){var i=this;return e.each(t,function(e,t){i._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,i,n){var s=this.options[t];if(i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n=n||{},i.originalEvent){t=e.event.props.length;for(var o;t;)o=e.event.props[--t],i[o]=i.originalEvent[o]}return this.element.trigger(i,n),!(e.isFunction(s)&&s.call(this.element[0],i,n)===!1||i.isDefaultPrevented())}}}(jQuery),/*!
 * jQuery UI Mouse 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
function(e){var t=!1;e(document).mousedown(function(){t=!1}),e.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(i){if(e(this.document||document).mousedown(function(){t=!1}),!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,s=1==i.which,o="string"==typeof this.options.cancel?e(i.target).parents().add(i.target).filter(this.options.cancel).length:!1;return s&&!o&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(this.document||document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return!e.browser.msie||(this.document||document).documentMode>=9||t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(this.document||document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target==this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),/*
 * jQuery UI Draggable 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Draggables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(e){e.widget("ui.draggable",e.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){return this.element.data("draggable")?(this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this):void 0},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(t,!0),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){if(i=this._uiHash(),this._trigger("drag",t,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1;if(e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),!(this.element[0]&&this.element[0].parentNode||"original"!=this.options.helper))return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var n=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return this.options.iframeFix===!0&&e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=this.options.handle&&e(this.options.handle,this.element).length?!1:!0;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var i=this.options;return t=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element,t.parents("body").length||t.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),t[0]!=this.element[0]&&!/(fixed|absolute)/.test(t.css("position"))&&t.css("position","absolute"),t},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=[("document"==t.containment?0:e(window).scrollLeft())-this.offset.relative.left-this.offset.parent.left,("document"==t.containment?0:e(window).scrollTop())-this.offset.relative.top-this.offset.parent.top,("document"==t.containment?0:e(window).scrollLeft())+e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==t.containment?0:e(window).scrollTop())+(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);else{t=e(t.containment);var i=t[0];if(i){t.offset();var n="hidden"!=e(i).css("overflow");this.containment=[(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0),(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0),(n?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(n?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=t}}},_convertPositionTo:function(t,i){i||(i=this.position),t="absolute"==t?1:-1;var n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*t+this.offset.parent.top*t-(e.browser.safari&&e.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop())*t),left:i.left+this.offset.relative.left*t+this.offset.parent.left*t-(e.browser.safari&&e.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())*t)}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName),o=t.pageX,r=t.pageY;if(this.originalPosition){var a;this.containment&&(this.relative_container?(a=this.relative_container.offset(),a=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]):a=this.containment,t.pageX-this.offset.click.left<a[0]&&(o=a[0]+this.offset.click.left),t.pageY-this.offset.click.top<a[1]&&(r=a[1]+this.offset.click.top),t.pageX-this.offset.click.left>a[2]&&(o=a[2]+this.offset.click.left),t.pageY-this.offset.click.top>a[3]&&(r=a[3]+this.offset.click.top)),i.grid&&(r=this.originalPageY+Math.round((r-this.originalPageY)/i.grid[1])*i.grid[1],r=a?r-this.offset.click.top<a[1]||r-this.offset.click.top>a[3]?r-this.offset.click.top<a[1]?r+i.grid[1]:r-i.grid[1]:r:r,o=this.originalPageX+Math.round((o-this.originalPageX)/i.grid[0])*i.grid[0],o=a?o-this.offset.click.left<a[0]||o-this.offset.click.left>a[2]?o-this.offset.click.left<a[0]?o+i.grid[0]:o-i.grid[0]:o:o)}return{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&e.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&e.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"==t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.extend(e.ui.draggable,{version:"1.8.13"}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("draggable"),s=n.options,o=e.extend({},i,{item:n.element});n.sortables=[],e(s.connectToSortable).each(function(){var i=e.data(this,"sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,o))})},stop:function(t,i){var n=e(this).data("draggable"),s=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"==n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,s))})},drag:function(t,i){var n=e(this).data("draggable"),s=this;e.each(n.sortables,function(){this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(s).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){t=e(i.helper),i=e(this).data("draggable").options,t.css("opacity")&&(i._opacity=t.css("opacity")),t.css("opacity",i.opacity)},stop:function(t,i){t=e(this).data("draggable").options,t._opacity&&e(i.helper).css("opacity",t._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");t.scrollParent[0]!=document&&"HTML"!=t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("draggable"),n=i.options,s=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(n.axis&&"x"==n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"==n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"==n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"==n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),s!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){for(var n=e(this).data("draggable"),s=n.options,o=s.snapTolerance,r=i.offset.left,a=r+n.helperProportions.width,l=i.offset.top,c=l+n.helperProportions.height,u=n.snapElements.length-1;u>=0;u--){var h=n.snapElements[u].left,d=h+n.snapElements[u].width,p=n.snapElements[u].top,f=p+n.snapElements[u].height;if(r>h-o&&d+o>r&&l>p-o&&f+o>l||r>h-o&&d+o>r&&c>p-o&&f+o>c||a>h-o&&d+o>a&&l>p-o&&f+o>l||a>h-o&&d+o>a&&c>p-o&&f+o>c){if("inner"!=s.snapMode){var m=Math.abs(p-c)<=o,g=Math.abs(f-l)<=o,v=Math.abs(h-a)<=o,y=Math.abs(d-r)<=o;m&&(i.position.top=n._convertPositionTo("relative",{top:p-n.helperProportions.height,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d}).left-n.margins.left)}var b=m||g||v||y;"outer"!=s.snapMode&&(m=Math.abs(p-l)<=o,g=Math.abs(f-c)<=o,v=Math.abs(h-r)<=o,y=Math.abs(d-a)<=o,m&&(i.position.top=n._convertPositionTo("relative",{top:p,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f-n.helperProportions.height,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d-n.helperProportions.width}).left-n.margins.left)),!n.snapElements[u].snapping&&(m||g||v||y||b)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[u].item})),n.snapElements[u].snapping=m||g||v||y||b}else n.snapElements[u].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[u].item})),n.snapElements[u].snapping=!1}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options;if(t=e.makeArray(e(t.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)}),t.length){var i=parseInt(t[0].style.zIndex)||0;e(t).each(function(e){this.style.zIndex=i+e}),this[0].style.zIndex=i+t.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){t=e(i.helper),i=e(this).data("draggable").options,t.css("zIndex")&&(i._zIndex=t.css("zIndex")),t.css("zIndex",i.zIndex)},stop:function(t,i){t=e(this).data("draggable").options,t._zIndex&&e(i.helper).css("zIndex",t._zIndex)}})}(jQuery),/*
 * jQuery UI Sortable 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Sortables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(e){e.widget("ui.sortable",e.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.document=e.document,this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData("sortable-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget()[i?"addClass":"removeClass"]("ui-sortable-disabled")):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(t);var n=null,s=this;if(e(t.target).parents().each(function(){return e.data(this,"sortable-item")==s?(n=e(this),!1):void 0}),e.data(t.target,"sortable-item")==s&&(n=e(t.target)),!n)return!1;if(this.options.handle&&!i){var o=!1;if(e(this.options.handle,n).find("*").andSelf().each(function(){this==t.target&&(o=!0)}),!o)return!1}return this.currentItem=n,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,i,n){var s=this.options,o=this;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",s.cursor)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!=(this.document||document)&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(var r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,o._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,n=!1;this.scrollParent[0]!=(this.document||document)&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-e(this.document||document).scrollTop()<i.scrollSensitivity?n=e(this.document||document).scrollTop(e(this.document||document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(this.document||document).scrollTop())<i.scrollSensitivity&&(n=e(this.document||document).scrollTop(e(this.document||document).scrollTop()+i.scrollSpeed)),t.pageX-e(this.document||document).scrollLeft()<i.scrollSensitivity?n=e(this.document||document).scrollLeft(e(this.document||document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(this.document||document).scrollLeft())<i.scrollSensitivity&&(n=e(this.document||document).scrollLeft(e(this.document||document).scrollLeft()+i.scrollSpeed))),n!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var s=this.items.length-1;s>=0;s--){var o=this.items[s],r=o.item[0],a=this._intersectsWithPointer(o);if(a&&r!=this.currentItem[0]&&this.placeholder[1==a?"next":"prev"]()[0]!=r&&!e.ui.contains(this.placeholder[0],r)&&("semi-dynamic"==this.options.type?!e.ui.contains(this.element[0],r):!0)){if(this.direction=1==a?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(o))break;this._rearrange(t,o),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,s=n.placeholder.offset();n.reverting=!0,e(this.helper).animate({left:s.left-this.offset.parent.left-n.margins.left+(this.offsetParent[0]==(this.document||document).body?0:this.offsetParent[0].scrollLeft),top:s.top-this.offset.parent.top-n.margins.top+(this.offsetParent[0]==(this.document||document).body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){var t=this;if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("deactivate",null,t._uiHash(this)),this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",null,t._uiHash(this)),this.containers[i].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,s=n+this.helperProportions.height,o=e.left,r=o+e.width,a=e.top,l=a+e.height,c=this.offset.click.top,u=this.offset.click.left,h=n+c>a&&l>n+c&&t+u>o&&r>t+u;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?h:o<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<r&&a<n+this.helperProportions.height/2&&s-this.helperProportions.height/2<l},_intersectsWithPointer:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),s=i&&n,o=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return s?this.floating?r&&"right"==r||"down"==o?2:1:o&&("down"==o?2:1):!1},_intersectsWithSides:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"==o&&n||"left"==o&&!n:s&&("down"==s&&i||"up"==s&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i=[],n=[],s=this._connectWith();if(s&&t)for(var o=s.length-1;o>=0;o--)for(var r=e(s[o]),a=r.length-1;a>=0;a--){var l=e.data(r[a],"sortable");l&&l!=this&&!l.options.disabled&&n.push([e.isFunction(l.options.items)?l.options.items.call(l.element):e(l.options.items,l.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),l])}n.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var o=n.length-1;o>=0;o--)n[o][0].each(function(){i.push(this)});return e(i)},_removeCurrentsFromItems:function(){for(var e=this.currentItem.find(":data(sortable-item)"),t=0;t<this.items.length;t++)for(var i=0;i<e.length;i++)e[i]==this.items[t].item[0]&&this.items.splice(t,1)},_refreshItems:function(t){this.items=[],this.containers=[this];var i=this.items,n=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],s=this._connectWith();if(s)for(var o=s.length-1;o>=0;o--)for(var r=e(s[o]),a=r.length-1;a>=0;a--){var l=e.data(r[a],"sortable");l&&l!=this&&!l.options.disabled&&(n.push([e.isFunction(l.options.items)?l.options.items.call(l.element[0],t,{item:this.currentItem}):e(l.options.items,l.element),l]),this.containers.push(l))}for(var o=n.length-1;o>=0;o--)for(var c=n[o][1],u=n[o][0],a=0,h=u.length;h>a;a++){var d=e(u[a]);d.data("sortable-item",c),i.push({item:d,instance:c,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var n=this.items[i];if(n.instance==this.currentContainer||!this.currentContainer||n.item[0]==this.currentItem[0]){var s=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item;t||(n.width=s.outerWidth(),n.height=s.outerHeight());var o=s.offset();n.left=o.left,n.top=o.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var o=this.containers[i].element.offset();this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(t){var i=t||this,n=i.options;if(!n.placeholder||n.placeholder.constructor==String){var s=n.placeholder;n.placeholder={element:function(){var t=e((this.document||document).createElement(i.currentItem[0].nodeName)).addClass(s||i.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return s||(t.style.visibility="hidden"),t},update:function(e,t){(!s||n.forcePlaceholderSize)&&(t.height()||t.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10)),t.width()||t.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10)))}}}i.placeholder=e(n.placeholder.element.call(i.element,i.currentItem)),i.currentItem.after(i.placeholder),n.placeholder.update(i,i.placeholder)},_contactContainers:function(t){for(var i=null,n=null,s=this.containers.length-1;s>=0;s--)if(!e.ui.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(i&&e.ui.contains(this.containers[s].element[0],i.element[0]))continue;i=this.containers[s],n=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",t,this._uiHash(this)),this.containers[s].containerCache.over=0);if(i)if(1===this.containers.length)this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1;else if(this.currentContainer!=this.containers[n]){for(var o=1e4,r=null,a=this.positionAbs[this.containers[n].floating?"left":"top"],l=this.items.length-1;l>=0;l--)if(e.ui.contains(this.containers[n].element[0],this.items[l].item[0])){var c=this.items[l][this.containers[n].floating?"left":"top"];Math.abs(c-a)<o&&(o=Math.abs(c-a),r=this.items[l])}if(!r&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[n],r?this._rearrange(t,r,null,!0):this._rearrange(t,null,this.containers[n].element,!0),this._trigger("change",t,this._uiHash()),this.containers[n]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"==i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(""==n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=(this.document||document)&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==(this.document||document).body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"==t.containment?this.document||document:window).width()-this.helperProportions.width-this.margins.left,(e("document"==t.containment?this.document||document:window).height()||(this.document||document).body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)){var i=e(t.containment)[0],n=e(t.containment).offset(),s="hidden"!=e(i).css("overflow");this.containment=[n.left+(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0)-this.margins.top,n.left+(s?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(s?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,s=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=(this.document||document)&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),o=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-(e.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:s.scrollTop())*n),left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-(e.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*n)}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=(this.document||document)&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=(this.document||document)&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var o=t.pageX,r=t.pageY;if(this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),i.grid)){var a=this.originalPageY+Math.round((r-this.originalPageY)/i.grid[1])*i.grid[1];r=this.containment?a-this.offset.click.top<this.containment[1]||a-this.offset.click.top>this.containment[3]?a-this.offset.click.top<this.containment[1]?a+i.grid[1]:a-i.grid[1]:a:a;var l=this.originalPageX+Math.round((o-this.originalPageX)/i.grid[0])*i.grid[0];o=this.containment?l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2]?l-this.offset.click.left<this.containment[0]?l+i.grid[0]:l-i.grid[0]:l:l}return{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var s=this,o=this.counter;window.setTimeout(function(){o==s.counter&&s.refreshPositions(!n)},0)},_clear:function(t,i){this.reverting=!1;var n=[];if(!this._noFinalSort&&this.currentItem[0].parentNode&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var s in this._storedCSS)("auto"==this._storedCSS[s]||"static"==this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();if(this.fromOutside&&!i&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||i||n.push(function(e){this._trigger("update",e,this._uiHash())}),!e.ui.contains(this.element[0],this.currentItem[0])){i||n.push(function(e){this._trigger("remove",e,this._uiHash())});for(var s=this.containers.length-1;s>=0;s--)e.ui.contains(this.containers[s].element[0],this.currentItem[0])&&!i&&(n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.containers[s])),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.containers[s])))}for(var s=this.containers.length-1;s>=0;s--)i||n.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[s])),this.containers[s].containerCache.over=0);if(this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){this._trigger("beforeStop",t,this._uiHash());for(var s=0;s<n.length;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return!1}if(i||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(var s=0;s<n.length;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.extend(e.ui.sortable,{version:"1.8.13"})}(jQuery),!function(e){e.serializeObject=function(t){var i={},n=i,s=t;return e.each(s,function(){for(var e=this.name.replace(/\[([^\]]+)?\]/g,",$1").split(","),t=e.length-1,s=0;t>s;s++)n.push?(n[n.length-1]&&n[n.length-1].constructor===Object&&void 0===n[n.length-1][e[s+1]]||n.push({}),n=n[n.length-1]):n=n[e[s]]=n[e[s]]||(""==e[s+1]?[]:{});n.push?n.push(this.value):n[e[t]]=this.value,n=i}),i},e.deserializeObject=function i(e,t,n){var s,o,r,a;if(t=t||[],"[object Object]"===Object.prototype.toString.call(e)){for(s in e)if(r=n?[n,"[",s,"]"].join(""):s,e.hasOwnProperty(s))if(a=Object.prototype.toString.call(e[s]),"[object Array]"===a)for(o=0,jsonLen=e[s].length;jsonLen>o;o++)i(e[s][o],t,r+"[]");else"[object Object]"===a?i(e[s],t,r):t.push({name:r,value:e[s]})}else t.push({name:n,value:e});return t};var t=function(){var t=!!e.fn.prop;return function(e,i){t?e.prop("checked",i):e.attr("checked",i?"checked":null)}}();e.applySerializedArray=function(i,n){var s,o=e(i).find("input,select,textarea");t(o.filter(":checked"),!1);for(var r=n.length;r--;)s=o.filter("[name='"+n[r].name+"']"),s.filter(":checkbox").length?s.val()==n[r].value&&t(s.filter(":checkbox"),!0):s.filter(":radio").length?t(s.filter("[value='"+n[r].value+"']"),!0):s.val(n[r].value)},e.applySerializedObject=function(t,i){e.applySerializedArray(t,e.deserializeObject(i))},e.fn.serializeObject=e.fn.serializeObject||function(){return e.serializeObject(this.serializeArray())},e.fn.applySerializedObject=function(t){return e.applySerializedObject(this,t),this},e.fn.applySerializedArray=function(t){return e.applySerializedArray(this,t),this}}(jQuery),/*
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built in easing capabilities added In jQuery 1.1 to offer multiple easing options
 *
 * TERMS OF USE - jQuery Easing
 *
 * Open source under the BSD License.
 *
 * Copyright © 2008 George McGinley Smith
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
 * following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
 * disclaimer.  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
 * the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * Neither the name of the author nor the names of contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
 * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
jQuery.extend(jQuery.easing,{easeInSine:function(e,t,i,n,s){return-n*Math.cos(t/s*(Math.PI/2))+n+i},easeOutSine:function(e,t,i,n,s){return n*Math.sin(t/s*(Math.PI/2))+i},easeInOutSine:function(e,t,i,n,s){return-n/2*(Math.cos(Math.PI*t/s)-1)+i}}),/*
 * jQuery JSON Plugin version: 2.1 (2009-08-14)
 *
 * This document is licensed as free software under the terms of the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Brantley Harris wrote this plugin. It is based somewhat on the JSON.org  website's http://www.json.org/json2.js,
 * which proclaims: "NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.", a sentiment that I uphold.
 *
 * It is also influenced heavily by MochiKit's serializeJSON, which is  copyrighted 2005 by Bob Ippolito.
 */
function(e){e.toJSON=function(t){if("object"==typeof JSON&&JSON.stringify)return JSON.stringify(t);var i=typeof t;if(null===t)return"null";if("undefined"==i)return void 0;if("number"==i||"boolean"==i)return t+"";if("string"==i)return e.quoteString(t);if("object"==i){if("function"==typeof t.toJSON)return e.toJSON(t.toJSON());if(t.constructor===Date){var n=t.getUTCFullYear(),s=t.getUTCMonth()+1;10>s&&(s="0"+s);var o=t.getUTCDate();10>o&&(o="0"+o);var r=t.getUTCHours();10>r&&(r="0"+r);var a=t.getUTCMinutes();10>a&&(a="0"+a);var l=t.getUTCSeconds();10>l&&(l="0"+l);var c=t.getUTCMilliseconds();return 100>c&&(c="0"+c),10>c&&(c="0"+c),'"'+n+"-"+s+"-"+o+"T"+r+":"+a+":"+l+"."+c+'Z"'}if(t.constructor===Array){for(var u=[],h=0;h<t.length;h++)u.push(e.toJSON(t[h])||"null");return"["+u.join(",")+"]"}var d=[];for(var p in t){var f;if(i=typeof p,"number"==i)f='"'+p+'"';else{if("string"!=i)continue;f=e.quoteString(p)}if("function"!=typeof t[p]){var m=e.toJSON(t[p]);d.push(f+":"+m)}}return"{"+d.join(", ")+"}"}},e.quoteString=function(e){return e.match(t)?'"'+e.replace(t,function(e){var t=i[e];return"string"==typeof t?t:(t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))})+'"':'"'+e+'"'};var t=/["\\\x00-\x1f\x7f-\x9f]/g,i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}}(jQuery),/*
 * jQuery Localizer Plugin
 *
 * Copyright (c) 2011 Sagi Mann (with a basic reworking by Jeremy Jackson)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms are permitted provided that the above copyright notice and this
 * paragraph are duplicated in all such forms and that any documentation, advertising materials, and other materials
 * related to such distribution and use acknowledge that the software was developed by the <organization>.  The name of
 * the University may not be used to endorse or promote products derived from this software without specific prior
 * written permission.
 *
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
 */
function(e){e.fn.localize=function(t){this.find("*").contents().each(function(){var i=!1,n="";return"string"==typeof this.data&&(n=e.trim(this.data),n&&(i=t.sub[n]||t.top[n])&&(this.data=i)),"IMG"==this.nodeName&&this.attributes.src&&(n=this.attributes.src.nodeValue,n&&(i=t.sub[n]||t.top[n])&&e(this).attr("src",i)),"A"==this.nodeName&&this.attributes.href&&(n=e.trim(this.attributes.href.nodeValue),n&&(i=t.sub[n]||t.top[n])&&e(this).attr("href",i)),"INPUT"==this.nodeName&&this.attributes.type&&this.attributes.value&&["submit","reset","button"].indexOf(this.attributes.type.nodeValue.toLowerCase())>-1&&(n=e.trim(this.attributes.value.nodeValue),n&&(i=t.sub[n]||t.top[n])&&e(this).attr("value",i)),this})}}(jQuery),function(e){function t(e,t,i,n){if(!e.tag.isInline&&i.length>0){i.push("\n");for(var s=0;n>s;s++)i.push("	")}}function i(n,s){var o=[],r=0==n.attributes.length,h=0,p=null,f=n.tag.render&&(0==s.allowedTags.length||e.inArray(n.tag.name,s.allowedTags)>-1)&&(0==s.removeTags.length||-1==e.inArray(n.tag.name,s.removeTags));if(!n.isRoot&&f&&(o.push("<"),o.push(n.tag.name),e.each(n.attributes,function(){if(-1==e.inArray(this.name,s.removeAttrs)){var t=new RegExp(/^(['"]?)(.*?)['"]?$/).exec(this.value),i=t[2],r=t[1]||"'";"class"==this.name&&(i=e.grep(i.split(" "),function(t){return e.grep(s.allowedClasses,function(i){return i[0]==t&&(1==i.length||e.inArray(n.tag.name,i[1])>-1)}).length>0}).join(" "),r="'"),null!=i&&(i.length>0||e.inArray(this.name,n.tag.requiredAttributes)>-1)&&(o.push(" "),o.push(this.name),o.push("="),o.push(r),o.push(i),o.push(r))}})),n.tag.isSelfClosing)f&&o.push(" />"),r=!1;else if(n.tag.isNonClosing)r=!1;else{if(!n.isRoot&&f&&o.push(">"),h=s.formatIndent++,n.tag.toProtect)p=e.htmlClean.trim(n.children.join("")).replace(/<br>/gi,"\n"),o.push(p),r=0==p.length,s.formatIndent--;else{p=[];for(var m=0;m<n.children.length;m++){var g=n.children[m],v=e.htmlClean.trim(d(c(g)?g:g.childrenToString()));u(g)&&m>0&&v.length>0&&(a(g)||l(n.children[m-1]))&&p.push(" "),c(g)?v.length>0&&p.push(v):(m!=n.children.length-1||"br"!=g.tag.name)&&(s.format&&t(g,s,p,h),p=p.concat(i(g,s)))}s.formatIndent--,p.length>0&&(s.format&&"\n"!=p[0]&&t(n,s,o,h),o=o.concat(p),r=!1)}!n.isRoot&&f&&(s.format&&t(n,s,o,h-1),o.push("</"),o.push(n.tag.name),o.push(">"))}return!n.tag.allowEmpty&&r?[]:o}function n(t,i,s){return s=s||1,e.inArray(t[t.length-s].tag.name,i)>-1?!0:t.length-(s+1)>0&&n(t,i,s+1)?(t.pop(),!0):!1}function s(e){return e?(this.tag=e,this.isRoot=!1):(this.tag=new r("root"),this.isRoot=!0),this.attributes=[],this.children=[],this.hasAttribute=function(e){for(var t=0;t<this.attributes.length;t++)if(this.attributes[t].name==e)return!0;return!1},this.childrenToString=function(){return this.children.join("")},this}function o(e,t){return this.name=e,this.value=t,this}function r(t,i,n,s){return this.name=t.toLowerCase(),this.isSelfClosing=e.inArray(this.name,y)>-1,this.isNonClosing=e.inArray(this.name,b)>-1,this.isClosing=void 0!=i&&i.length>0,this.isInline=e.inArray(this.name,p)>-1,this.disallowNest=e.inArray(this.name,f)>-1,this.requiredParent=g[e.inArray(this.name,g)+1],this.allowEmpty=e.inArray(this.name,m)>-1,this.toProtect=e.inArray(this.name,v)>-1,this.rawAttributes=n,this.allowedAttributes=w[e.inArray(this.name,w)+1],this.requiredAttributes=_[e.inArray(this.name,_)+1],this.render=s&&-1==e.inArray(this.name,s.notRenderedTags),this}function a(t){for(;h(t)&&t.children.length>0;)t=t.children[0];return c(t)&&t.length>0&&e.htmlClean.isWhitespace(t.charAt(0))}function l(t){for(;h(t)&&t.children.length>0;)t=t.children[t.children.length-1];return c(t)&&t.length>0&&e.htmlClean.isWhitespace(t.charAt(t.length-1))}function c(e){return e.constructor==String}function u(e){return c(e)||e.tag.isInline}function h(e){return e.constructor==s}function d(e){return e.replace(/&nbsp;|\n/g," ").replace(/\s\s+/g," ")}e.fn.htmlClean=function(t){return this.each(function(){this.value?this.value=e.htmlClean(this.value,t):this.innerHTML=e.htmlClean(this.innerHTML,t)})},e.htmlClean=function(t,a){a=e.extend({},e.htmlClean.defaults,a);var l,u=/<(\/)?(\w+:)?([\w]+)([^>]*)>/gi,h=/(\w+)=(".*?"|'.*?'|[^\s>]*)/gi,d=new s,p=[d],f=d;a.bodyOnly&&(l=/<body[^>]*>((\n|.)*)<\/body>/i.exec(t))&&(t=l[1]),t=t.concat("<xxx>");for(var m;l=u.exec(t);){var g=new r(l[3],l[1],l[4],a),v=t.substring(m,l.index);if(v.length>0){var y=f.children[f.children.length-1];f.children.length>0&&c(y=f.children[f.children.length-1])?f.children[f.children.length-1]=y.concat(v):f.children.push(v)}if(m=u.lastIndex,g.isClosing)n(p,[g.name])&&(p.pop(),f=p[p.length-1]);else{for(var b,w=new s(g);b=h.exec(g.rawAttributes);){if("style"==b[1].toLowerCase()&&a.replaceStyles)for(var _=!g.isInline,x=0;x<a.replaceStyles.length;x++)a.replaceStyles[x][0].test(b[2])&&(_||(g.render=!1,_=!0),f.children.push(w),p.push(w),f=w,g=new r(a.replaceStyles[x][1],"","",a),w=new s(g));null!=g.allowedAttributes&&(0==g.allowedAttributes.length||e.inArray(b[1],g.allowedAttributes)>-1)&&w.attributes.push(new o(b[1],b[2]))}e.each(g.requiredAttributes,function(){var e=this.toString();w.hasAttribute(e)||w.attributes.push(new o(e,""))});for(var C=0;C<a.replace.length;C++)for(var k=0;k<a.replace[C][0].length;k++){var T="string"==typeof a.replace[C][0][k];if(T&&a.replace[C][0][k]==g.name||!T&&a.replace[C][0][k].test(l)){g.render=!1,f.children.push(w),p.push(w),f=w,g=new r(a.replace[C][1],l[1],l[4],a),w=new s(g),w.attributes=f.attributes,C=a.replace.length;break}}var E=!0;if(f.isRoot||(f.tag.isInline&&!g.isInline?E=!1:f.tag.disallowNest&&g.disallowNest&&!g.requiredParent?E=!1:g.requiredParent&&(E=n(p,g.requiredParent))&&(f=p[p.length-1])),E)if(f.children.push(w),g.toProtect)for(var S=null;S=u.exec(t);){var D=new r(S[3],S[1],S[4],a);if(D.isClosing&&D.name==g.name){w.children.push(RegExp.leftContext.substring(m)),m=u.lastIndex;break}}else g.isSelfClosing||g.isNonClosing||(p.push(w),f=w)}}return i(d,a).join("")},e.htmlClean.defaults={bodyOnly:!0,allowedTags:[],removeTags:["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"],removeAttrs:[],allowedClasses:[],notRenderedTags:[],format:!1,formatIndent:0,replace:[[["b","big"],"strong"],[["i"],"em"]],replaceStyles:[[/font-weight:\s*bold/i,"strong"],[/font-style:\s*italic/i,"em"],[/vertical-align:\s*super/i,"sup"],[/vertical-align:\s*sub/i,"sub"]]},e.htmlClean.trim=function(t){return e.htmlClean.trimStart(e.htmlClean.trimEnd(t))},e.htmlClean.trimStart=function(t){return t.substring(e.htmlClean.trimStartIndex(t))},e.htmlClean.trimStartIndex=function(t){for(var i=0;i<t.length-1&&e.htmlClean.isWhitespace(t.charAt(i));i++);return i},e.htmlClean.trimEnd=function(t){return t.substring(0,e.htmlClean.trimEndIndex(t))},e.htmlClean.trimEndIndex=function(t){for(var i=t.length-1;i>=0&&e.htmlClean.isWhitespace(t.charAt(i));i--);return i+1},e.htmlClean.isWhitespace=function(t){return-1!=e.inArray(t,x)};var p=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","samp","select","small","span","strong","sub","sup","tt","var"],f=["h1","h2","h3","h4","h5","h6","p","th","td"],m=["th","td"],g=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",["table"],"tfoot",["table"]],v=["script","style","pre","code"],y=["br","hr","img","link","meta"],b=["!doctype","?xml"],w=[["class"],"?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],"form",["accept","action","class","enctype","method","name"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme"],"map",["name"],"optgroup",["class","disabled","label"],"option",["class","disabled","label","selected","value"],"q",["class","cite"],"td",["colspan","rowspan"],"th",["colspan","rowspan"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"style",["type"],"table",["class","summary"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"]],_=[[],"img",["alt"]],x=[" "," ","	","\n","\r","\f"]}(jQuery);/*
 * LiquidMetal, version: 0.1 (2009-02-05)
 *
 * A mimetic poly-alloy of Quicksilver's scoring algorithm, essentially
 * LiquidMetal.
 *
 * For usage and examples, visit:
 * http://github.com/rmm5t/liquidmetal
 *
 * Licensed under the MIT:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Copyright (c) 2009, Ryan McGeary (ryanonjavascript -[at]- mcgeary [*dot*] org)
 */
var LiquidMetal=function(){function e(e,t){var i=e.charAt(t);return i>="A"&&"Z">=i}function t(e,t){var i=e.charAt(t-1);return" "==i||"	"==i}function i(e,t,i,n){i=Math.max(i||0,0),n=Math.min(n||e.length,e.length);for(var s=i;n>s;s++)e[s]=t;return e}var n=0,s=1,o=.8,r=.9,a=.85;return{score:function(e,t){if(0==t.length)return o;if(t.length>e.length)return n;for(var i=this.buildScoreArray(e,t),s=0,r=0;r<i.length;r++)s+=i[r];return s/i.length},buildScoreArray:function(l,c){for(var u=new Array(l.length),h=l.toLowerCase(),d=c.toLowerCase().split(""),p=-1,f=!1,m=0;m<d.length;m++){var g=d[m],v=h.indexOf(g,p+1);if(0>v)return i(u,n);0==v&&(f=!0),t(l,v)?(u[v-1]=1,i(u,a,p+1,v-1)):e(l,v)?i(u,a,p+1,v):i(u,n,p+1,v),u[v]=s,p=v}var y=f?r:o;return i(u,y,p+1),u}}}(),Showdown={};Showdown.converter=function(){var e,t,i,n=0;this.makeHtml=function(n){return e=new Array,t=new Array,i=new Array,n=n.replace(/~/g,"~T"),n=n.replace(/\$/g,"~D"),n=n.replace(/\r\n/g,"\n"),n=n.replace(/\r/g,"\n"),n="\n\n"+n+"\n\n",n=P(n),n=n.replace(/^[ \t]+$/gm,""),n=a(n),n=r(n),n=c(n),n=A(n),n=n.replace(/~D/g,"$$"),n=n.replace(/~T/g,"~"),n=n.replace(/https?\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!]/g,function(e,t){var i=n.slice(0,t),s=n.slice(t);if(i.match(/<[^>]+$/)&&s.match(/^[^>]*>/))return e;var o=e.replace(/^http:\/\/github.com\//,"https://github.com/");return"<a href='"+o+"'>"+e+"</a>"}),n=n.replace(/[a-z0-9_\-+=.]+@[a-z0-9\-]+(\.[a-z0-9-]+)+/gi,function(e){return"<a href='mailto:"+e+"'>"+e+"</a>"}),n=n.replace(/[a-f0-9]{40}/gi,function(e,t){if("undefined"==typeof GitHub||"undefined"==typeof GitHub.nameWithOwner)return e;var i=n.slice(0,t),s=n.slice(t);return i.match(/@$/)||i.match(/<[^>]+$/)&&s.match(/^[^>]*>/)?e:"<a href='http://github.com/"+GitHub.nameWithOwner+"/commit/"+e+"'>"+e.substring(0,7)+"</a>"}),n=n.replace(/([a-z0-9_\-+=.]+)@([a-f0-9]{40})/gi,function(e,t,i,s){if("undefined"==typeof GitHub||"undefined"==typeof GitHub.nameWithOwner)return e;GitHub.repoName=GitHub.repoName||o();var r=n.slice(0,s),a=n.slice(s);return r.match(/\/$/)||r.match(/<[^>]+$/)&&a.match(/^[^>]*>/)?e:"<a href='http://github.com/"+t+"/"+GitHub.repoName+"/commit/"+i+"'>"+t+"@"+i.substring(0,7)+"</a>"}),n=n.replace(/([a-z0-9_\-+=.]+\/[a-z0-9_\-+=.]+)@([a-f0-9]{40})/gi,function(e,t,i){return"<a href='http://github.com/"+t+"/commit/"+i+"'>"+t+"@"+i.substring(0,7)+"</a>"}),n=n.replace(/#([0-9]+)/gi,function(e,t,i){if("undefined"==typeof GitHub||"undefined"==typeof GitHub.nameWithOwner)return e;var s=n.slice(0,i),o=n.slice(i);return""==s||s.match(/[a-z0-9_\-+=.]$/)||s.match(/<[^>]+$/)&&o.match(/^[^>]*>/)?e:"<a href='http://github.com/"+GitHub.nameWithOwner+"/issues/#issue/"+t+"'>"+e+"</a>"}),n=n.replace(/([a-z0-9_\-+=.]+)#([0-9]+)/gi,function(e,t,i,s){if("undefined"==typeof GitHub||"undefined"==typeof GitHub.nameWithOwner)return e;GitHub.repoName=GitHub.repoName||o();var r=n.slice(0,s),a=n.slice(s);return r.match(/\/$/)||r.match(/<[^>]+$/)&&a.match(/^[^>]*>/)?e:"<a href='http://github.com/"+t+"/"+GitHub.repoName+"/issues/#issue/"+i+"'>"+e+"</a>"}),n=n.replace(/([a-z0-9_\-+=.]+\/[a-z0-9_\-+=.]+)#([0-9]+)/gi,function(e,t,i){return"<a href='http://github.com/"+t+"/issues/#issue/"+i+"'>"+e+"</a>"})};var s,o=function(){return GitHub.nameWithOwner.match(/^.+\/(.+)$/)[1]},r=function(i){var i=i.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(i,n,s,o,r){return n=n.toLowerCase(),e[n]=T(s),o?o+r:(r&&(t[n]=r.replace(/"/g,"&quot;")),"")});return i},a=function(e){return e=e.replace(/\n/g,"\n\n"),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,l),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,l),e=e.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,l),e=e.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,l),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,l),e=e.replace(/\n\n/g,"\n")},l=function(e,t){var n=t;return n=n.replace(/\n\n/g,"\n"),n=n.replace(/^\n/,""),n=n.replace(/\n+$/g,""),n="\n\n~K"+(i.push(n)-1)+"K\n\n"},c=function(e){e=g(e);var t=b("<hr />");return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,t),e=v(e),e=y(e),e=C(e),e=a(e),e=k(e)},u=function(e){return e=w(e),e=h(e),e=E(e),e=f(e),e=d(e),e=S(e),e=T(e),e=x(e),e=e.replace(/  +\n/g," <br />\n")},h=function(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=M(t,"\\`*_")})},d=function(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,p)},p=function(i,n,s,o,r,a,l,c){void 0==c&&(c="");var u=n,h=s,d=o.toLowerCase(),p=r,f=c;if(""==p)if(""==d&&(d=h.toLowerCase().replace(/ ?\n/g," ")),p="#"+d,void 0!=e[d])p=e[d],void 0!=t[d]&&(f=t[d]);else{if(!(u.search(/\(\s*\)$/m)>-1))return u;p=""}p=M(p,"*_");var m='<a href="'+p+'"';return""!=f&&(f=f.replace(/"/g,"&quot;"),f=M(f,"*_"),m+=' title="'+f+'"'),m+=">"+h+"</a>"},f=function(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,m),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,m)},m=function(i,n,s,o,r,a,l,c){var u=n,h=s,d=o.toLowerCase(),p=r,f=c;if(f||(f=""),""==p){if(""==d&&(d=h.toLowerCase().replace(/ ?\n/g," ")),p="#"+d,void 0==e[d])return u;p=e[d],void 0!=t[d]&&(f=t[d])}h=h.replace(/"/g,"&quot;"),p=M(p,"*_");var m='<img src="'+p+'" alt="'+h+'"';return f=f.replace(/"/g,"&quot;"),f=M(f,"*_"),m+=' title="'+f+'"',m+=" />"},g=function(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return b("<h1>"+u(t)+"</h1>")}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return b("<h2>"+u(t)+"</h2>")}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,i){var n=t.length;return b("<h"+n+">"+u(i)+"</h"+n+">")})},v=function(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return n?e=e.replace(t,function(e,t,i){var n=t,o=i.search(/[*+-]/g)>-1?"ul":"ol";n=n.replace(/\n{2,}/g,"\n\n\n");var r=s(n);return r=r.replace(/\s+$/,""),r="<"+o+">"+r+"</"+o+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,i,n){var o=t,r=i,a=n.search(/[*+-]/g)>-1?"ul":"ol",r=r.replace(/\n{2,}/g,"\n\n\n"),l=s(r);return l=o+"<"+a+">\n"+l+"</"+a+">\n"})),e=e.replace(/~0/,"")};s=function(e){return n++,e=e.replace(/\n{2,}$/,"\n"),e+="~0",e=e.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(e,t,i,n,s){var o=s,r=t;return r||o.search(/\n{2,}/)>-1?o=c(I(o)):(o=v(I(o)),o=o.replace(/\n$/,""),o=u(o)),"<li>"+o+"</li>\n"}),e=e.replace(/~0/g,""),n--,e};var y=function(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,i){var n=t,s=i;return n=_(I(n)),n=P(n),n=n.replace(/^\n+/g,""),n=n.replace(/\n+$/g,""),n="<pre><code>"+n+"\n</code></pre>",b(n)+s}),e=e.replace(/~0/,"")},b=function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(i.push(e)-1)+"K\n\n"},w=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,i,n){var s=n;return s=s.replace(/^([ \t]*)/g,""),s=s.replace(/[ \t]*$/g,""),s=_(s),t+"<code>"+s+"</code>"})},_=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=M(e,"*_{}[]\\",!1)},x=function(e){return e=e.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\w)_(\w)/g,"$1~E95E$2"),e=e.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},C=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var i=t;return i=i.replace(/^[ \t]*>[ \t]?/gm,"~0"),i=i.replace(/~0/g,""),i=i.replace(/^[ \t]+$/gm,""),i=c(i),i=i.replace(/(^|\n)/g,"$1  "),i=i.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var i=t;return i=i.replace(/^  /gm,"~0"),i=i.replace(/~0/g,"")}),b("<blockquote>\n"+i+"\n</blockquote>")})},k=function(e){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var t=e.split(/\n{2,}/g),n=new Array,s=t.length,o=0;s>o;o++){var r=t[o];r.search(/~K(\d+)K/g)>=0?n.push(r):r.search(/\S/)>=0&&(r=u(r),r=r.replace(/\n/g,"<br />"),r=r.replace(/^([ \t]*)/g,"<p>"),r+="</p>",n.push(r))}s=n.length;for(var o=0;s>o;o++)for(;n[o].search(/~K(\d+)K/)>=0;){var a=i[RegExp.$1];a=a.replace(/\$/g,"$$$$"),n[o]=n[o].replace(/~K\d+K/,a)}return n.join("\n\n")},T=function(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},E=function(e){return e=e.replace(/\\(\\)/g,F),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,F)},S=function(e){return e=e.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),e=e.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(e,t){return D(A(t))})},D=function(e){function t(e){var t="0123456789ABCDEF",i=e.charCodeAt(0);return t.charAt(i>>4)+t.charAt(15&i)}var i=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+t(e)+";"},function(e){return e}];return e="mailto:"+e,e=e.replace(/./g,function(e){if("@"==e)e=i[Math.floor(2*Math.random())](e);else if(":"!=e){var t=Math.random();e=t>.9?i[2](e):t>.45?i[1](e):i[0](e)}return e}),e='<a href="'+e+'">'+e+"</a>",e=e.replace(/">.+:/g,'">')},A=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var i=parseInt(t);return String.fromCharCode(i)})},I=function(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")},P=function(e){return e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"~A~B"),e=e.replace(/~B(.+?)~A/g,function(e,t){for(var i=t,n=4-i.length%4,s=0;n>s;s++)i+=" ";return i}),e=e.replace(/~A/g,"    "),e=e.replace(/~B/g,"")},M=function(e,t,i){var n="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";i&&(n="\\\\"+n);var s=new RegExp(n,"g");return e=e.replace(s,F)},F=function(e,t){var i=t.charCodeAt(0);return"~E"+i+"E"}},function(){var e=[].slice;this.Mercury||(this.Mercury={}),jQuery.extend(this.Mercury,{version:"0.9.0",Regions:Mercury.Regions||{},modalHandlers:Mercury.modalHandlers||{},lightviewHandlers:Mercury.lightviewHandlers||{},dialogHandlers:Mercury.dialogHandlers||{},preloadedViews:Mercury.preloadedViews||{},ajaxHeaders:function(){var e;return e={},e[Mercury.config.csrfHeader]=Mercury.csrfToken,e},on:function(e,t){return jQuery(window).on("mercury:"+e,t)},off:function(e,t){return jQuery(window).off("mercury:"+e,t)},one:function(e,t){return jQuery(window).one("mercury:"+e,t)},trigger:function(e,t){return Mercury.log(e,t),jQuery(window).trigger("mercury:"+e,t)},notify:function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],window.alert(Mercury.I18n.apply(this,t))},warn:function(e,t){var i,n;if(null==t&&(t=0),console)try{return console.warn(e)}catch(s){if(i=s,t>=1)try{return console.debug(e)}catch(s){n=s}}else if(t>=1)return Mercury.notify(e)},deprecated:function(e){return console&&console.trace&&(e=""+e+" -- "+console.trace()),Mercury.warn("deprecated: "+e,1)},log:function(){var e;if(Mercury.debug&&console){if("hide:toolbar"===arguments[0]||"show:toolbar"===arguments[0])return;try{return console.debug(arguments)}catch(t){e=t}}},locale:function(){var e,t,i;return Mercury.determinedLocale?Mercury.determinedLocale:(Mercury.config.localization.enabled&&(e=[],navigator.language&&(e=navigator.language.toString().split("-")).length&&(i=Mercury.I18n[e[0]]||{},t=e.length>1?i["_"+e[1].toUpperCase()+"_"]:void 0),Mercury.I18n[e[0]]||(e=Mercury.config.localization.preferredLocale.split("-"),i=Mercury.I18n[e[0]]||{},t=e.length>1?i["_"+e[1].toUpperCase()+"_"]:void 0)),Mercury.determinedLocale={top:i||{},sub:t||{}})},I18n:function(){var t,i,n,s;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],i=Mercury.locale(),s=(i.sub[n]||i.top[n]||n||"").toString(),t.length?s.printf.apply(s,t):s}})}.call(this),function(){String.prototype.titleize=function(){return this[0].toUpperCase()+this.slice(1)},String.prototype.toHex=function(){return"#"===this[0]?this:this.replace(/rgb(a)?\(([0-9|%]+)[\s|,]?\s?([0-9|%]+)[\s|,]?\s?([0-9|%]+)[\s|,]?\s?([0-9|.|%]+\s?)?\)/gi,function(e,t,i,n,s){return"#"+parseInt(i).toHex()+parseInt(n).toHex()+parseInt(s).toHex()})},String.prototype.regExpEscape=function(){var e,t;return t=["/",".","*","+","?","|","(",")","[","]","{","}","\\"],e=new RegExp("(\\"+t.join("|\\")+")","g"),this.replace(e,"\\$1")},String.prototype.printf=function(){var e,t,i,n,s,o,r,a,l,c;for(i=this.split("%"),a=i[0],r=/^([sdf])([\s\S%]*)$/,s=0,n=l=0,c=i.length;c>l;n=++l)if(t=i[n],o=r.exec(t),0!==n&&o&&null!==arguments[n]){switch(e=arguments[n-1-s],o[1]){case"s":a+=e;break;case"d":case"i":a+=parseInt(e.toString(),10);break;case"f":a+=parseFloat(e)}a+=o[2]}else n>1&&(s+=2,a+="%"+t);return a},Number.prototype.toHex=function(){var e;return e=this.toString(16).toUpperCase(),e[1]?e:"0"+e},Number.prototype.toBytes=function(){var e,t;for(e=parseInt(this),t=0;e>1023;)e/=1024,t+=1;return t?""+e.toFixed(2)+[""," kb"," Mb"," Gb"," Tb"," Pb"," Eb"][t]:""+e+" bytes"}}.call(this),function(){this.Mercury.PageEditor=function(){function e(e,t){var i;if(this.saveUrl=null!=e?e:null,this.options=null!=t?t:{},window.mercuryInstance)throw Mercury.I18n("Mercury.PageEditor can only be instantiated once.");this.options.visible!==!1&&"false"!==this.options.visible&&(this.options.visible=!0),this.visible=this.options.visible,this.options.saveDataType===!1||this.options.saveDataType||(this.options.saveDataType="json"),window.mercuryInstance=this,this.regions=[],this.initializeInterface(),(i=jQuery(Mercury.config.csrfSelector).attr("content"))&&(Mercury.csrfToken=i)}return e.prototype.initializeInterface=function(){var e,t,i=this;return this.focusableElement=jQuery("<input>",{"class":"mercury-focusable",type:"text"}).appendTo(null!=(e=this.options.appendTo)?e:"body"),this.iframe=jQuery("<iframe>",{id:"mercury_iframe","class":"mercury-iframe",frameborder:"0",src:"about:blank"}),this.iframe.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body"),this.toolbar=new Mercury.Toolbar(jQuery.extend(!0,{},this.options,this.options.toolbarOptions)),this.statusbar=new Mercury.Statusbar(jQuery.extend(!0,{},this.options,this.options.statusbarOptions)),this.resize(),this.iframe.one("load",function(){return i.bindEvents()}),this.iframe.on("load",function(){return i.initializeFrame()}),this.loadIframeSrc(null)},e.prototype.initializeFrame=function(){var e,t;try{if(this.iframe.data("loaded"))return;return this.iframe.data("loaded",!0),this.document=jQuery(this.iframe.get(0).contentWindow.document),jQuery('<style mercury-styles="true">').html(Mercury.config.injectedStyles).appendTo(this.document.find("head")),t=this.iframe.get(0).contentWindow,jQuery.globalEval=function(e){return e&&/\S/.test(e)?(t.execScript||function(e){return t.eval.call(t,e)})(e):void 0},t.Mercury=Mercury,window.History&&History.Adapter&&(t.History=History),this.bindDocumentEvents(),this.resize(),this.initializeRegions(),this.finalizeInterface(),Mercury.trigger("ready"),t.jQuery&&t.jQuery(t).trigger("mercury:ready"),t.Event&&t.Event.fire&&t.Event.fire(t,"mercury:ready"),t.onMercuryReady&&t.onMercuryReady(),this.iframe.css({visibility:"visible"})}catch(i){return e=i,Mercury.notify("Mercury.PageEditor failed to load: %s\n\nPlease try refreshing.",e)}},e.prototype.initializeRegions=function(){var e,t,i,n,s,o,r,a;for(this.regions=[],o=jQuery("["+Mercury.config.regions.attribute+"]",this.document),t=0,n=o.length;n>t;t++)e=o[t],this.buildRegion(jQuery(e));if(this.visible){for(r=this.regions,a=[],i=0,s=r.length;s>i;i++){if(e=r[i],e.focus){e.focus();break}a.push(void 0)}return a}},e.prototype.buildRegion=function(e){var t,i;if(e.data("region"))e=e.data("region");else{if(t=(e.attr(Mercury.config.regions.attribute)||("function"==typeof(i=Mercury.config.regions).determineType?i.determineType(e):void 0)||"unknown").titleize(),"Unknown"===t||!Mercury.Regions[t])throw Mercury.I18n('Region type is malformed, no data-type provided, or "%s" is unknown for the "%s" region.',t,e.attr("id")||"unknown");if(!Mercury.Regions[t].supported)return Mercury.notify("Mercury.Regions.%s is unsupported in this client. Supported browsers are %s.",t,Mercury.Regions[t].supportedText),!1;e=new Mercury.Regions[t](e,this.iframe.get(0).contentWindow),this.previewing&&e.togglePreview()}return this.regions.push(e)},e.prototype.finalizeInterface=function(){var e;return this.santizerElement=jQuery("<div>",{id:"mercury_sanitizer",contenteditable:"true",style:"position:fixed;width:100px;height:100px;min-width:0;top:0;left:-100px;opacity:0;overflow:hidden"}),this.santizerElement.appendTo(null!=(e=this.options.appendTo)?e:this.document.find("body")),this.snippetToolbar&&this.snippetToolbar.release(),this.snippetToolbar=new Mercury.SnippetToolbar(this.document),this.hijackLinksAndForms(),this.visible?void 0:Mercury.trigger("mode",{mode:"preview"})},e.prototype.bindDocumentEvents=function(){return this.document.on("mousedown",function(e){return Mercury.trigger("hide:dialogs"),Mercury.region&&jQuery(e.target).closest("["+Mercury.config.regions.attribute+"]").get(0)!==Mercury.region.element.get(0)?Mercury.trigger("unfocus:regions"):void 0}),jQuery(this.document).bind("keydown",function(e){return e.ctrlKey||e.metaKey?83===e.keyCode?(Mercury.trigger("action",{action:"save"}),e.preventDefault()):void 0:void 0})},e.prototype.bindEvents=function(){var e=this;return Mercury.on("initialize:frame",function(){return setTimeout(e.initializeFrame,100)}),Mercury.on("focus:frame",function(){return e.iframe.focus()}),Mercury.on("focus:window",function(){return setTimeout(function(){return e.focusableElement.focus()},10)}),Mercury.on("toggle:interface",function(){return e.toggleInterface()}),Mercury.on("reinitialize",function(){return e.initializeRegions()}),Mercury.on("mode",function(t,i){return"preview"===i.mode?e.previewing=!e.previewing:void 0}),Mercury.on("action",function(t,i){var n;return n=Mercury.config.globalBehaviors[i.action]||e[i.action],"function"==typeof n?(t.preventDefault(),n.call(e,i)):void 0}),jQuery(window).on("resize",function(){return e.resize()}),jQuery(window).bind("keydown",function(e){return e.ctrlKey||e.metaKey?83===e.keyCode?(Mercury.trigger("action",{action:"save"}),e.preventDefault()):void 0:void 0}),window.onbeforeunload=this.beforeUnload},e.prototype.toggleInterface=function(){var e=this;return this.visible?(this.visible=!1,this.toolbar.hide(),this.statusbar.hide(),this.previewing||Mercury.trigger("mode",{mode:"preview"}),this.previewing=!0,this.resize()):(this.visible=!0,this.iframe.animate({top:this.toolbar.height(!0)},200,"easeInOutSine",function(){return e.resize()}),this.toolbar.show(),this.statusbar.show(),Mercury.trigger("mode",{mode:"preview"}),this.previewing=!1)},e.prototype.resize=function(){var e,t,i;return i=jQuery(window).width(),e=this.statusbar.top(),t=this.toolbar.top()+this.toolbar.height(),Mercury.displayRect={top:t,left:0,width:i,height:e-t,fullHeight:e},this.iframe.css({top:t,left:0,height:e-t}),Mercury.trigger("resize")},e.prototype.iframeSrc=function(e,t){var i,n;return null==e&&(e=null),null==t&&(t=!1),e=(null!=e?e:window.location.href).replace(null!=(n=(i=Mercury.config).editorUrlRegEx)?n:i.editorUrlRegEx=/([http|https]:\/\/.[^\/]*)\/editor\/?(.*)/i,"$1/$2"),e=e.replace(/[\?|\&]mercury_frame=true/gi,""),e=e.replace(/\&_=\d+/gi,""),t?""+e+(e.indexOf("?")>-1?"&":"?")+"mercury_frame=true&_="+(new Date).getTime():e},e.prototype.loadIframeSrc=function(e){return this.document&&this.document.off(),this.iframe.data("loaded",!1),this.iframe.get(0).contentWindow.document.location.href=this.iframeSrc(e,!0)},e.prototype.hijackLinksAndForms=function(){var e,t,i,n,s,o,r,a,l,c;for(a=jQuery("a, form",this.document),c=[],n=0,o=a.length;o>n;n++){for(t=a[n],i=!1,l=Mercury.config.nonHijackableClasses||[],s=0,r=l.length;r>s;s++)e=l[s],jQuery(t).hasClass(e)&&(i=!0);i||""!==t.target&&"_self"!==t.target||jQuery(t).closest("["+Mercury.config.regions.attribute+"]").length?c.push(void 0):c.push(jQuery(t).attr("target","_parent"))}return c},e.prototype.beforeUnload=function(){return Mercury.changes&&!Mercury.silent?Mercury.I18n("You have unsaved changes.  Are you sure you want to leave without saving them first?"):null},e.prototype.getRegionByName=function(e){var t,i,n,s;for(s=this.regions,i=0,n=s.length;n>i;i++)if(t=s[i],t.name===e)return t;return null},e.prototype.save=function(e){var t,i,n,s,o,r;return s=null!=(o=null!=(r=this.saveUrl)?r:Mercury.saveUrl)?o:this.iframeSrc(),t=this.serialize(),t={content:t},"POST"===this.options.saveMethod?i="POST":(i="PUT",t._method=i),Mercury.log("saving",t),n={headers:Mercury.ajaxHeaders(),type:i,dataType:this.options.saveDataType,data:t,success:function(t){return Mercury.changes=!1,Mercury.trigger("saved",t),"function"==typeof e?e():void 0},error:function(e){return Mercury.trigger("save_failed",e),Mercury.notify("Mercury was unable to save to the url: %s",s)}},"form"!==this.options.saveStyle&&(n.data=jQuery.toJSON(t),n.contentType="application/json"),jQuery.ajax(s,n)},e.prototype.serialize=function(){var e,t,i,n,s;for(t={},s=this.regions,i=0,n=s.length;n>i;i++)e=s[i],t[e.name]=e.serialize();return t},e}()}.call(this),function(){this.Mercury.HistoryBuffer=function(){function e(e){this.maxLength=null!=e?e:200,this.index=0,this.stack=[],this.markerRegExp=/<em class="mercury-marker"><\/em>/g}return e.prototype.push=function(e){if("string"===jQuery.type(e)){if(this.stack[this.index]&&this.stack[this.index].replace(this.markerRegExp,"")===e.replace(this.markerRegExp,""))return}else if("object"===jQuery.type(e)&&e.html&&this.stack[this.index]&&this.stack[this.index].html===e.html)return;return this.stack=this.stack.slice(0,this.index+1),this.stack.push(e),this.stack.length>this.maxLength&&this.stack.shift(),this.index=this.stack.length-1},e.prototype.undo=function(){return this.index<1?null:(this.index-=1,this.stack[this.index])},e.prototype.redo=function(){return this.index>=this.stack.length-1?null:(this.index+=1,this.stack[this.index])},e}()}.call(this),function(){this.Mercury.tableEditor=function(e,t,i){return Mercury.tableEditor.load(e,t,i),Mercury.tableEditor},jQuery.extend(Mercury.tableEditor,{load:function(e,t,i){return this.table=e,this.cell=t,this.cellContent=null!=i?i:"",this.row=this.cell.parent("tr"),this.columnCount=this.getColumnCount(),this.rowCount=this.getRowCount()},addColumnBefore:function(){return this.addColumn("before")},addColumnAfter:function(){return this.addColumn("after")},addColumn:function(e){var t,i,n,s,o,r,a,l,c,u,h,d;for(null==e&&(e="after"),l=this.cellSignatureFor(this.cell),h=this.table.find("tr"),d=[],t=c=0,u=h.length;u>c;t=++c)r=h[t],a=1,n="after"===e?{right:l.right}:{left:l.left},(s=this.findCellByOptionsFor(r,n))?(o=jQuery("<"+s.cell.get(0).tagName+">").html(this.cellContent),this.setRowspanFor(o,s.height),"before"===e?s.cell.before(o):s.cell.after(o),d.push(t+=s.height-1)):(i=this.findCellByIntersectionFor(r,l))?d.push(this.setColspanFor(i.cell,i.width+1)):d.push(void 0);return d},removeColumn:function(){var e,t,i,n,s,o,r,a,l,c,u,h,d,p,f,m;if(a=this.cellSignatureFor(this.cell),!(a.width>1)){for(o=[],e=[],f=this.table.find("tr"),i=l=0,h=f.length;h>l;i=++l)r=f[i],(s=this.findCellByOptionsFor(r,{left:a.left,width:a.width}))?(o.push(s.cell),i+=s.height-1):(n=this.findCellByIntersectionFor(r,a))&&e.push(n.cell);for(c=0,d=o.length;d>c;c++)t=o[c],jQuery(t).remove();for(m=[],u=0,p=e.length;p>u;u++)t=e[u],m.push(this.setColspanFor(t,this.colspanFor(t)-1));return m}},addRowBefore:function(){return this.addRow("before")},addRowAfter:function(){return this.addRow("after")},addRow:function(e){var t,i,n,s,o,r,a,l,c,u,h,d,p,f,m,g,v;for(null==e&&(e="after"),o=jQuery("<tr>"),(l=this.rowspanFor(this.cell))>1&&"after"===e&&(this.row=jQuery(this.row.nextAll("tr")[l-2])),i=0,m=this.row.find("th, td"),c=0,d=m.length;d>c;c++)t=m[c],n=this.colspanFor(t),s=jQuery("<"+t.tagName+">").html(this.cellContent),this.setColspanFor(s,n),i+=n,(l=this.rowspanFor(t))>1&&"after"===e?this.setRowspanFor(t,l+1):o.append(s);if(i<this.columnCount)for(a=0,g=this.row.prevAll("tr"),u=0,p=g.length;p>u;u++)for(r=g[u],a+=1,v=jQuery(r).find("td[rowspan], th[rowspan]"),h=0,f=v.length;f>h;h++)t=v[h],l=this.rowspanFor(t),l-1>=a&&"before"===e?this.setRowspanFor(t,l+1):l-1>=a&&"after"===e&&(l-1===a?(s=jQuery("<"+t.tagName+">").html(this.cellContent),this.setColspanFor(s,this.colspanFor(t)),o.append(s)):this.setRowspanFor(t,l+1));return"before"===e?this.row.before(o):this.row.after(o)},removeRow:function(){var e,t,i,n,s,o,r,a,l,c,u,h,d,p,f,m,g,v,y,b,w,_,x,C;for(l=!0,o=0,s=0,b=this.row.find("td, th"),u=0,f=b.length;f>u;u++)t=b[u],a=this.rowspanFor(t),o&&a!==o&&(l=!1),(s>a||!s)&&(s=a),o=a;if(l||!(this.rowspanFor(this.cell)>s)){if(s>1)for(i=h=0,w=s-2;w>=0?w>=h:h>=w;i=w>=0?++h:--h)jQuery(this.row.nextAll("tr")[i]).remove();for(_=this.row.find("td[rowspan], th[rowspan]"),d=0,m=_.length;m>d;d++)t=_[d],c=this.cellSignatureFor(t),c.height!==s&&(n=this.findCellByOptionsFor(this.row.nextAll("tr")[s-1],{left:c.left,forceAdjacent:!0}))&&(this.setRowspanFor(t,this.rowspanFor(t)-this.rowspanFor(this.cell)),"before"===n.direction?n.cell.before(jQuery(t).clone()):n.cell.after(jQuery(t).clone()));if(this.columnsFor(this.row.find("td, th"))<this.columnCount)for(r=0,x=this.row.prevAll("tr"),p=0,g=x.length;g>p;p++)for(e=x[p],r+=1,C=jQuery(e).find("td[rowspan], th[rowspan]"),y=0,v=C.length;v>y;y++)t=C[y],a=this.rowspanFor(t),a>r&&this.setRowspanFor(t,a-this.rowspanFor(this.cell));return this.row.remove()}},increaseColspan:function(){var e;return e=this.cell.next("td, th"),!e.length||this.rowspanFor(e)!==this.rowspanFor(this.cell)||this.cellIndexFor(e)>this.cellIndexFor(this.cell)+this.colspanFor(this.cell)?void 0:(this.setColspanFor(this.cell,this.colspanFor(this.cell)+this.colspanFor(e)),e.remove())},decreaseColspan:function(){var e;if(1!==this.colspanFor(this.cell))return this.setColspanFor(this.cell,this.colspanFor(this.cell)-1),e=jQuery("<"+this.cell.get(0).tagName+">").html(this.cellContent),this.setRowspanFor(e,this.rowspanFor(this.cell)),this.cell.after(e)},increaseRowspan:function(){var e,t,i;return i=this.cellSignatureFor(this.cell),t=this.row.nextAll("tr")[i.height-1],t&&(e=this.findCellByOptionsFor(t,{left:i.left,width:i.width}))?(this.setRowspanFor(this.cell,i.height+e.height),e.cell.remove()):void 0},decreaseRowspan:function(){var e,t,i,n;return n=this.cellSignatureFor(this.cell),1!==n.height?(i=this.row.nextAll("tr")[n.height-2],(e=this.findCellByOptionsFor(i,{left:n.left,forceAdjacent:!0}))?(t=jQuery("<"+this.cell.get(0).tagName+">").html(this.cellContent),this.setColspanFor(t,this.colspanFor(this.cell)),this.setRowspanFor(this.cell,n.height-1),"before"===e.direction?e.cell.before(t):e.cell.after(t)):void 0):void 0},getColumnCount:function(){return this.columnsFor(this.table.find("thead tr:first-child, tbody tr:first-child, tfoot tr:first-child").first().find("td, th"))},getRowCount:function(){return this.table.find("tr").length},cellIndexFor:function(e){var t,i,n,s,o,r,a,l,c,u,h,d;if(e=jQuery(e),o=e.parent("tr"),n=this.columnsFor(o.find("td, th")),s=this.columnsFor(e.prevAll("td, th")),n<this.columnCount)for(r=0,h=o.prevAll("tr"),a=0,c=h.length;c>a;a++)for(i=h[a],r+=1,d=jQuery(i).find("td[rowspan], th[rowspan]"),l=0,u=d.length;u>l;l++)t=d[l],this.rowspanFor(t)>r&&this.cellIndexFor(t)<=s&&(s+=this.colspanFor(t));return s},cellSignatureFor:function(e){var t;return t={cell:jQuery(e)},t.left=this.cellIndexFor(e),t.width=this.colspanFor(e),t.height=this.rowspanFor(e),t.right=t.left+t.width,t},findCellByOptionsFor:function(e,t){var i,n,s,o,r,a;for(a=jQuery(e).find("td, th"),o=0,r=a.length;r>o;o++){if(i=a[o],s=this.cellSignatureFor(i),"undefined"!=typeof t.right&&s.right===t.right)return s;if("undefined"!=typeof t.left)if(t.width){if(s.left===t.left&&s.width===t.width)return s}else if(t.forceAdjacent){if(t.forceAdjacent&&s.left>t.left)return n=jQuery(i).prev("td, th"),n.length?(s=this.cellSignatureFor(n),s.direction="after"):s.direction="before",s}else if(s.left===t.left)return s}return t.forceAdjacent?(s.direction="after",s):null},findCellByIntersectionFor:function(e,t){var i,n,s,o,r;for(r=jQuery(e).find("td, th"),s=0,o=r.length;o>s;s++)if(i=r[s],n=this.cellSignatureFor(i),n.right-t.left>=0&&n.right>t.left)return n;return null},columnsFor:function(e){var t,i,n,s;for(i=0,n=0,s=e.length;s>n;n++)t=e[n],i+=this.colspanFor(t);return i},colspanFor:function(e){return parseInt(jQuery(e).attr("colspan"))||1},rowspanFor:function(e){return parseInt(jQuery(e).attr("rowspan"))||1},setColspanFor:function(e,t){return jQuery(e).attr("colspan",t>1?t:null)},setRowspanFor:function(e,t){return jQuery(e).attr("rowspan",t>1?t:null)}})}.call(this),function(){this.Mercury.Dialog=function(){function e(e,t,i){this.url=e,this.name=t,this.options=null!=i?i:{},this.button=this.options["for"],this.build(),this.bindEvents(),this.preload()}return e.prototype.build=function(){var e;return this.element=jQuery("<div>",{"class":"mercury-dialog mercury-"+this.name+"-dialog loading",style:"display:none"}),this.element.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body")},e.prototype.bindEvents=function(){return this.element.on("mousedown",function(e){return e.stopPropagation()})},e.prototype.preload=function(){return this.options.preload?this.load():void 0},e.prototype.toggle=function(){return this.visible?this.hide():this.show()},e.prototype.resize=function(){return this.show()},e.prototype.show=function(){return Mercury.trigger("hide:dialogs",this),this.visible=!0,this.loaded?(this.element.css({width:"auto",height:"auto"}),this.position(this.visible)):this.position(),this.appear()},e.prototype.position=function(){},e.prototype.appear=function(){var e=this;return this.element.css({display:"block",opacity:0}),this.element.animate({opacity:.95},200,"easeInOutSine",function(){return e.loaded?void 0:e.load(function(){return e.resize()})})},e.prototype.hide=function(){return this.element.hide(),this.visible=!1},e.prototype.load=function(e){var t=this;if(this.url)return Mercury.preloadedViews[this.url]?(this.loadContent(Mercury.preloadedViews[this.url]),Mercury.dialogHandlers[this.name]&&Mercury.dialogHandlers[this.name].call(this),e?e():void 0):jQuery.ajax(this.url,{success:function(i){return t.loadContent(i),Mercury.dialogHandlers[t.name]&&Mercury.dialogHandlers[t.name].call(t),e?e():void 0},error:function(){return t.hide(),t.button&&t.button.removeClass("pressed"),Mercury.notify('Mercury was unable to load %s for the "%s" dialog.',t.url,t.name)}})},e.prototype.loadContent=function(e){return this.loaded=!0,this.element.removeClass("loading"),this.element.html(e),Mercury.config.localization.enabled?this.element.localize(Mercury.locale()):void 0},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.Palette=function(e){function i(e,t,n){this.url=e,this.name=t,this.options=null!=n?n:{},i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.build=function(){var e;return this.element=jQuery("<div>",{"class":"mercury-palette mercury-"+this.name+"-palette loading",style:"display:none"}),this.element.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body")},i.prototype.bindEvents=function(){var e=this;return Mercury.on("hide:dialogs",function(t,i){return i!==e?e.hide():void 0}),i.__super__.bindEvents.apply(this,arguments)},i.prototype.position=function(e){var t,i;return this.element.css({top:0,left:0,display:"block",visibility:"hidden"}),t=this.button.position(),i=this.element.width(),t.left+i>jQuery(window).width()&&(t.left=t.left-i+this.button.width()),this.element.css({top:t.top+this.button.height(),left:t.left,display:e?"block":"none",visibility:"visible"})},i}(Mercury.Dialog)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.Select=function(e){function i(e,t,n){this.url=e,this.name=t,this.options=null!=n?n:{},i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.build=function(){var e;return this.element=jQuery("<div>",{"class":"mercury-select mercury-"+this.name+"-select loading",style:"display:none"}),this.element.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body")
},i.prototype.bindEvents=function(){var e=this;return Mercury.on("hide:dialogs",function(t,i){return i!==e?e.hide():void 0}),this.element.on("mousedown",function(e){return e.preventDefault()}),i.__super__.bindEvents.apply(this,arguments)},i.prototype.position=function(e){var t,i,n,s,o,r,a;return this.element.css({top:0,left:0,display:"block",visibility:"hidden"}),r=this.button.position(),n=this.element.width(),i=this.element.height(),t=jQuery(document).height(),a=r.top+this.button.height()/2-i/2,a<r.top-100&&(a=r.top-100),20>a&&(a=20),s=this.loaded?"auto":i,a+i>=t-20&&(s=t-a-20),o=r.left,o+n>jQuery(window).width()&&(o=o-n+this.button.width()),this.element.css({top:a,left:o,height:s,display:e?"block":"none",visibility:"visible"})},i}(Mercury.Dialog)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.Panel=function(e){function i(e,t,n){this.url=e,this.name=t,this.options=null!=n?n:{},i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.build=function(){var e;return this.element=jQuery("<div>",{"class":"mercury-panel loading",style:"display:none;"}),this.titleElement=jQuery("<h1><span>"+Mercury.I18n(this.options.title)+"</span></h1>").appendTo(this.element),this.paneElement=jQuery("<div>",{"class":"mercury-panel-pane"}).appendTo(this.element),this.options.closeButton&&jQuery("<a/>",{"class":"mercury-panel-close"}).appendTo(this.titleElement).css({opacity:0}),this.element.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body")},i.prototype.bindEvents=function(){var e=this;return Mercury.on("resize",function(){return e.position(e.visible)}),Mercury.on("hide:panels",function(t,i){return i!==e?(e.button.removeClass("pressed"),e.hide()):void 0}),this.titleElement.find(".mercury-panel-close").on("click",function(e){return e.preventDefault(),Mercury.trigger("hide:panels")}),this.element.on("mousedown",function(e){return e.stopPropagation()}),this.element.on("ajax:beforeSend",function(t,i,n){return n.success=function(t){return e.loadContent(t),e.resize()}}),i.__super__.bindEvents.apply(this,arguments)},i.prototype.show=function(){return Mercury.trigger("hide:panels",this),i.__super__.show.apply(this,arguments)},i.prototype.resize=function(){var e,t,i,n=this;return this.titleElement.find(".mercury-panel-close").css({opacity:0}),this.paneElement.css({display:"none"}),i=this.element.width(),this.paneElement.css({visibility:"hidden",width:"auto",display:"block"}),t=this.element.width(),this.paneElement.css({visibility:"visible",display:"none"}),e=this.element.offset(),this.element.animate({left:e.left-(t-i),width:t},200,"easeInOutSine",function(){return n.titleElement.find(".mercury-panel-close").animate({opacity:1},100),n.paneElement.css({display:"block",width:t}),jQuery(n.paneElement.find(".focusable").get(0)).focus(),n.makeDraggable()}),this.visible?void 0:this.hide()},i.prototype.position=function(e){var t,i,n,s,o;return this.element.css({display:"block",visibility:"hidden"}),s=this.element.offset(),t=this.element.width(),i=Mercury.displayRect.height-16,o=i-this.titleElement.outerHeight(),this.paneElement.css({height:o,overflowY:30>o?"hidden":"auto"}),this.moved||(n=Mercury.displayRect.width-t-20),8>=n&&(n=8),(this.pinned||t+s.left>Mercury.displayRect.width-20)&&(n=Mercury.displayRect.width-t-20),this.element.css({top:Mercury.displayRect.top+8,left:n,height:i,display:e?"block":"none",visibility:"visible"}),this.makeDraggable(),e?void 0:this.element.hide()},i.prototype.loadContent=function(e){return this.loaded=!0,this.element.removeClass("loading"),this.paneElement.css({visibility:"hidden"}),this.paneElement.html(e),Mercury.config.localization.enabled?this.paneElement.localize(Mercury.locale()):void 0},i.prototype.makeDraggable=function(){var e,t=this;return e=this.element.width(),this.element.draggable({handle:"h1 span",axis:"x",opacity:.7,scroll:!1,addClasses:!1,iframeFix:!0,containment:[8,0,Mercury.displayRect.width-e-20,0],stop:function(){var i;return i=t.element.offset().left,t.moved=!0,t.pinned=i>Mercury.displayRect.width-e-30?!0:!1,!0}})},i}(Mercury.Dialog)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};this.Mercury.modal=function(e,t){var i;return null==t&&(t={}),i=new Mercury.Modal(e,t),i.show(),i},this.Mercury.Modal=function(){function t(t,i){this.url=t,this.options=null!=i?i:{},this.hide=e(this.hide,this)}return t.prototype.show=function(e,t){var i,n=this;return null==e&&(e=null),null==t&&(t=null),this.url=e||this.url,this.options=t||this.options,(i=this.options).minWidth||(i.minWidth=400),this.options.ujsHandling!==!1&&(this.options.ujsHandling=!0),Mercury.trigger("focus:window"),this.initializeModal(),this.visible?this.update():this.appear(),this.options.content?setTimeout(function(){return n.loadContent(n.options.content)},500):void 0},t.prototype.initializeModal=function(){return this.initialized?void 0:(this.build(),this.bindEvents(),this.initialized=!0)},t.prototype.build=function(){var e,t;return this.element=jQuery("<div>",{"class":"mercury-modal loading"}),this.element.html('<h1 class="mercury-modal-title"><span></span><a>&times;</a></h1>'),this.element.append('<div class="mercury-modal-content-container"><div class="mercury-modal-content"></div></div>'),this.overlay=jQuery("<div>",{"class":"mercury-modal-overlay"}),this.titleElement=this.element.find(".mercury-modal-title"),this.contentContainerElement=this.element.find(".mercury-modal-content-container"),this.contentElement=this.element.find(".mercury-modal-content"),this.element.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body"),this.overlay.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body")},t.prototype.bindEvents=function(){var e=this;return Mercury.on("refresh",function(){return e.resize(!0)}),Mercury.on("resize",function(){return e.position()}),this.overlay.on("click",function(){return e.options.allowHideUsingOverlay?e.hide():void 0}),this.titleElement.find("a").on("click",function(){return e.hide()}),this.options.ujsHandling&&this.element.on("ajax:beforeSend",function(t,i,n){return n.success=function(t){return e.loadContent(t)}}),jQuery(document).on("keydown",function(t){return 27===t.keyCode&&e.visible?e.hide():void 0})},t.prototype.appear=function(){var e=this;return this.showing=!0,this.position(),this.overlay.show(),this.overlay.animate({opacity:1},200,"easeInOutSine",function(){return e.element.css({top:-e.element.height()}),e.setTitle(),e.element.show(),e.element.animate({top:0},200,"easeInOutSine",function(){return e.visible=!0,e.showing=!1,e.load()})})},t.prototype.resize=function(e){var t,i,n,s,o=this;return n=e?"visible":"hidden",i=this.titleElement.outerHeight(),s=this.contentElement.outerWidth(),this.contentPane&&this.contentPane.css({height:"auto"}),this.contentElement.css({height:"auto",visibility:n,display:"block"}),t=this.contentElement.outerHeight()+i,s<this.options.minWidth&&(s=this.options.minWidth),(t>Mercury.displayRect.fullHeight||this.options.fullHeight)&&(t=Mercury.displayRect.fullHeight),this.element.stop().animate({left:(Mercury.displayRect.width-s)/2,width:s,height:t},200,"easeInOutSine",function(){var e;return o.contentElement.css({visibility:"visible",display:"block"}),o.contentPane.length?(o.contentElement.css({height:t-i,overflow:"visible"}),e=o.contentControl.length?o.contentControl.outerHeight()+10:0,o.contentPane.css({height:t-i-e-20}),o.contentPane.find(".mercury-display-pane").css({width:s-20})):o.contentElement.css({height:t-i,overflow:"auto"})})},t.prototype.position=function(){var e,t,i,n,s;return n=Mercury.displayRect.width,this.contentPane&&this.contentPane.css({height:"auto"}),this.contentElement.css({height:"auto"}),this.element.css({width:"auto",height:"auto",display:"block",visibility:"hidden"}),s=this.element.width(),t=this.element.height(),s<this.options.minWidth&&(s=this.options.minWidth),(t>Mercury.displayRect.fullHeight||this.options.fullHeight)&&(t=Mercury.displayRect.fullHeight),i=this.titleElement.outerHeight(),this.contentPane&&this.contentPane.length?(this.contentElement.css({height:t-i,overflow:"visible"}),e=this.contentControl.length?this.contentControl.outerHeight()+10:0,this.contentPane.css({height:t-i-e-20}),this.contentPane.find(".mercury-display-pane").css({width:s-20})):this.contentElement.css({height:t-i,overflow:"auto"}),this.element.css({left:(n-s)/2,width:s,height:t,display:this.visible?"block":"none",visibility:"visible"})},t.prototype.update=function(){return this.reset(),this.resize(),this.load()},t.prototype.load=function(){var e=this;return this.setTitle(),this.url?(this.element.addClass("loading"),Mercury.preloadedViews[this.url]?setTimeout(function(){return e.loadContent(Mercury.preloadedViews[e.url])},10):jQuery.ajax(this.url,{headers:Mercury.ajaxHeaders(),type:this.options.loadType||"GET",data:this.options.loadData,success:function(t){return e.loadContent(t)},error:function(){return e.hide(),Mercury.notify("Mercury was unable to load %s for the modal.",e.url)}})):void 0},t.prototype.loadContent=function(e,t){return null==t&&(t=null),this.initializeModal(),this.options=t||this.options,this.setTitle(),this.loaded=!0,this.element.removeClass("loading"),this.contentElement.html(e),this.contentElement.css({display:"none",visibility:"hidden"}),this.contentPane=this.element.find(".mercury-display-pane-container"),this.contentControl=this.element.find(".mercury-display-controls"),this.options.afterLoad&&this.options.afterLoad.call(this),this.options.handler&&(Mercury.modalHandlers[this.options.handler]?"function"==typeof Mercury.modalHandlers[this.options.handler]?Mercury.modalHandlers[this.options.handler].call(this):(jQuery.extend(this,Mercury.modalHandlers[this.options.handler]),this.initialize()):Mercury.lightviewHandlers[this.options.handler]&&("function"==typeof Mercury.lightviewHandlers[this.options.handler]?Mercury.lightviewHandlers[this.options.handler].call(this):(jQuery.extend(this,Mercury.lightviewHandlers[this.options.handler]),this.initialize()))),Mercury.config.localization.enabled&&this.element.localize(Mercury.locale()),this.element.find(".modal-close").on("click",this.hide),this.resize()},t.prototype.setTitle=function(){var e;return this.titleElement.find("span").html(Mercury.I18n(this.options.title)),e=this.titleElement.find("a"),this.options.closeButton===!1?e.hide():e.show()},t.prototype.serializeForm=function(){return this.element.find("form").serializeObject()||{}},t.prototype.reset=function(){return this.titleElement.find("span").html(""),this.contentElement.html("")},t.prototype.hide=function(){return this.showing?void 0:(this.options={},Mercury.trigger("focus:frame"),this.element.hide(),this.overlay.hide(),this.reset(),this.visible=!1)},t}()}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};this.Mercury.lightview=function(e,t){var i;return null==t&&(t={}),(i=Mercury.lightview).instance||(i.instance=new Mercury.Lightview(e,t)),Mercury.lightview.instance.show(e,t),Mercury.lightview.instance},this.Mercury.Lightview=function(){function t(t,i){this.url=t,this.options=null!=i?i:{},this.hide=e(this.hide,this)}return t.prototype.show=function(e,t){var i=this;return this.url=e||this.url,this.options=t||this.options,this.options.ujsHandling!==!1&&(this.options.ujsHandling=!0),Mercury.trigger("focus:window"),this.initializeLightview(),this.visible?this.update():this.appear(),this.options.content?setTimeout(function(){return i.loadContent(i.options.content)},500):void 0},t.prototype.initializeLightview=function(){return this.initialized?void 0:(this.build(),this.bindEvents(),this.initialized=!0)},t.prototype.build=function(){var e,t;return this.element=jQuery("<div>",{"class":"mercury-lightview loading"}),this.element.html('<h1 class="mercury-lightview-title"><span></span></h1>'),this.element.append('<div class="mercury-lightview-content"></div>'),this.overlay=jQuery("<div>",{"class":"mercury-lightview-overlay"}),this.titleElement=this.element.find(".mercury-lightview-title"),this.options.closeButton&&this.titleElement.append('<a class="mercury-lightview-close"></a>'),this.contentElement=this.element.find(".mercury-lightview-content"),this.element.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body"),this.overlay.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body")},t.prototype.bindEvents=function(){var e=this;return Mercury.on("refresh",function(){return e.resize(!0)}),Mercury.on("resize",function(){return e.visible?e.position():void 0}),this.overlay.on("click",function(){return e.options.closeButton?void 0:e.hide()}),this.titleElement.find(".mercury-lightview-close").on("click",function(){return e.hide()}),this.options.ujsHandling&&this.element.on("ajax:beforeSend",function(t,i,n){return n.success=function(t){return e.loadContent(t)}}),jQuery(document).on("keydown",function(t){return 27===t.keyCode&&e.visible?e.hide():void 0})},t.prototype.appear=function(){var e=this;return this.showing=!0,this.position(),this.overlay.show().css({opacity:0}),this.overlay.animate({opacity:1},200,"easeInOutSine",function(){return e.setTitle(),e.element.show().css({opacity:0}),e.element.stop().animate({opacity:1},200,"easeInOutSine",function(){return e.visible=!0,e.showing=!1,e.load()})})},t.prototype.resize=function(e){var t,i,n,s,o,r,a=this;return o=e?"visible":"hidden",s=Mercury.displayRect.width,n=Mercury.displayRect.fullHeight,i=this.titleElement.outerHeight(),r=this.contentElement.outerWidth(),(r>s-40||this.options.fullSize)&&(r=s-40),this.contentPane&&this.contentPane.css({height:"auto"}),this.contentElement.css({height:"auto",visibility:o,display:"block"}),t=this.contentElement.outerHeight()+i,(t>n-20||this.options.fullSize)&&(t=n-20),300>r&&(r=300),150>t&&(t=150),this.element.stop().animate({top:(n-t)/2+10,left:(Mercury.displayRect.width-r)/2,width:r,height:t},200,"easeInOutSine",function(){var e;return a.contentElement.css({visibility:"visible",display:"block"}),a.contentPane.length?(a.contentElement.css({height:t-i,overflow:"visible"}),e=a.contentControl.length?a.contentControl.outerHeight():0,a.contentPane.css({height:t-i-e-40}),a.contentPane.find(".mercury-display-pane").css({width:r-40})):a.contentElement.css({height:t-i-30,overflow:"auto"})})},t.prototype.position=function(){var e,t,i,n,s,o;return s=Mercury.displayRect.width,n=Mercury.displayRect.fullHeight,this.contentPane&&this.contentPane.css({height:"auto"}),this.contentElement.css({height:"auto"}),this.element.css({width:"auto",height:"auto",display:"block",visibility:"hidden"}),o=this.contentElement.width()+40,t=this.contentElement.height()+this.titleElement.outerHeight()+30,(o>s-40||this.options.fullSize)&&(o=s-40),(t>n-20||this.options.fullSize)&&(t=n-20),300>o&&(o=300),150>t&&(t=150),i=this.titleElement.outerHeight(),this.contentPane&&this.contentPane.length?(this.contentElement.css({height:t-i,overflow:"visible"}),e=this.contentControl.length?this.contentControl.outerHeight():0,this.contentPane.css({height:t-i-e-40}),this.contentPane.find(".mercury-display-pane").css({width:o-40})):this.contentElement.css({height:t-i-30,overflow:"auto"}),this.element.css({top:(n-t)/2+10,left:(s-o)/2,width:o,height:t,display:this.visible?"block":"none",visibility:"visible"})},t.prototype.update=function(){return this.reset(),this.resize(),this.load()},t.prototype.load=function(){var e=this;return this.setTitle(),this.url?(this.element.addClass("loading"),Mercury.preloadedViews[this.url]?setTimeout(function(){return e.loadContent(Mercury.preloadedViews[e.url])},10):jQuery.ajax(this.url,{headers:Mercury.ajaxHeaders(),type:this.options.loadType||"GET",data:this.options.loadData,success:function(t){return e.loadContent(t)},error:function(){return e.hide(),Mercury.notify("Mercury was unable to load %s for the lightview.",e.url)}})):void 0},t.prototype.loadContent=function(e,t){return null==t&&(t=null),this.initializeLightview(),this.options=t||this.options,this.setTitle(),this.loaded=!0,this.element.removeClass("loading"),this.contentElement.html(e),this.contentElement.css({display:"none",visibility:"hidden"}),this.contentPane=this.element.find(".mercury-display-pane-container"),this.contentControl=this.element.find(".mercury-display-controls"),this.options.afterLoad&&this.options.afterLoad.call(this),this.options.handler&&(Mercury.modalHandlers[this.options.handler]?"function"==typeof Mercury.modalHandlers[this.options.handler]?Mercury.modalHandlers[this.options.handler].call(this):(jQuery.extend(this,Mercury.modalHandlers[this.options.handler]),this.initialize()):Mercury.lightviewHandlers[this.options.handler]&&("function"==typeof Mercury.lightviewHandlers[this.options.handler]?Mercury.lightviewHandlers[this.options.handler].call(this):(jQuery.extend(this,Mercury.lightviewHandlers[this.options.handler]),this.initialize()))),Mercury.config.localization.enabled&&this.element.localize(Mercury.locale()),this.element.find(".lightview-close").on("click",this.hide),this.resize()},t.prototype.setTitle=function(){return this.titleElement.find("span").html(Mercury.I18n(this.options.title))},t.prototype.serializeForm=function(){return this.element.find("form").serializeObject()||{}},t.prototype.reset=function(){return this.titleElement.find("span").html(""),this.contentElement.html("")},t.prototype.hide=function(){return this.showing?void 0:(this.options={},Mercury.trigger("focus:frame"),this.element.hide(),this.overlay.hide(),this.reset(),this.visible=!1)},t}()}.call(this),function(){this.Mercury.Statusbar=function(){function e(e){this.options=null!=e?e:{},this.visible=this.options.visible,this.build(),this.bindEvents()}return e.prototype.build=function(){var e;return this.element=jQuery("<div>",{"class":"mercury-statusbar"}),this.aboutElement=jQuery("<a>",{"class":"mercury-statusbar-about"}).appendTo(this.element).html("Mercury Editor v"+Mercury.version),this.pathElement=jQuery("<div>",{"class":"mercury-statusbar-path"}).appendTo(this.element),this.visible||this.element.css({visibility:"hidden"}),this.element.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body")},e.prototype.bindEvents=function(){var e=this;return Mercury.on("region:update",function(t,i){return i.region&&"function"===jQuery.type(i.region.path)?e.setPath(i.region.path()):void 0}),this.aboutElement.on("click",function(){return Mercury.lightview("/mercury/lightviews/about.html",{title:"Mercury Editor v"+Mercury.version})})},e.prototype.height=function(){return this.element.outerHeight()},e.prototype.top=function(){var e,t;return t=this.element.offset().top,e=parseInt(this.element.css("bottom"))<0?t-this.element.outerHeight():t,this.visible?e:t+this.element.outerHeight()},e.prototype.setPath=function(e){var t,i,n,s;for(i=[],n=0,s=e.length;s>n;n++)t=e[n],i.push("<a>"+t.tagName.toLowerCase()+"</a>");return this.pathElement.html("<span><strong>"+Mercury.I18n("Path:")+" </strong>"+i.reverse().join(" &raquo; ")+"</span>")},e.prototype.show=function(){return this.visible=!0,this.element.css({opacity:0,visibility:"visible"}),this.element.animate({opacity:1},200,"easeInOutSine")},e.prototype.hide=function(){return this.visible=!1,this.element.css({visibility:"hidden"})},e}()}.call(this),function(){var e={}.hasOwnProperty;this.Mercury.Toolbar=function(){function t(e){this.options=null!=e?e:{},this.visible=this.options.visible,this.build(),this.bindEvents()}return t.prototype.build=function(){var t,i,n,s,o,r,a,l,c,u;this.element=jQuery("<div>",{"class":"mercury-toolbar-container",style:"width:10000px"}),this.element.css({width:"100%"}),this.element.appendTo(null!=(c=jQuery(this.options.appendTo).get(0))?c:"body"),u=Mercury.config.toolbars;for(l in u)if(e.call(u,l)&&(n=u[l],!n._custom)){a=jQuery("<div>",{"class":"mercury-toolbar mercury-"+l+"-toolbar"}).appendTo(this.element),n._regions&&a.attr("data-regions",n._regions),s=jQuery("<div>",{"class":"mercury-toolbar-button-container"}).appendTo(a);for(i in n)e.call(n,i)&&(r=n[i],"_regions"!==i&&(t=this.buildButton(i,r),t&&t.appendTo(s)));"nowrap"===s.css("white-space")&&(o=new Mercury.Toolbar.Expander(l,{appendTo:a,"for":s}),o.appendTo(this.element)),Mercury.config.toolbars.primary&&"primary"!==l&&a.addClass("disabled")}return this.visible?void 0:this.element.css({display:"none"})},t.prototype.buildButton=function(t,i){var n,s,o,r,a,l,c;if("_"===t[0])return!1;switch(jQuery.type(i)){case"array":return c=i[0],l=i[1],r=i[2],new Mercury.Toolbar.Button(t,c,l,r,{appendDialogsTo:this.element});case"object":o=new Mercury.Toolbar.ButtonGroup(t,i);for(n in i)e.call(i,n)&&(a=i[n],s=this.buildButton(n,a),s&&s.appendTo(o));return o;case"string":return jQuery("<hr>",{"class":"mercury-"+("-"===i?"line-separator":"separator")});default:throw Mercury.I18n('Unknown button structure -- please provide an array, object, or string for "%s".',t)}},t.prototype.bindEvents=function(){var e=this;return Mercury.on("region:focused",function(t,i){var n,s,o,r,a,l;for(a=e.element.find(".mercury-toolbar"),l=[],o=0,r=a.length;r>o;o++)s=a[o],s=jQuery(s),(n=s.data("regions"))?n.split(",").indexOf(i.region.type())>-1?l.push(s.removeClass("disabled")):l.push(void 0):l.push(void 0);return l}),Mercury.on("region:blurred",function(t,i){var n,s,o,r,a,l;for(a=e.element.find(".mercury-toolbar"),l=[],o=0,r=a.length;r>o;o++)s=a[o],s=jQuery(s),(n=s.data("regions"))?n.split(",").indexOf(i.region.type())>-1?l.push(s.addClass("disabled")):l.push(void 0):l.push(void 0);return l}),this.element.on("click",function(){return Mercury.trigger("hide:dialogs")}),this.element.on("mousedown",function(e){return e.preventDefault()})},t.prototype.height=function(e){return null==e&&(e=!1),this.visible||e?this.element.outerHeight():0},t.prototype.top=function(){return this.visible?this.element.offset().top:0},t.prototype.show=function(){return this.visible=!0,this.element.css({top:-this.element.outerHeight(),display:"block"}),this.element.animate({top:0},200,"easeInOutSine")},t.prototype.hide=function(){return this.visible=!1,this.element.hide()},t}()}.call(this),function(){var e={}.hasOwnProperty;this.Mercury.Toolbar.Button=function(){function t(e,t,i,n,s){return this.name=e,this.title=t,this.summary=null!=i?i:null,this.types=null!=n?n:{},this.options=null!=s?s:{},this.title&&(this.title=Mercury.I18n(this.title)),this.summary&&(this.summary=Mercury.I18n(this.summary)),this.build(),this.bindEvents(),this.element}return t.prototype.build=function(){var t,i,n,s,o,r;this.element=jQuery("<div>",{title:null!=(s=this.summary)?s:this.title,"class":"mercury-button mercury-"+this.name+"-button"}).html("<em>"+this.title+"</em>"),this.element.data("expander",'<div class="mercury-expander-button" data-button="'+this.name+'"><em></em><span>'+this.title+"</span></div>"),this.handled={},o=this.types,r=[];for(n in o)if(e.call(o,n))switch(t=o[n],n){case"preload":r.push(!0);break;case"regions":this.element.addClass("disabled"),r.push(this.handled[n]=jQuery.isFunction(t)?t.call(this,this.name):t);break;case"toggle":r.push(this.handled[n]=!0);break;case"mode":r.push(this.handled[n]=t===!0?this.name:t);break;case"context":r.push(this.handled[n]=jQuery.isFunction(t)?t:Mercury.Toolbar.Button.contexts[this.name]);break;case"palette":this.element.addClass("mercury-button-palette"),i=jQuery.isFunction(t)?t.call(this,this.name):t,r.push(this.handled[n]="string"==typeof i?new Mercury.Palette(i,this.name,this.defaultDialogOptions()):i);break;case"select":this.element.addClass("mercury-button-select").find("em").html(this.title),i=jQuery.isFunction(t)?t.call(this,this.name):t,r.push(this.handled[n]="string"==typeof i?new Mercury.Select(i,this.name,this.defaultDialogOptions()):i);break;case"panel":this.element.addClass("mercury-button-panel"),this.handled.toggle=!0,i=jQuery.isFunction(t)?t.call(this,this.name):t,r.push(this.handled[n]="string"==typeof i?new Mercury.Panel(i,this.name,this.defaultDialogOptions()):i);break;case"modal":r.push(this.handled[n]=jQuery.isFunction(t)?t.call(this,this.name):t);break;case"lightview":r.push(this.handled[n]=jQuery.isFunction(t)?t.call(this,this.name):t);break;default:throw Mercury.I18n('Unknown button type "%s" used for the "%s" button.',n,this.name)}return r},t.prototype.bindEvents=function(){var e=this;return Mercury.on("button",function(t,i){return i.action===e.name?e.element.click():void 0}),Mercury.on("mode",function(t,i){return e.handled.mode===i.mode&&e.handled.toggle?e.togglePressed():void 0}),Mercury.on("region:update",function(t,i){var n;return e.handled.context&&i.region&&"function"===jQuery.type(i.region.currentElement)?(n=i.region.currentElement(),n.length&&e.handled.context.call(e,n,i.region.element)?e.element.addClass("active"):e.element.removeClass("active")):e.element.removeClass("active")}),Mercury.on("region:focused",function(t,i){return e.handled.regions&&i.region&&i.region.type()?e.handled.regions.indexOf(i.region.type())>-1?e.element.removeClass("disabled"):e.element.addClass("disabled"):void 0}),Mercury.on("region:blurred",function(){return e.handled.regions?e.element.addClass("disabled"):void 0}),this.element.on("mousedown",function(){return e.element.addClass("active")}),this.element.on("mouseup",function(){return e.element.removeClass("active")}),this.element.on("click",function(t){return e.element.closest(".disabled").length?void 0:e.handleClick(t)})},t.prototype.handleClick=function(t){var i,n,s,o;i=!1,o=this.handled;for(s in o)if(e.call(o,s))switch(n=o[s],s){case"toggle":this.handled.mode||this.togglePressed();break;case"mode":i=!0,Mercury.trigger("mode",{mode:n});break;case"modal":i=this.handleModal(t);break;case"lightview":i=this.handleLightview(t);break;case"palette":case"select":case"panel":i=this.handleDialog(t,s)}return i||Mercury.trigger("action",{action:this.name}),this.options.regions&&this.options.regions.length?Mercury.trigger("focus:frame"):void 0},t.prototype.handleModal=function(){return Mercury.modal(this.handled.modal,{title:this.summary||this.title,handler:this.name}),!0},t.prototype.handleLightview=function(){return Mercury.lightview(this.handled.lightview,{title:this.summary||this.title,handler:this.name,closeButton:!0}),!0},t.prototype.handleDialog=function(e,t){return e.stopPropagation(),this.handled[t].toggle(),!0},t.prototype.defaultDialogOptions=function(){return{title:this.summary||this.title,preload:this.types.preload,appendTo:this.options.appendDialogsTo||"body",closeButton:!0,"for":this.element}},t.prototype.togglePressed=function(){return this.element.toggleClass("pressed")},t}(),this.Mercury.Toolbar.Button.contexts={backColor:function(e){return this.element.css("background-color",e.css("background-color"))},foreColor:function(e){return this.element.css("background-color",e.css("color"))},bold:function(e){var t;return t=e.css("font-weight"),"bold"===t||t>400},italic:function(e){return"italic"===e.css("font-style")},overline:function(e){var t,i,n,s;if("overline"===e.css("text-decoration"))return!0;for(s=e.parentsUntil(this.element),i=0,n=s.length;n>i;i++)if(t=s[i],"overline"===jQuery(t).css("text-decoration"))return!0;return!1},strikethrough:function(e,t){return"line-through"===e.css("text-decoration")||!!e.closest("strike",t).length},underline:function(e,t){return"underline"===e.css("text-decoration")||!!e.closest("u",t).length},subscript:function(e,t){return!!e.closest("sub",t).length},superscript:function(e,t){return!!e.closest("sup",t).length},justifyLeft:function(e){return e.css("text-align").indexOf("left")>-1},justifyCenter:function(e){return e.css("text-align").indexOf("center")>-1},justifyRight:function(e){return e.css("text-align").indexOf("right")>-1},justifyFull:function(e){return e.css("text-align").indexOf("justify")>-1},insertOrderedList:function(e,t){return!!e.closest("ol",t.element).length},insertUnorderedList:function(e,t){return!!e.closest("ul",t.element).length}}}.call(this),function(){this.Mercury.Toolbar.ButtonGroup=function(){function e(e,t){return this.name=e,this.options=null!=t?t:{},this.build(),this.bindEvents(),this.regions=this.options._regions,this.element}return e.prototype.build=function(){return this.element=jQuery("<div>",{"class":"mercury-button-group mercury-"+this.name+"-group"}),this.options._context||this.options._regions?this.element.addClass("disabled"):void 0},e.prototype.bindEvents=function(){var e=this;return Mercury.on("region:update",function(t,i){var n,s;return n=Mercury.Toolbar.ButtonGroup.contexts[e.name],n&&i.region&&"function"===jQuery.type(i.region.currentElement)?(s=i.region.currentElement(),s.length&&n.call(e,s,i.region.element)?e.element.removeClass("disabled"):e.element.addClass("disabled")):void 0}),Mercury.on("region:focused",function(t,i){if(e.regions&&i.region&&i.region.type()){if(!(e.regions.indexOf(i.region.type())>-1))return e.element.addClass("disabled");if(!e.options._context)return e.element.removeClass("disabled")}}),Mercury.on("region:blurred",function(){return e.options.regions?e.element.addClass("disabled"):void 0})},e}(),this.Mercury.Toolbar.ButtonGroup.contexts={table:function(e,t){return!!e.closest("table",t).length}}}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.Toolbar.Expander=function(e){function i(e,t){return this.name=e,this.options=t,this.container=this.options["for"],i.__super__.constructor.call(this,null,this.name,this.options),this.element}return t(i,e),i.prototype.build=function(){var e;return this.container.css({whiteSpace:"normal",visibility:"hidden",display:"block"}),this.containerWidth=this.container.outerWidth(),this.container.css({visibility:"visible"}),this.trigger=jQuery("<div>",{"class":"mercury-toolbar-expander"}).appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body"),this.element=jQuery("<div>",{"class":"mercury-palette mercury-expander mercury-"+this.name+"-expander",style:"display:none"}),this.windowResize()},i.prototype.bindEvents=function(){var e=this;return Mercury.on("hide:dialogs",function(t,i){return i!==e?e.hide():void 0}),Mercury.on("resize",function(){return e.windowResize()}),i.__super__.bindEvents.apply(this,arguments),this.trigger.click(function(t){var i,n,s,o,r;for(t.stopPropagation(),n=[],r=e.container.find(".mercury-button"),s=0,o=r.length;o>s;s++)i=r[s],i=jQuery(i),i.position().top>5&&n.push(i.data("expander"));return e.loadContent(n.join("")),e.toggle()}),this.element.click(function(t){var i,n;return n=jQuery(t.target).closest("[data-button]").data("button"),i=e.container.find(".mercury-"+n+"-button"),i.click()})},i.prototype.windowResize=function(){return this.containerWidth>jQuery(window).width()?this.trigger.show():this.trigger.hide(),this.hide()},i.prototype.position=function(e){var t,i;return this.element.css({top:0,left:0,display:"block",visibility:"hidden"}),t=this.trigger.position(),i=this.element.width(),t.left+i>jQuery(window).width()&&(t.left=t.left-i+this.trigger.width()),this.element.css({top:t.top+this.trigger.height(),left:t.left,display:e?"block":"none",visibility:"visible"})},i}(Mercury.Palette)}.call(this),function(){this.Mercury.tooltip=function(e,t,i){return null==i&&(i={}),Mercury.tooltip.show(e,t,i),Mercury.tooltip},jQuery.extend(Mercury.tooltip,{show:function(e,t,i){return this.forElement=e,this.content=t,this.options=null!=i?i:{},this.document=this.forElement.get(0).ownerDocument,this.initialize(),this.visible?this.update():this.appear()},initialize:function(){return this.initialized?void 0:(this.build(),this.bindEvents(),this.initialized=!0)},build:function(){var e;return this.element=jQuery("<div>",{"class":"mercury-tooltip"}),this.element.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body")},bindEvents:function(){var e,t,i,n,s=this;for(Mercury.on("resize",function(){return s.visible?s.position():void 0}),this.element.on("mousedown",function(e){return e.preventDefault(),e.stopPropagation()}),n=this.forElement.parentsUntil(jQuery("body",this.document)),t=0,i=n.length;i>t;t++)e=n[t],e.scrollHeight>e.clientHeight&&jQuery(e).on("scroll",function(){return s.visible?s.position():void 0});return jQuery(this.document).on("scroll",function(){return s.visible?s.position():void 0})},appear:function(){var e=this;return this.update(),this.element.show(),this.element.animate({opacity:1},200,"easeInOutSine",function(){return e.visible=!0})},update:function(){return this.element.html(this.content),this.position()},position:function(){var e,t,i,n;return t=this.forElement.offset(),n=this.element.width(),i=t.top+(Mercury.displayRect.top-jQuery(this.document).scrollTop())+this.forElement.outerHeight(),e=t.left-jQuery(this.document).scrollLeft(),e+n+25>Mercury.displayRect.width&&(e=e-(e+n+25)-Mercury.displayRect.width),e=0>=e?0:e,this.element.css({top:i,left:e})
},hide:function(){return this.initialized?(this.element.hide(),this.visible=!1):void 0}})}.call(this),function(){var e={}.hasOwnProperty;this.Mercury.Snippet=function(){function t(e,t,i){this.name=e,this.identity=t,null==i&&(i={}),this.version=0,this.data="",this.wrapperTag="div",this.history=new Mercury.HistoryBuffer,this.setOptions(i)}return t.all=[],t.displayOptionsFor=function(e,t,i){var n;return null==t&&(t={}),null==i&&(i=!0),i?Mercury.modal(this.optionsUrl(e),jQuery.extend({title:"Snippet Options",handler:"insertSnippet",snippetName:e,loadType:Mercury.config.snippets.method},t)):(n=Mercury.Snippet.create(e),Mercury.trigger("action",{action:"insertSnippet",value:n})),Mercury.snippet=null},t.optionsUrl=function(e){var t;return t=Mercury.config.snippets.optionsUrl,"function"==typeof t&&(t=t()),t.replace(":name",e)},t.previewUrl=function(e){var t;return t=Mercury.config.snippets.previewUrl,"function"==typeof t&&(t=t()),t.replace(":name",e)},t.create=function(e,t){var i;return i=new Mercury.Snippet(e,this.uniqueId(),t),this.all.push(i),i},t.uniqueId=function(){var e,t,i,n,s;for(s=[0,"snippet_0"],e=s[0],i=s[1],t=function(){var e,t,i,s;for(i=this.all,s=[],e=0,t=i.length;t>e;e++)n=i[e],s.push(n.identity);return s}.call(this);-1!==t.indexOf(i);)e+=1,i="snippet_"+e;return i},t.find=function(e){var t,i,n,s;for(s=this.all,i=0,n=s.length;n>i;i++)if(t=s[i],t.identity===e)return t;return null},t.load=function(t){var i,n,s,o;o=[];for(n in t)e.call(t,n)&&(i=t[n],s=new Mercury.Snippet(i.name,n,i),o.push(this.all.push(s)));return o},t.clearAll=function(){return delete this.all,this.all=[]},t.prototype.getHTML=function(e,t){var i;return null==t&&(t=null),i=jQuery("<"+this.wrapperTag+">",{"class":""+this.name+"-snippet",contenteditable:"false","data-snippet":this.identity,"data-version":this.version},e),i.html("["+this.identity+"]"),this.loadPreview(i,t),i},t.prototype.getText=function(){return"[--"+this.identity+"--]"},t.prototype.loadPreview=function(e,i){var n=this;return null==i&&(i=null),jQuery.ajax(t.previewUrl(this.name),{headers:Mercury.ajaxHeaders(),type:Mercury.config.snippets.method,data:this.options,success:function(t){return n.data=t,e.html(t),i?i():void 0},error:function(){return Mercury.notify('Error loading the preview for the "%s" snippet.',n.name)}})},t.prototype.displayOptions=function(){return Mercury.snippet=this,Mercury.modal(t.optionsUrl(this.name),{title:"Snippet Options",handler:"insertSnippet",loadType:Mercury.config.snippets.method,loadData:this.options})},t.prototype.setOptions=function(e){return this.options=e,delete this.options.authenticity_token,delete this.options.utf8,this.options.wrapperTag&&(this.wrapperTag=this.options.wrapperTag),this.version+=1,this.history.push(this.options)},t.prototype.setVersion=function(e){return null==e&&(e=null),e=parseInt(e),e&&this.history.stack[e-1]?(this.version=e,this.options=this.history.stack[e-1],!0):!1},t.prototype.serialize=function(){return $.extend({name:this.name},this.options)},t}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.SnippetToolbar=function(i){function n(e,t){this.document=e,this.options=null!=t?t:{},this._boundEvents=[],n.__super__.constructor.call(this,this.options)}return t(n,i),n.prototype.build=function(){var t,i,n,s,o,r;this.element=jQuery("<div>",{"class":"mercury-toolbar mercury-snippet-toolbar",style:"display:none"}),this.element.appendTo(null!=(s=jQuery(this.options.appendTo).get(0))?s:"body"),o=Mercury.config.toolbars.snippets,r=[];for(i in o)e.call(o,i)&&(n=o[i],t=this.buildButton(i,n),t?r.push(t.appendTo(this.element)):r.push(void 0));return r},n.prototype.bindEvents=function(){var e=this;return this.bindReleasableEvent(Mercury,"show:toolbar",function(t,i){return i.snippet?(i.snippet.mouseout(function(){return e.hide()}),e.show(i.snippet)):void 0}),this.bindReleasableEvent(Mercury,"hide:toolbar",function(t,i){return i.type&&"snippet"===i.type?e.hide(i.immediately):void 0}),this.bindReleasableEvent(jQuery(this.document),"scroll",function(){return e.visible?e.position():void 0}),this.element.mousemove(function(){return clearTimeout(e.hideTimeout)}),this.element.mouseout(function(){return e.hide()})},n.prototype.bindReleasableEvent=function(e,t,i){return e.on(t,i),this._boundEvents.push([e,t,i])},n.prototype.show=function(e){return this.snippet=e,Mercury.tooltip.hide(),this.position(),this.appear()},n.prototype.position=function(){var e,t,i;return t=this.snippet.offset(),i=t.top+Mercury.displayRect.top-jQuery(this.document).scrollTop()-this.height()+10,e=t.left-jQuery(this.document).scrollLeft(),this.element.css({top:i,left:e})},n.prototype.appear=function(){return clearTimeout(this.hideTimeout),this.visible?void 0:(this.visible=!0,this.element.css({display:"block",opacity:0}),this.element.stop().animate({opacity:1},200,"easeInOutSine"))},n.prototype.hide=function(e){var t=this;return null==e&&(e=!1),clearTimeout(this.hideTimeout),e?(this.element.hide(),this.visible=!1):this.hideTimeout=setTimeout(function(){return t.element.stop().animate({opacity:0},300,"easeInOutSine",function(){return t.element.hide()}),t.visible=!1},500)},n.prototype.release=function(){var e,t,i,n,s,o,r;for(this.element.off(),this.element.remove(),o=this._boundEvents,n=0,s=o.length;s>n;n++)r=o[n],i=r[0],e=r[1],t=r[2],i.off(e,t);return this._boundEvents=[]},n}(Mercury.Toolbar)}.call(this),function(){this.Mercury.Region=function(){function e(e,t,i){this.element=e,this.window=t,this.options=null!=i?i:{},Mercury.log("building "+this.type(),this.element,this.options),this.document=this.window.document,this.name=this.element.attr(Mercury.config.regions.identifier),this.history=new Mercury.HistoryBuffer,this.build(),this.bindEvents(),this.pushHistory(),this.element.data("region",this)}return e.prototype.type=function(){return"unknown"},e.prototype.build=function(){},e.prototype.focus=function(){},e.prototype.bindEvents=function(){var e=this;return Mercury.on("mode",function(t,i){return"preview"===i.mode?e.togglePreview():void 0}),Mercury.on("focus:frame",function(){return e.previewing||Mercury.region!==e?void 0:e.focus()}),Mercury.on("action",function(t,i){return e.previewing||Mercury.region!==e||t.isDefaultPrevented()?void 0:i.action?e.execCommand(i.action,i):void 0}),this.element.on("mousemove",function(t){var i;if(!e.previewing&&Mercury.region===e)return i=jQuery(t.target).closest("[data-snippet]"),i.length&&(e.snippet=i,e.snippet.data("snippet"))?Mercury.trigger("show:toolbar",{type:"snippet",snippet:e.snippet}):void 0}),this.element.on("mouseout",function(){return e.previewing?void 0:Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!1})})},e.prototype.content=function(e,t){var i,n,s,o,r;if(null==e&&(e=null),null==t&&(t=!1),null!==e)return this.element.html(e);if(i=jQuery("<div>").appendTo(this.document.createDocumentFragment()),i.html(this.element.html().replace(/^\s+|\s+$/g,"")),t)for(r=i.find("[data-snippet]"),s=0,o=r.length;o>s;s++)n=r[s],n=jQuery(n),n.attr({contenteditable:null,"data-version":null}),n.html("["+n.data("snippet")+"]");return i.html()},e.prototype.togglePreview=function(){return this.previewing?(this.previewing=!1,this.element.attr(Mercury.config.regions.attribute,this.type()),Mercury.region===this?this.focus():void 0):(this.previewing=!0,this.element.removeAttr(Mercury.config.regions.attribute),Mercury.trigger("region:blurred",{region:this}))},e.prototype.execCommand=function(e,t){return null==t&&(t={}),this.focus(),"redo"!==e&&this.pushHistory(),Mercury.log("execCommand",e,t.value),Mercury.changes=!0},e.prototype.pushHistory=function(){return this.history.push(this.content())},e.prototype.snippets=function(){var e,t,i,n,s,o;for(i={},o=this.element.find("[data-snippet]"),n=0,s=o.length;s>n;n++)e=o[n],t=Mercury.Snippet.find(jQuery(e).data("snippet")),t&&(i[t.identity]=t.serialize());return i},e.prototype.dataAttributes=function(){var e,t,i,n,s;for(t={},s=Mercury.config.regions.dataAttributes,i=0,n=s.length;n>i;i++)e=s[i],t[e]=(this.container||this.element).attr("data-"+e);return t},e.prototype.serialize=function(){return{type:this.type(),data:this.dataAttributes(),value:this.content(null,!0),snippets:this.snippets()}},e}()}.call(this),function(){var e={}.hasOwnProperty;this.Mercury.uploader=function(e,t){return Mercury.config.uploading.enabled&&Mercury.uploader.show(e,t),Mercury.uploader},jQuery.extend(Mercury.uploader,{show:function(e,t){return this.options=null!=t?t:{},this.file=new Mercury.uploader.File(e),this.file.errors?(alert("Error: "+this.file.errors),void 0):this.supported()?(Mercury.trigger("focus:window"),this.initialize(),this.appear()):void 0},initialize:function(){return this.initialized?void 0:(this.build(),this.bindEvents(),this.initialized=!0)},supported:function(){var e;return e=new XMLHttpRequest,window.Uint8Array&&window.ArrayBuffer&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(e){var t,i,n,s,o;for(n=new Uint8Array(e.length),i=s=0,o=e.length;o>s;i=++s)t=e[i],n[i]=255&e.charCodeAt(i);return this.send(n.buffer)}),!(!e.upload||!e.sendAsBinary||!Mercury.uploader.fileReaderSupported()&&!Mercury.uploader.formDataSupported())},fileReaderSupported:function(){return!!window.FileReader},formDataSupported:function(){return!!window.FormData},build:function(){var e,t;return this.element=jQuery("<div>",{"class":"mercury-uploader",style:"display:none"}),this.element.append('<div class="mercury-uploader-preview"><b><img/></b></div>'),this.element.append('<div class="mercury-uploader-details"></div>'),this.element.append('<div class="mercury-uploader-progress"><span></span><div class="mercury-uploader-indicator"><div><b>0%</b></div></div></div>'),this.updateStatus("Processing..."),this.overlay=jQuery("<div>",{"class":"mercury-uploader-overlay",style:"display:none"}),this.element.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body"),this.overlay.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body")},bindEvents:function(){var e=this;return Mercury.on("resize",function(){return e.position()})},appear:function(){var e=this;return this.fillDisplay(),this.position(),this.overlay.show(),this.overlay.animate({opacity:1},200,"easeInOutSine",function(){return e.element.show(),e.element.animate({opacity:1},200,"easeInOutSine",function(){return e.visible=!0,e.loadImage()})})},position:function(){var e,t;return t=this.element.outerWidth(),e=this.element.outerHeight(),this.element.css({top:(Mercury.displayRect.height-e)/2,left:(Mercury.displayRect.width-t)/2})},fillDisplay:function(){var e;return e=[Mercury.I18n("Name: %s",this.file.name),Mercury.I18n("Size: %s",this.file.readableSize),Mercury.I18n("Type: %s",this.file.type)],this.element.find(".mercury-uploader-details").html(e.join("<br/>"))},loadImage:function(){var e=this;return Mercury.uploader.fileReaderSupported()?this.file.readAsDataURL(function(t){return e.element.find(".mercury-uploader-preview b").html(jQuery("<img>",{src:t})),e.upload()}):this.upload()},upload:function(){var e,t,i=this;return t=new XMLHttpRequest,jQuery.each(["onloadstart","onprogress","onload","onabort","onerror"],function(e,n){return t.upload[n]=function(e){return i.uploaderEvents[n].call(i,e)}}),t.onload=function(e){var t,n,s;if(e.currentTarget.status>=400)return i.updateStatus("Error: Unable to upload the file"),Mercury.notify("Unable to process response: %s",e.currentTarget.status),i.hide();try{if(n=Mercury.config.uploading.handler?Mercury.config.uploading.handler(e.target.responseText):jQuery.parseJSON(e.target.responseText),s=n.url||n.image.url,!s)throw"Malformed response from server.";return Mercury.trigger("action",{action:"insertImage",value:{src:s}}),i.hide()}catch(o){return t=o,i.updateStatus("Error: Unable to upload the file"),Mercury.notify("Unable to process response: %s",t),i.hide()}},t.open("post",Mercury.config.uploading.url,!0),t.setRequestHeader("Accept","application/json, text/javascript, text/html, application/xml, text/xml, */*"),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader(Mercury.config.csrfHeader,Mercury.csrfToken),Mercury.uploader.fileReaderSupported()?this.file.readAsBinaryString(function(e){var n;return n=new Mercury.uploader.MultiPartPost(Mercury.config.uploading.inputName,i.file,e),i.file.updateSize(n.delta),t.setRequestHeader("Content-Type","multipart/form-data; boundary="+n.boundary),t.sendAsBinary(n.body)}):(e=new FormData,e.append(Mercury.config.uploading.inputName,this.file.file,this.file.file.name),t.send(e))},updateStatus:function(e,t){var i;return this.element.find(".mercury-uploader-progress span").html(Mercury.I18n(e).toString()),t?(i=Math.floor(100*t/this.file.size)+"%",this.element.find(".mercury-uploader-indicator div").css({width:i}),this.element.find(".mercury-uploader-indicator b").html(i).show()):void 0},hide:function(e){var t=this;return null==e&&(e=0),setTimeout(function(){return t.element.animate({opacity:0},200,"easeInOutSine",function(){return t.overlay.animate({opacity:0},200,"easeInOutSine",function(){return t.overlay.hide(),t.element.hide(),t.reset(),t.visible=!1,Mercury.trigger("focus:frame")})})},1e3*e)},reset:function(){return this.element.find(".mercury-uploader-preview b").html(""),this.element.find(".mercury-uploader-indicator div").css({width:0}),this.element.find(".mercury-uploader-indicator b").html("0%").hide(),this.updateStatus("Processing...")},uploaderEvents:{onloadstart:function(){return this.updateStatus("Uploading...")},onprogress:function(e){return this.updateStatus("Uploading...",e.loaded)},onabort:function(){return this.updateStatus("Aborted"),this.hide(1)},onload:function(){return this.updateStatus("Successfully uploaded...",this.file.size)},onerror:function(){return this.updateStatus("Error: Unable to upload the file"),this.hide(3)}}}),Mercury.uploader.File=function(){function e(e){var t;this.file=e,this.fullSize=this.size=this.file.size||this.file.fileSize,this.readableSize=this.size.toBytes(),this.name=this.file.name||this.file.fileName,this.type=this.file.type||this.file.fileType,t=[],this.size>=Mercury.config.uploading.maxFileSize&&t.push(Mercury.I18n("Too large")),Mercury.config.uploading.allowedMimeTypes.indexOf(this.type)>-1||t.push(Mercury.I18n("Unsupported format")),t.length&&(this.errors=t.join(" / "))}return e.prototype.readAsDataURL=function(e){var t;return null==e&&(e=null),t=new FileReader,t.readAsDataURL(this.file),t.onload=function(){return e?e(t.result):void 0}},e.prototype.readAsBinaryString=function(e){var t;return null==e&&(e=null),t=new FileReader,t.readAsBinaryString(this.file),t.onload=function(){return e?e(t.result):void 0}},e.prototype.updateSize=function(e){return this.fullSize=this.size+e},e}(),Mercury.uploader.MultiPartPost=function(){function t(e,t,i,n){this.inputName=e,this.file=t,this.contents=i,this.formInputs=null!=n?n:{},this.boundary="Boundaryx20072377098235644401115438165x",this.body="",this.buildBody(),this.delta=this.body.length-this.file.size}return t.prototype.buildBody=function(){var t,i,n,s;t="--"+this.boundary,s=this.formInputs;for(i in s)e.call(s,i)&&(n=s[i],this.body+=""+t+'\r\nContent-Disposition: form-data; name="'+i+'"\r\n\r\n'+unescape(encodeURIComponent(n))+"\r\n");return this.body+=""+t+'\r\nContent-Disposition: form-data; name="'+this.inputName+'"; filename="'+this.file.name+'"\r\nContent-Type: '+this.file.type+"\r\nContent-Transfer-Encoding: binary\r\n\r\n"+this.contents+"\r\n"+t+"--"},t}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},i=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1};this.Mercury.Regions.Full=function(e){function n(e,t,i){this.element=e,this.window=t,this.options=null!=i?i:{},n.__super__.constructor.apply(this,arguments)}var s;return t(n,e),n.supported=document.designMode&&!jQuery.browser.konqueror&&!jQuery.browser.msie,n.supportedText="Chrome 10+, Firefox 4+, Safari 5+, Opera 11.64+",s="full",n.prototype.type=function(){return s},n.prototype.build=function(){var e,t,i,n,s;for(jQuery.browser.mozilla&&""===this.content()&&this.content("&nbsp;"),this.element.data({originalOverflow:this.element.css("overflow")}),this.element.css({overflow:"auto"}),this.specialContainer=jQuery.browser.mozilla&&"DIV"!==this.element.get(0).tagName,this.element.get(0).contentEditable=!0,s=this.element.find("[data-snippet]"),i=0,n=s.length;n>i;i++)t=s[i],t.contentEditable=!1,jQuery(t).attr("data-version","1");if(!this.document.mercuryEditing){this.document.mercuryEditing=!0;try{return this.document.execCommand("styleWithCSS",!1,!1),this.document.execCommand("insertBROnReturn",!1,!0),this.document.execCommand("enableInlineTableEditing",!1,!1),this.document.execCommand("enableObjectResizing",!1,!1)}catch(o){e=o}}},n.prototype.bindEvents=function(){var e=this;return n.__super__.bindEvents.apply(this,arguments),Mercury.on("region:update",function(){var t,i,n;if(!e.previewing&&Mercury.region===e)return setTimeout(function(){return e.selection().forceSelection(e.element.get(0))},1),i=e.currentElement(),i.length?(n=i.closest("table",e.element),n.length&&Mercury.tableEditor(n,i.closest("tr, td"),"<br/>"),t=i.closest("a",e.element),t.length&&t.attr("href")?Mercury.tooltip(t,'<a href="'+t.attr("href")+'" target="_blank">'+t.attr("href")+"</a>",{position:"below"}):Mercury.tooltip.hide()):void 0}),this.element.on("dragenter",function(t){return e.previewing?void 0:(Mercury.snippet||t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("dragover",function(t){return e.previewing?void 0:(Mercury.snippet||t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy",jQuery.browser.webkit?(clearTimeout(e.dropTimeout),e.dropTimeout=setTimeout(function(){return e.element.trigger("possible:drop")},10)):void 0)}),this.element.on("drop",function(t){return!e.previewing&&(clearTimeout(e.dropTimeout),e.dropTimeout=setTimeout(function(){return e.element.trigger("possible:drop")},1),t.originalEvent.dataTransfer.files.length)?(t.preventDefault(),e.focus(),Mercury.uploader(t.originalEvent.dataTransfer.files[0])):void 0}),this.element.on("possible:drop",function(){var t;if(!e.previewing)return(t=e.element.find("img[data-snippet]").get(0))?(e.focus(),Mercury.Snippet.displayOptionsFor(jQuery(t).data("snippet"),{},jQuery(t).data("options")),e.document.execCommand("undo",!1,null)):void 0}),this.element.on("paste",function(t){if(!e.previewing&&Mercury.region===e){if(e.specialContainer)return t.preventDefault(),void 0;if(!e.pasting)return Mercury.changes=!0,e.handlePaste(t.originalEvent)}}),this.element.on("focus",function(){return e.previewing?void 0:(Mercury.region=e,setTimeout(function(){return e.selection().forceSelection(e.element.get(0))},1),Mercury.trigger("region:focused",{region:e}))}),this.element.on("blur",function(){return e.previewing?void 0:(Mercury.trigger("region:blurred",{region:e}),Mercury.tooltip.hide())}),this.element.on("click",function(t){return e.previewing?jQuery(t.target).closest("a").attr("target","_parent"):void 0}),this.element.on("dblclick",function(t){var i;if(!e.previewing)return i=jQuery(t.target).closest("img",e.element),i.length?(e.selection().selectNode(i.get(0),!0),Mercury.trigger("button",{action:"insertMedia"})):void 0}),this.element.on("mouseup",function(){return e.previewing?void 0:(e.pushHistory(),Mercury.trigger("region:update",{region:e}))}),this.element.on("keydown",function(t){var i;if(!e.previewing){switch(t.keyCode){case 90:if(!t.metaKey)return;return t.preventDefault(),t.shiftKey?e.execCommand("redo"):e.execCommand("undo"),void 0;case 13:jQuery.browser.webkit&&0===e.selection().commonAncestor().closest("li, ul, ol",e.element).length?(t.preventDefault(),e.document.execCommand("insertParagraph",!1,null)):(e.specialContainer||jQuery.browser.opera)&&(t.preventDefault(),e.document.execCommand("insertHTML",!1,"<br/>"));break;case 9:t.preventDefault(),i=e.selection().commonAncestor(),i.closest("li",e.element).length?t.shiftKey?i.parents("ul, ol").length>1&&e.execCommand("outdent"):e.execCommand("indent"):e.execCommand("insertHTML",{value:"&nbsp;&nbsp;"})}if(t.metaKey)switch(t.keyCode){case 66:e.execCommand("bold"),t.preventDefault();break;case 73:e.execCommand("italic"),t.preventDefault();break;case 85:e.execCommand("underline"),t.preventDefault()}return e.pushHistory(t.keyCode)}}),this.element.on("keyup",function(){return e.previewing?void 0:(Mercury.trigger("region:update",{region:e}),Mercury.changes=!0)})},n.prototype.focus=function(){var e,t=this;if(Mercury.region!==this){setTimeout(function(){return t.element.focus()},10);try{this.selection().selection.collapseToStart()}catch(i){e=i}}else setTimeout(function(){return t.element.focus()},10);return Mercury.trigger("region:focused",{region:this}),Mercury.trigger("region:update",{region:this})},n.prototype.content=function(e,t,i){var n,s,o,r,a,l,c,u,h,d,p,f,m,g;if(null==e&&(e=null),null==t&&(t=!0),null==i&&(i=!1),null!==e){for(n=jQuery("<div>").appendTo(this.document.createDocumentFragment()),n.html(e),m=n.find("[data-snippet]"),h=0,p=m.length;p>h;h++)if(o=m[h],o.contentEditable=!1,o=jQuery(o),c=Mercury.Snippet.find(o.data("snippet")))if(o.data("version"))c.setVersion(o.data("version"));else try{u=parseInt(o.html().match(/\/(\d+)\]/)[1]),u&&(c.setVersion(u),o.attr({"data-version":u}),o.html(c.data))}catch(v){r=v}return this.element.html(n.html()),this.selection().selectMarker(this.element)}if(this.element.find("meta").remove(),i&&(l=this.selection(),l.placeMarker()),n=jQuery("<div>").appendTo(this.document.createDocumentFragment()),n.html(this.element.html().replace(/^\s+|\s+$/g,"")),t)for(g=n.find("[data-snippet]"),a=d=0,f=g.length;f>d;a=++d)o=g[a],o=jQuery(o),(c=Mercury.Snippet.find(o.data("snippet")))&&(c.data=o.html()),o.html("["+o.data("snippet")+"/"+o.data("version")+"]"),o.attr({contenteditable:null,"data-version":null});return s=n.html(),i&&l.removeMarker(),s},n.prototype.togglePreview=function(){return this.previewing?(this.element.get(0).contentEditable=!0,this.element.css({overflow:"auto"})):(this.content(this.content()),this.element.get(0).contentEditable=!1,this.element.css({overflow:this.element.data("originalOverflow")}),this.element.blur()),n.__super__.togglePreview.apply(this,arguments)},n.prototype.execCommand=function(e,t){var i,s,o;if(null==t&&(t={}),n.__super__.execCommand.apply(this,arguments),s=Mercury.config.behaviors[e]||Mercury.Regions.Full.actions[e])s.call(this,this.selection(),t);else{"indent"===e&&(o=this.element.get(0).previousSibling),"insertHTML"===e&&t.value&&t.value.get&&(t.value=jQuery("<div>").html(t.value).html());try{this.document.execCommand(e,!1,t.value)}catch(r){i=r,"indent"===e&&this.element.prev()!==o&&this.element.prev().remove()}}return this.element.find("img").one("error",function(){return jQuery(this).attr({src:"/assets/mercury/missing-image.png",title:"Image not found"})})},n.prototype.pushHistory=function(e){var t,i,n,s=this;return t=[13,46,8],n=2.5,e&&(i=t.indexOf(e)),clearTimeout(this.historyTimeout),i>=0&&i!==this.lastKnownKeyCode?this.history.push(this.content(null,!1,!0)):e?this.historyTimeout=setTimeout(function(){return s.history.push(s.content(null,!1,!0))},1e3*n):this.history.push(this.content(null,!1,!0)),this.lastKnownKeyCode=i},n.prototype.selection=function(){return new Mercury.Regions.Full.Selection(this.window.getSelection(),this.document)},n.prototype.path=function(){var e;return e=this.selection().commonAncestor(),e?e.get(0)===this.element.get(0)?[]:e.parentsUntil(this.element):[]},n.prototype.currentElement=function(){var e,t;return e=[],t=this.selection(),t.range&&(e=t.commonAncestor(),3===e.get(0).nodeType&&(e=e.parent())),e},n.prototype.handlePaste=function(e){var t,i,n=this;return"text"===Mercury.config.pasting.sanitize&&e.clipboardData?(this.execCommand("insertHTML",{value:e.clipboardData.getData("text/plain")}),e.preventDefault(),void 0):(i=this.selection(),i.placeMarker(),t=jQuery("#mercury_sanitizer",this.document).focus(),setTimeout(function(){var e;return e=n.sanitize(t),i.selectMarker(n.element),i.removeMarker(),n.element.focus(),n.execCommand("insertHTML",{value:e})},1))},n.prototype.sanitize=function(e){var t,n,s,o,r,a,l,c,u,h,d,p,f,m;if(e.find("["+Mercury.config.regions.attribute+"]").remove(),e.find('[src*="webkit-fake-url://"]').remove(),Mercury.config.pasting.sanitize)switch(Mercury.config.pasting.sanitize){case"blacklist":e.find("[style]").removeAttr("style"),e.find('[class="Apple-style-span"]').removeClass("Apple-style-span"),r=e.html();break;case"whitelist":for(d=e.find("*"),l=0,u=d.length;u>l;l++){a=d[l],t=!1,p=Mercury.config.pasting.whitelist;for(s in p)if(n=p[s],a.tagName.toLowerCase()===s.toLowerCase()){for(t=!0,f=jQuery(a.attributes),c=0,h=f.length;h>c;c++)o=f[c],m=o.name,i.call(n,m)<0&&jQuery(a).removeAttr(o.name);break}t||jQuery(a).replaceWith(jQuery(a).contents())}r=e.html();break;default:r=e.text()}else r=e.html(),(r.indexOf("<!--StartFragment-->")>-1||r.indexOf('="mso-')>-1||r.indexOf("<o:")>-1||r.indexOf('="Mso')>-1)&&(r=e.text());return e.html(""),r},n.actions={insertRowBefore:function(){return Mercury.tableEditor.addRow("before")},insertRowAfter:function(){return Mercury.tableEditor.addRow("after")},insertColumnBefore:function(){return Mercury.tableEditor.addColumn("before")},insertColumnAfter:function(){return Mercury.tableEditor.addColumn("after")},deleteColumn:function(){return Mercury.tableEditor.removeColumn()},deleteRow:function(){return Mercury.tableEditor.removeRow()},increaseColspan:function(){return Mercury.tableEditor.increaseColspan()},decreaseColspan:function(){return Mercury.tableEditor.decreaseColspan()},increaseRowspan:function(){return Mercury.tableEditor.increaseRowspan()},decreaseRowspan:function(){return Mercury.tableEditor.decreaseRowspan()},undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},horizontalRule:function(){return this.execCommand("insertHTML",{value:"<hr/>"})},removeFormatting:function(e){return e.insertTextNode(e.textContent())},backColor:function(e,t){return e.wrap('<span style="background-color:'+t.value.toHex()+'">',!0)},overline:function(e){return e.wrap('<span style="text-decoration:overline">',!0)},style:function(e,t){return e.wrap('<span class="'+t.value+'">',!0)},replaceHTML:function(e,t){return this.content(t.value)},insertImage:function(e,t){return this.execCommand("insertHTML",{value:jQuery("<img/>",t.value)})},insertTable:function(e,t){return this.execCommand("insertHTML",{value:t.value})},insertLink:function(e,t){var i;return i=jQuery("<"+t.value.tagName+">",this.document).attr(t.value.attrs).html(t.value.content),e.insertNode(i)},replaceLink:function(e,t){var i,n;return i=jQuery("<"+t.value.tagName+">",this.document).attr(t.value.attrs).html(t.value.content),e.selectNode(t.node),n=jQuery("<div>").html(e.content()).find("a").html(),e.replace(jQuery(i,e.context).html(n))},insertSnippet:function(e,t){var i,n;return n=t.value,(i=this.element.find("[data-snippet="+n.identity+"]")).length&&e.selectNode(i.get(0)),e.insertNode(n.getHTML(this.document))},editSnippet:function(){var e;if(this.snippet)return e=Mercury.Snippet.find(this.snippet.data("snippet")),e.displayOptions()},removeSnippet:function(){return this.snippet&&this.snippet.remove(),Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0})}},n}(Mercury.Region),Mercury.Regions.Full.Selection=function(){function e(e,t){this.selection=e,this.context=t,this.selection.rangeCount>=1&&(this.range=this.selection.getRangeAt(0),this.fragment=this.range.cloneContents(),this.clone=this.range.cloneRange(),this.collapsed=this.selection.isCollapsed)}return e.prototype.commonAncestor=function(e){var t;return null==e&&(e=!1),this.range?(t=this.range.commonAncestorContainer,3===t.nodeType&&e&&(t=t.parentNode),jQuery(t)):null},e.prototype.wrap=function(e,t){return null==t&&(t=!1),e=jQuery(e,this.context).html(this.fragment),t&&this.replace(e),e},e.prototype.textContent=function(){return this.content().textContent},e.prototype.htmlContent=function(){var e;return e=this.content(),jQuery("<div>").html(e).html()},e.prototype.content=function(){return this.range.cloneContents()},e.prototype.is=function(e){var t;return t=this.content(),1===jQuery(t).length&&jQuery(t.firstChild).is(e)?jQuery(t.firstChild):!1},e.prototype.forceSelection=function(e){var t,i;if(jQuery.browser.webkit)return i=this.context.createRange(),this.range?this.commonAncestor(!0).closest("[data-snippet]").length&&(t=this.context.createTextNode("\0"),e.appendChild(t)):e.lastChild&&3===e.lastChild.nodeType&&""===e.lastChild.textContent.replace(/^[\s+|\n+]|[\s+|\n+]$/,"")?(t=e.lastChild,e.lastChild.textContent="\0"):(t=this.context.createTextNode("\0"),e.appendChild(t)),t?(i.setStartBefore(t),i.setEndBefore(t),this.selection.addRange(i)):void 0},e.prototype.selectMarker=function(e){var t,i;return t=e.find("em.mercury-marker"),t.length?(i=this.context.createRange(),i.setStartBefore(t.get(0)),t.length>=2&&i.setEndBefore(t.get(1)),t.remove(),this.selection.removeAllRanges(),this.selection.addRange(i)):void 0},e.prototype.placeMarker=function(){var e,t;if(this.range)return this.startMarker=jQuery('<em class="mercury-marker"/>',this.context).get(0),this.endMarker=jQuery('<em class="mercury-marker"/>',this.context).get(0),e=this.range.cloneRange(),e.collapse(!1),e.insertNode(this.endMarker),this.range.collapsed||(t=this.range.cloneRange(),t.collapse(!0),t.insertNode(this.startMarker)),this.selection.removeAllRanges(),this.selection.addRange(this.range)},e.prototype.removeMarker=function(){return jQuery(this.startMarker).remove(),jQuery(this.endMarker).remove()},e.prototype.insertTextNode=function(e){var t;return t=this.context.createTextNode(e),this.range.extractContents(),this.range.insertNode(t),this.range.selectNodeContents(t),this.selection.addRange(this.range)},e.prototype.insertNode=function(e){return e.get&&(e=e.get(0)),"string"===jQuery.type(e)&&(e=jQuery(e,this.context).get(0)),this.range.deleteContents(),this.range.insertNode(e),this.range.selectNodeContents(e),this.selection.addRange(this.range)},e.prototype.selectNode=function(e,t){return null==t&&(t=!1),this.range.selectNode(e),t&&this.selection.removeAllRanges(),this.selection.addRange(this.range)},e.prototype.replace=function(e,t){return e.get&&(e=e.get(0)),"string"===jQuery.type(e)&&(e=jQuery(e,this.context).get(0)),this.range.deleteContents(),this.range.insertNode(e),this.range.selectNodeContents(e),this.selection.addRange(this.range),t?this.range.collapse(!1):void 0},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.Regions.Image=function(e){function i(e,t,n){this.element=e,this.window=t,this.options=null!=n?n:{},i.__super__.constructor.apply(this,arguments)}var n;return t(i,e),i.supported=document.getElementById,i.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",n="image",i.prototype.type=function(){return n},i.prototype.bindEvents=function(){var e=this;return Mercury.on("mode",function(t,i){return"preview"===i.mode?e.togglePreview():void 0}),Mercury.on("focus:frame",function(){return e.previewing||Mercury.region!==e?void 0:e.focus()}),Mercury.on("action",function(t,i){return e.previewing||Mercury.region!==e?void 0:i.action?e.execCommand(i.action,i):void 0}),this.element.on("dragenter",function(t){return e.previewing?void 0:(t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("dragover",function(t){return e.previewing?void 0:(t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("drop",function(t){return e.previewing?void 0:t.originalEvent.dataTransfer.files.length?(t.preventDefault(),e.focus(),Mercury.uploader(t.originalEvent.dataTransfer.files[0])):void 0}),this.element.on("focus",function(){return e.focus()})},i.prototype.togglePreview=function(){return this.previewing?(this.previewing=!1,this.element.attr(Mercury.config.regions.attribute,n),this.build()):(this.previewing=!0,this.element.removeAttr(Mercury.config.regions.attribute),Mercury.trigger("region:blurred",{region:this}))},i.prototype.focus=function(){return this.previewing?void 0:(Mercury.region=this,Mercury.trigger("region:focused",{region:this}),Mercury.trigger("region:update",{region:this}))},i.prototype.execCommand=function(e,t){var n;return null==t&&(t={}),i.__super__.execCommand.apply(this,arguments),(n=Mercury.Regions.Image.actions[e])?n.call(this,t):void 0
},i.prototype.pushHistory=function(){return this.history.push({src:this.element.attr("src")})},i.prototype.updateSrc=function(e){return this.element.attr("src",e)},i.prototype.serialize=function(){return{type:n,data:this.dataAttributes(),attributes:{src:this.element.attr("src")}}},i.actions={undo:function(){var e;return(e=this.history.undo())?this.updateSrc(e.src):void 0},redo:function(){var e;return(e=this.history.redo())?this.updateSrc(e.src):void 0},insertImage:function(e){return this.updateSrc(e.value.src)}},i}(Mercury.Region)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.Regions.Markdown=function(e){function i(e,t,n){this.element=e,this.window=t,this.options=null!=n?n:{},i.__super__.constructor.apply(this,arguments),this.converter=new Showdown.converter}var n;return t(i,e),i.supported=document.getElementById,i.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",n="markdown",i.prototype.type=function(){return n},i.prototype.build=function(){var e,t,i;return i="100%",e=this.element.height(),t=this.element.html().replace(/^\s+|\s+$/g,"").replace("&gt;",">"),this.textarea=jQuery("<textarea>",this.document).val(t).addClass("mercury-textarea"),this.textarea.css({border:0,background:"transparent",display:"block","overflow-y":"hidden",width:i,height:e,fontFamily:'"Courier New", Courier, monospace'}),this.element.empty().append(this.textarea),this.previewElement=jQuery("<div>",this.document),this.element.append(this.previewElement),this.container=this.element,this.container.data("region",this),this.element=this.textarea,this.resize()},i.prototype.dataAttributes=function(){var e,t,i,n,s;for(t={},s=Mercury.config.regions.dataAttributes,i=0,n=s.length;n>i;i++)e=s[i],t[e]=this.container.attr("data-"+e);return t},i.prototype.bindEvents=function(){var e=this;return Mercury.on("mode",function(t,i){return"preview"===i.mode?e.togglePreview():void 0}),Mercury.on("focus:frame",function(){return e.previewing||Mercury.region!==e?void 0:e.focus()}),Mercury.on("action",function(t,i){return e.previewing||Mercury.region!==e?void 0:i.action?e.execCommand(i.action,i):void 0}),Mercury.on("unfocus:regions",function(){return e.previewing||Mercury.region!==e?void 0:(e.element.blur(),e.container.removeClass("focus"),Mercury.trigger("region:blurred",{region:e}))}),this.element.on("dragenter",function(t){return e.previewing?void 0:(t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("dragover",function(t){return e.previewing?void 0:(t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("drop",function(t){return e.previewing?void 0:(Mercury.snippet&&(t.preventDefault(),e.focus(),Mercury.Snippet.displayOptionsFor(Mercury.snippet.name,{},Mercury.snippet.hasOptions)),t.originalEvent.dataTransfer.files.length?(t.preventDefault(),e.focus(),Mercury.uploader(t.originalEvent.dataTransfer.files[0])):void 0)}),this.element.on("focus",function(){return e.previewing?void 0:(Mercury.region=e,e.container.addClass("focus"),Mercury.trigger("region:focused",{region:e}))}),this.element.on("keydown",function(t){var i,n,s,o,r,a;if(!e.previewing){switch(e.resize(),t.keyCode){case 90:if(!t.metaKey)return;return t.preventDefault(),t.shiftKey?e.execCommand("redo"):e.execCommand("undo"),void 0;case 13:o=e.selection(),a=e.element.val(),r=a.lastIndexOf("\n",o.start),i=a.indexOf("\n",o.end),r>i&&(i=a.length),"\n"===a[r]&&(r=a.lastIndexOf("\n",o.start-1)),"-"===a[r+1]&&(o.replace("\n- ",!1,!0),t.preventDefault()),/\d/.test(a[r+1])&&(n=a.substring(r,i),/(\d+)\./.test(n)&&(s=parseInt(RegExp.$1),o.replace("\n"+(s+=1)+". ",!1,!0),t.preventDefault()));break;case 9:t.preventDefault(),e.execCommand("insertHTML",{value:"  "})}if(t.metaKey)switch(t.keyCode){case 66:e.execCommand("bold"),t.preventDefault();break;case 73:e.execCommand("italic"),t.preventDefault();break;case 85:e.execCommand("underline"),t.preventDefault()}return e.pushHistory(t.keyCode)}}),this.element.on("keyup",function(){return e.previewing?void 0:(Mercury.changes=!0,e.resize(),Mercury.trigger("region:update",{region:e}))}),this.element.on("mouseup",function(){return e.previewing?void 0:(e.focus(),Mercury.trigger("region:focused",{region:e}))}),this.previewElement.on("click",function(t){return e.previewing?$(t.target).closest("a").attr("target","_parent"):void 0})},i.prototype.focus=function(){return this.element.focus()},i.prototype.content=function(e,t){return null==e&&(e=null),null==t&&(t=!0),null!==e?"string"===jQuery.type(e)?this.element.val(e):(this.element.val(e.html),this.selection().select(e.selection.start,e.selection.end)):this.element.val()},i.prototype.contentAndSelection=function(){return{html:this.content(null,!1),selection:this.selection().serialize()}},i.prototype.togglePreview=function(){var e;return this.previewing?(this.previewing=!1,this.container.attr(Mercury.config.regions.attribute,n),this.previewElement.hide(),this.element.show(),Mercury.region===this?this.focus():void 0):(this.previewing=!0,this.container.removeAttr(Mercury.config.regions.attribute),e=this.converter.makeHtml(this.element.val()),this.previewElement.html(e),this.previewElement.show(),this.element.hide(),Mercury.trigger("region:blurred",{region:this}))},i.prototype.execCommand=function(e,t){var n;return null==t&&(t={}),i.__super__.execCommand.apply(this,arguments),(n=Mercury.Regions.Markdown.actions[e])&&n.call(this,this.selection(),t),this.resize()},i.prototype.pushHistory=function(e){var t,i,n,s=this;return t=[13,46,8],n=2.5,e&&(i=t.indexOf(e)),clearTimeout(this.historyTimeout),i>=0&&i!==this.lastKnownKeyCode?this.history.push(this.contentAndSelection()):e?this.historyTimeout=setTimeout(function(){return s.history.push(s.contentAndSelection())},1e3*n):this.history.push(this.contentAndSelection()),this.lastKnownKeyCode=i},i.prototype.selection=function(){return new Mercury.Regions.Markdown.Selection(this.element)},i.prototype.resize=function(){return this.element.css({height:this.element.get(0).scrollHeight-100}),this.element.css({height:this.element.get(0).scrollHeight})},i.prototype.snippets=function(){},i.actions={undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},insertHTML:function(e,t){var i;return t.value.get&&(i=t.value.get(0))&&(t.value=jQuery("<div>").html(i).html()),e.replace(t.value,!1,!0)},insertImage:function(e,t){return e.replace("![add alt text]("+encodeURI(t.value.src)+")",!0)},insertTable:function(e,t){return e.replace(t.value.replace(/<br>|<br\/>/gi,""),!1,!0)},insertLink:function(e,t){return e.replace("["+t.value.content+"]("+t.value.attrs.href+" 'optional title')",!0)},insertUnorderedList:function(e){return e.addList("unordered")},insertOrderedList:function(e){return e.addList("ordered")},style:function(e,t){return e.wrap('<span class="'+t.value+'">',"</span>")},formatblock:function(e,t){var i,n,s;s={h1:["# "," #"],h2:["## "," ##"],h3:["### "," ###"],h4:["#### "," ####"],h5:["##### "," #####"],h6:["###### "," ######"],pre:["    ",""],blockquote:["> ",""],p:["\n","\n"]};for(n in s)i=s[n],e.unWrapLine(""+i[0],""+i[1]);return"blockquote"===t.value?(Mercury.Regions.Markdown.actions.indent.call(this,e,t),void 0):e.wrapLine(""+s[t.value][0],""+s[t.value][1])},bold:function(e){return e.wrap("**","**")},italic:function(e){return e.wrap("_","_")},subscript:function(e){return e.wrap("<sub>","</sub>")},superscript:function(e){return e.wrap("<sup>","</sup>")},indent:function(e){return e.wrapLine("> ","",!1,!0)},outdent:function(e){return e.unWrapLine("> ","",!1,!0)},horizontalRule:function(e){return e.replace("\n- - -\n")},insertSnippet:function(e,t){var i;return i=t.value,e.replace(i.getText())}},i}(Mercury.Region),Mercury.Regions.Markdown.Selection=function(){function e(e){this.element=e,this.el=this.element.get(0),this.getDetails()}return e.prototype.serialize=function(){return{start:this.start,end:this.end}},e.prototype.getDetails=function(){return this.length=this.el.selectionEnd-this.el.selectionStart,this.start=this.el.selectionStart,this.end=this.el.selectionEnd,this.text=this.element.val().substr(this.start,this.length)},e.prototype.replace=function(e,t,i){var n,s,o;return null==t&&(t=!1),null==i&&(i=!1),this.getDetails(),o=this.element.val(),s=this.element.val(),this.element.val(o.substr(0,this.start)+e+o.substr(this.end,o.length)),n=this.element.val()!==s,t&&this.select(this.start,this.start+e.length),i&&this.select(this.start+e.length,this.start+e.length),n},e.prototype.select=function(e,t){return this.start=e,this.end=t,this.element.focus(),this.el.selectionStart=this.start,this.el.selectionEnd=this.end,this.getDetails()},e.prototype.wrap=function(e,t){return this.getDetails(),this.deselectNewLines(),this.replace(e+this.text+t,""!==this.text),""===this.text?this.select(this.start+e.length,this.start+e.length):void 0},e.prototype.wrapLine=function(e,t,i,n){var s,o,r,a;return null==i&&(i=!0),null==n&&(n=!1),this.getDetails(),o=this.serialize(),a=this.element.val(),r=a.lastIndexOf("\n",this.start),s=a.indexOf("\n",this.end),r>s&&(s=a.length),"\n"===a[r]&&(r=a.lastIndexOf("\n",this.start-1)),this.select(r+1,s),this.replace(e+this.text+t,i),n?this.select(o.start+e.length,o.end+e.length):void 0},e.prototype.unWrapLine=function(e,t,i,n){var s,o,r,a,l,c,u;return null==i&&(i=!0),null==n&&(n=!1),this.getDetails(),l=this.serialize(),u=this.element.val(),c=u.lastIndexOf("\n",this.start),o=u.indexOf("\n",this.end),c>o&&(o=u.length),"\n"===u[c]&&(c=u.lastIndexOf("\n",this.start-1)),this.select(c+1,o),window.something=this.text,r=new RegExp("^"+e.regExpEscape()),a=new RegExp(""+t.regExpEscape()+"$"),s=this.replace(this.text.replace(r,"").replace(a,""),i),n&&s?this.select(l.start-e.length,l.end-e.length):void 0},e.prototype.addList=function(e){var t,i,n,s,o,r;return r=this.element.val(),o=r.lastIndexOf("\n",this.start),t=r.indexOf("\n",this.end),o>t&&(t=r.length),"\n"===r[o]&&(o=r.lastIndexOf("\n",this.start-1)),this.select(o+1,t),s=this.text.split("\n"),"unordered"===e?this.replace("- "+s.join("\n- "),!0):this.replace(function(){var e,t,o;for(o=[],i=e=0,t=s.length;t>e;i=++e)n=s[i],o.push(""+(i+1)+". "+n);return o}().join("\n"),!0)},e.prototype.deselectNewLines=function(){var e,t;return t=this.text,e=t.replace(/\n+$/g,"").length,this.select(this.start,this.start+e)},e.prototype.placeMarker=function(){return this.wrap("[mercury-marker]","[mercury-marker]")},e.prototype.removeMarker=function(){var e,t,i;return i=this.element.val(),t=i.indexOf("[mercury-marker]"),t>-1?(e=i.indexOf("[mercury-marker]",t+1)-"[mercury-marker]".length,this.element.val(this.element.val().replace(/\[mercury-marker\]/g,"")),this.select(t,e)):void 0},e.prototype.textContent=function(){return this.text},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.Regions.Simple=function(e){function i(e,t,s){this.element=e,this.window=t,this.options=null!=s?s:{},Mercury.log("building "+n,this.element,this.options),i.__super__.constructor.apply(this,arguments)}var n;return t(i,e),i.supported=document.getElementById,i.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",n="simple",i.prototype.type=function(){return n},i.prototype.build=function(){var e,t,i;return"block"===this.element.css("display")?(i="100%",e=this.element.height()):(i=this.element.width(),e=this.element.height()),t=this.element.text(),this.textarea=jQuery("<textarea>",this.document).val(t).addClass("mercury-textarea"),this.textarea.css({border:0,background:"transparent","overflow-y":"hidden",width:i,height:e,fontFamily:"inherit",fontSize:"inherit",fontWeight:"inherit",fontStyle:"inherit",color:"inherit","min-height":0,padding:"0",margin:0,"border-radius":0,display:"inherit",lineHeight:"inherit",textAlign:"inherit"}),this.element.empty().append(this.textarea),this.container=this.element,this.container.data("region",this),this.element=this.textarea,this.resize()},i.prototype.bindEvents=function(){var e=this;return Mercury.on("mode",function(t,i){return"preview"===i.mode?e.togglePreview():void 0}),Mercury.on("focus:frame",function(){return e.previewing||Mercury.region!==e?void 0:e.focus()}),Mercury.on("action",function(t,i){return e.previewing||Mercury.region!==e?void 0:i.action?e.execCommand(i.action,i):void 0}),Mercury.on("unfocus:regions",function(){return e.previewing||Mercury.region!==e?void 0:(e.element.blur(),e.container.removeClass("focus"),Mercury.trigger("region:blurred",{region:e}))}),this.bindElementEvents()},i.prototype.bindElementEvents=function(){var e=this;return this.element.on("focus",function(){return e.previewing?void 0:(Mercury.region=e,e.container.addClass("focus"),Mercury.trigger("region:focused",{region:e}))}),this.element.on("keydown",function(t){var i,n,s,o,r,a;if(!e.previewing){switch(e.resize(),t.keyCode){case 90:if(!t.metaKey)return;return t.preventDefault(),t.shiftKey?e.execCommand("redo"):e.execCommand("undo"),void 0;case 13:o=e.selection(),a=e.element.val(),r=a.lastIndexOf("\n",o.start),i=a.indexOf("\n",o.end),r>i&&(i=a.length),"\n"===a[r]&&(r=a.lastIndexOf("\n",o.start-1)),"-"===a[r+1]&&o.replace("\n- ",!1,!0),/\d/.test(a[r+1])&&(n=a.substring(r,i),/(\d+)\./.test(n)&&(s=parseInt(RegExp.$1),o.replace("\n"+(s+=1)+". ",!1,!0))),t.preventDefault();break;case 9:t.preventDefault(),e.execCommand("insertHTML",{value:"  "})}return e.pushHistory(t.keyCode)}}),this.element.on("keyup",function(){return e.previewing?void 0:(Mercury.changes=!0,e.resize(),Mercury.trigger("region:update",{region:e}))}),this.element.on("mouseup",function(){return e.previewing?void 0:(e.focus(),Mercury.trigger("region:focused",{region:e}))}),this.element.on("paste",function(t){if(!e.previewing&&Mercury.region===e){if(e.specialContainer)return t.preventDefault(),void 0;if(!e.pasting)return Mercury.changes=!0,e.handlePaste(t.originalEvent)}})},i.prototype.handlePaste=function(e){this.execCommand("insertHTML",{value:e.clipboardData.getData("text/plain").replace(/\n/g," ")}),e.preventDefault()},i.prototype.path=function(){return[this.container.get(0)]},i.prototype.focus=function(){return this.element.focus()},i.prototype.content=function(e,t){return null==e&&(e=null),null==t&&(t=!0),null!==e?"string"===jQuery.type(e)?this.element.val(e):(this.element.val(e.html),this.selection().select(e.selection.start,e.selection.end)):this.element.val()},i.prototype.contentAndSelection=function(){return{html:this.content(null,!1),selection:this.selection().serialize()}},i.prototype.togglePreview=function(){var e;return this.previewing?(this.previewing=!1,this.element=this.container,this.container.attr(Mercury.config.regions.attribute,n),this.build(),this.bindElementEvents(),Mercury.region===this?this.focus():void 0):(this.previewing=!0,e=jQuery("<div></div>").text(this.element.val()).html(),this.container.removeAttr(Mercury.config.regions.attribute),this.container.html(e),Mercury.trigger("region:blurred",{region:this}))},i.prototype.execCommand=function(e,t){var n;return null==t&&(t={}),i.__super__.execCommand.apply(this,arguments),(n=Mercury.Regions.Simple.actions[e])&&n.call(this,this.selection(),t),this.resize()},i.prototype.pushHistory=function(e){var t,i,n,s=this;return t=[13,46,8],n=2.5,e&&(i=t.indexOf(e)),clearTimeout(this.historyTimeout),i>=0&&i!==this.lastKnownKeyCode?this.history.push(this.contentAndSelection()):e?this.historyTimeout=setTimeout(function(){return s.history.push(s.contentAndSelection())},1e3*n):this.history.push(this.contentAndSelection()),this.lastKnownKeyCode=i},i.prototype.selection=function(){return new Mercury.Regions.Simple.Selection(this.element)},i.prototype.resize=function(){return this.element.css({height:this.element.get(0).scrollHeight-100}),this.element.css({height:this.element.get(0).scrollHeight})},i.prototype.snippets=function(){},i.actions={undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},insertHTML:function(e,t){var i;return t.value.get&&(i=t.value.get(0))&&(t.value=jQuery("<div>").html(i).html()),e.replace(t.value,!1,!0)}},i}(Mercury.Region),Mercury.Regions.Simple.Selection=function(){function e(e){this.element=e,this.el=this.element.get(0),this.getDetails()}return e.prototype.serialize=function(){return{start:this.start,end:this.end}},e.prototype.getDetails=function(){return this.length=this.el.selectionEnd-this.el.selectionStart,this.start=this.el.selectionStart,this.end=this.el.selectionEnd,this.text=this.element.val().substr(this.start,this.length)},e.prototype.replace=function(e,t,i){var n,s,o;return null==t&&(t=!1),null==i&&(i=!1),this.getDetails(),o=this.element.val(),s=this.element.val(),this.element.val(o.substr(0,this.start)+e+o.substr(this.end,o.length)),n=this.element.val()!==s,t&&this.select(this.start,this.start+e.length),i&&this.select(this.start+e.length,this.start+e.length),n},e.prototype.select=function(e,t){return this.start=e,this.end=t,this.element.focus(),this.el.selectionStart=this.start,this.el.selectionEnd=this.end,this.getDetails()},e.prototype.wrap=function(e,t){return this.getDetails(),this.deselectNewLines(),this.replace(e+this.text+t,""!==this.text),""===this.text?this.select(this.start+e.length,this.start+e.length):void 0},e.prototype.deselectNewLines=function(){var e,t;return t=this.text,e=t.replace(/\n+$/g,"").length,this.select(this.start,this.start+e)},e.prototype.placeMarker=function(){return this.wrap("[mercury-marker]","[mercury-marker]")},e.prototype.removeMarker=function(){var e,t,i;return i=this.element.val(),t=i.indexOf("[mercury-marker]"),t>-1?(e=i.indexOf("[mercury-marker]",t+1)-"[mercury-marker]".length,this.element.val(this.element.val().replace(/\[mercury-marker\]/g,"")),this.select(t,e)):void 0},e.prototype.textContent=function(){return this.text},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.Regions.Snippets=function(e){function i(e,t,s){this.element=e,this.window=t,this.options=null!=s?s:{},Mercury.log("building "+n,this.element,this.options),i.__super__.constructor.apply(this,arguments),this.makeSortable()}var n;return t(i,e),i.supported=document.getElementById,i.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",n="snippets",i.prototype.type=function(){return n},i.prototype.build=function(){var e,t,i,n;for(n=this.element.find("[data-snippet]"),t=0,i=n.length;i>t;t++)e=n[t],jQuery(e).attr("data-version",0);return"0px"===this.element.css("minHeight")?this.element.css({minHeight:20}):void 0},i.prototype.bindEvents=function(){var e=this;return i.__super__.bindEvents.apply(this,arguments),Mercury.on("unfocus:regions",function(){return e.previewing?void 0:Mercury.region===e?(e.element.removeClass("focus"),e.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:e})):void 0}),Mercury.on("focus:window",function(){return e.previewing?void 0:Mercury.region===e?(e.element.removeClass("focus"),e.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:e})):void 0}),this.element.on("mouseup",function(){return e.previewing?void 0:(e.focus(),Mercury.trigger("region:focused",{region:e}))}),this.element.on("dragover",function(t){return e.previewing?void 0:(t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("drop",function(t){return!e.previewing&&Mercury.snippet?(e.focus(),t.preventDefault(),Mercury.Snippet.displayOptionsFor(Mercury.snippet.name,{},Mercury.snippet.hasOptions)):void 0}),jQuery(this.document).on("keydown",function(t){if(!e.previewing&&Mercury.region===e)switch(t.keyCode){case 90:if(!t.metaKey)return;return t.preventDefault(),t.shiftKey?e.execCommand("redo"):e.execCommand("undo")}}),jQuery(this.document).on("keyup",function(){return e.previewing||Mercury.region!==e?void 0:Mercury.changes=!0})},i.prototype.focus=function(){return Mercury.region=this,this.makeSortable(),this.element.addClass("focus")},i.prototype.togglePreview=function(){return this.previewing?this.makeSortable():(this.element.sortable("destroy"),this.element.removeClass("focus")),i.__super__.togglePreview.apply(this,arguments)},i.prototype.execCommand=function(e,t){var n;return null==t&&(t={}),i.__super__.execCommand.apply(this,arguments),(n=Mercury.Regions.Snippets.actions[e])?n.call(this,t):void 0},i.prototype.makeSortable=function(){var e=this;return this.element.sortable("destroy").sortable({document:this.document,scroll:!1,containment:"parent",items:"[data-snippet]",opacity:.4,revert:100,tolerance:"pointer",beforeStop:function(){return Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0}),!0},stop:function(){return setTimeout(function(){return e.pushHistory()},100),!0}})},i.actions={undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},insertSnippet:function(e){var t,i,n=this;return i=e.value,(t=this.element.find("[data-snippet="+i.identity+"]")).length?t.replaceWith(i.getHTML(this.document,function(){return n.pushHistory()})):this.element.append(i.getHTML(this.document,function(){return n.pushHistory()}))},editSnippet:function(){var e;if(this.snippet)return e=Mercury.Snippet.find(this.snippet.data("snippet")),e.displayOptions()},removeSnippet:function(){return this.snippet&&this.snippet.remove(),Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0})}},i}(Mercury.Region)}.call(this),function(){this.Mercury.dialogHandlers.backColor=function(){var e=this;return this.element.find(".picker, .last-picked").on("click",function(t){var i;return i=jQuery(t.target).css("background-color"),e.element.find(".last-picked").css({background:i}),e.button.css({backgroundColor:i}),Mercury.trigger("action",{action:"backColor",value:i})})}}.call(this),function(){this.Mercury.dialogHandlers.foreColor=function(){var e=this;return this.element.find(".picker, .last-picked").on("click",function(t){var i;return i=jQuery(t.target).css("background-color").toHex(),e.element.find(".last-picked").css({background:i}),e.button.css({backgroundColor:i}),Mercury.trigger("action",{action:"foreColor",value:i})})}}.call(this),function(){this.Mercury.dialogHandlers.formatblock=function(){return this.element.find("[data-tag]").on("click",function(e){var t;return t=jQuery(e.target).data("tag"),Mercury.trigger("action",{action:"formatblock",value:t})})}}.call(this),function(){this.Mercury.dialogHandlers.snippetPanel=function(){var e=this;return this.element.find("input.filter").on("keyup",function(){var t,i,n,s,o,r;for(i=e.element.find("input.filter").val(),o=e.element.find("li[data-filter]"),r=[],n=0,s=o.length;s>n;n++)t=o[n],0===LiquidMetal.score(jQuery(t).data("filter"),i)?r.push(jQuery(t).hide()):r.push(jQuery(t).show());return r}),this.element.find("img[data-snippet]").on("dragstart",function(){return Mercury.snippet={name:jQuery(this).data("snippet"),hasOptions:!(jQuery(this).data("options")===!1)}})}}.call(this),function(){this.Mercury.dialogHandlers.style=function(){return this.element.find("[data-class]").on("click",function(e){var t;return t=jQuery(e.target).data("class"),Mercury.trigger("action",{action:"style",value:t})})}}.call(this),function(){this.Mercury.modalHandlers.htmlEditor=function(){var e,t=this;return e=Mercury.region.content(null,!0,!1),this.element.find("textarea").val(e),this.element.find("form").on("submit",function(e){var i;return e.preventDefault(),i=t.element.find("textarea").val(),Mercury.trigger("action",{action:"replaceHTML",value:i}),t.hide()})}}.call(this),function(){this.Mercury.modalHandlers.insertCharacter=function(){var e=this;return this.element.find(".character").on("click",function(t){return Mercury.trigger("action",{action:"insertHTML",value:"&"+jQuery(t.target).attr("data-entity")+";"}),e.hide()})}}.call(this),function(){this.Mercury.modalHandlers.insertLink={initialize:function(){var e=this;return this.editing=!1,this.content=null,this.element.find(".control-label input").on("click",this.onLabelChecked),this.element.find(".controls .optional, .controls .required").on("focus",this.onInputFocused),this.element.find("#link_target").on("change",function(){return e.onChangeTarget()}),this.initializeForm(),this.element.find("form").on("submit",function(t){return t.preventDefault(),e.validateForm(),e.valid?(e.submitForm(),e.hide()):(e.resize(),void 0)})},initializeForm:function(){var e,t,i,n,s,o;return this.fillExistingBookmarks(),Mercury.region&&Mercury.region.selection?(o=Mercury.region.selection(),o.textContent&&this.element.find("#link_text").val(o.textContent()),o&&o.commonAncestor&&(e=o.commonAncestor(!0).closest("a")),o.htmlContent&&(n=/<img/.test(o.htmlContent())),n||e&&e.length?(this.element.find("#link_text_container").hide(),n&&(this.content=o.htmlContent()),e&&e.length?(this.editing=e,e.attr("href")&&0===e.attr("href").indexOf("#")?(t=this.element.find("#link_existing_bookmark"),t.val(e.attr("href").replace(/[^#]*#/,"")),t.closest(".control-group").find("input[type=radio]").prop("checked",!0)):this.element.find("#link_external_url").val(e.attr("href")),e.attr("name")&&(s=this.element.find("#link_new_bookmark"),s.val(e.attr("name")),s.closest(".control-group").find("input[type=radio]").prop("checked",!0)),e.attr("target")&&this.element.find("#link_target").val(e.attr("target")),e.attr("href")&&0===e.attr("href").indexOf("javascript:void")?(i=e.attr("href"),this.element.find("#link_external_url").val(i.match(/window.open\('([^']+)',/)[1]),this.element.find("#link_target").val("popup"),this.element.find("#link_popup_width").val(i.match(/width=(\d+),/)[1]),this.element.find("#link_popup_height").val(i.match(/height=(\d+),/)[1]),this.element.find("#popup_options").show()):void 0):!1):!1):void 0},fillExistingBookmarks:function(){var e,t,i,n,s,o;for(e=this.element.find("#link_existing_bookmark"),s=jQuery("a[name]",window.mercuryInstance.document),o=[],i=0,n=s.length;n>i;i++)t=s[i],o.push(e.append(jQuery("<option>",{value:jQuery(t).attr("name")}).text(jQuery(t).text())));return o},onLabelChecked:function(){var e;return e=jQuery(this).closest(".control-label").attr("for"),jQuery(this).closest(".control-group").find("#"+e).focus()},onInputFocused:function(){return jQuery(this).closest(".control-group").find("input[type=radio]").prop("checked",!0)},onChangeTarget:function(){return this.element.find(".link-target-options").hide(),this.element.find("#"+this.element.find("#link_target").val()+"_options").show(),this.resize(!0)},addInputError:function(e,t){return e.after('<span class="help-inline error-message">'+Mercury.I18n(t)+"</span>").closest(".control-group").addClass("error"),this.valid=!1},clearInputErrors:function(){return this.element.find(".control-group.error").removeClass("error").find(".error-message").remove(),this.valid=!0},validateForm:function(){var e,t;return this.clearInputErrors(),t=this.element.find("input[name=link_type]:checked").val(),e=this.element.find("#link_"+t),e.val()||this.addInputError(e,"can't be blank"),this.editing||this.content||(e=this.element.find("#link_text"),e.val())?void 0:this.addInputError(e,"can't be blank")},submitForm:function(){var e,t,i,n,s,o;switch(i=this.element.find("#link_text").val(),n=this.element.find("#link_target").val(),s=this.element.find("input[name=link_type]:checked").val()){case"existing_bookmark":t={href:"#"+this.element.find("#link_existing_bookmark").val()};break;case"new_bookmark":t={name:""+this.element.find("#link_new_bookmark").val()};break;default:t={href:this.element.find("#link_"+s).val()}}switch(n){case"popup":e={width:parseInt(this.element.find("#link_popup_width").val())||500,height:parseInt(this.element.find("#link_popup_height").val())||500,menubar:"no",toolbar:"no"},t.href="javascript:void(window.open('"+t.href+"', 'popup_window', '"+jQuery.param(e).replace(/&/g,",")+"'))";break;default:n&&(t.target=n)}return o={tagName:"a",attrs:t,content:this.content||i},this.editing?Mercury.trigger("action",{action:"replaceLink",value:o,node:this.editing.get(0)}):Mercury.trigger("action",{action:"insertLink",value:o})}}}.call(this),function(){this.Mercury.modalHandlers.insertMedia={initialize:function(){var e=this;return this.element.find(".control-label input").on("click",this.onLabelChecked),this.element.find(".controls .optional, .controls .required").on("focus",function(t){return e.onInputFocused($(t.target))}),this.focus("#media_image_url"),this.initializeForm(),this.element.find("form").on("submit",function(t){return t.preventDefault(),e.validateForm(),e.valid?(e.submitForm(),e.hide()):(e.resize(),void 0)})},initializeForm:function(){var e,t,i,n;if(Mercury.region&&Mercury.region.selection&&(i=Mercury.region.selection(),(t="function"==typeof i.is?i.is("img"):void 0)&&(this.element.find("#media_image_url").val(t.attr("src")),this.element.find("#media_image_alignment").val(t.attr("align")),this.element.find("#media_image_float").val(null!=t.attr("style")?t.css("float"):""),this.focus("#media_image_url")),e="function"==typeof i.is?i.is("iframe"):void 0)){if(n=e.attr("src"),/^https?:\/\/www.youtube.com\//i.test(n))return this.element.find("#media_youtube_url").val(""+n.match(/^https?/)[0]+"://youtu.be/"+n.match(/\/embed\/(\w+)/)[1]),this.element.find("#media_youtube_width").val(e.width()),this.element.find("#media_youtube_height").val(e.height()),this.focus("#media_youtube_url");if(/^https?:\/\/player.vimeo.com\//i.test(n))return this.element.find("#media_vimeo_url").val(""+n.match(/^https?/)[0]+"://vimeo.com/"+n.match(/\/video\/(\w+)/)[1]),this.element.find("#media_vimeo_width").val(e.width()),this.element.find("#media_vimeo_height").val(e.height()),this.focus("#media_vimeo_url")}},focus:function(e){var t=this;return setTimeout(function(){return t.element.find(e).focus()},300)},onLabelChecked:function(){var e;return e=jQuery(this).closest(".control-label").attr("for"),jQuery(this).closest(".control-group").find("#"+e).focus()},onInputFocused:function(e){return e.closest(".control-group").find("input[type=radio]").prop("checked",!0),e.closest(".media-options").length?void 0:(this.element.find(".media-options").hide(),this.element.find("#"+e.attr("id").replace("media_","")+"_options").show(),this.resize(!0))},addInputError:function(e,t){return e.after('<span class="help-inline error-message">'+Mercury.I18n(t)+"</span>").closest(".control-group").addClass("error"),this.valid=!1},clearInputErrors:function(){return this.element.find(".control-group.error").removeClass("error").find(".error-message").remove(),this.valid=!0},validateForm:function(){var e,t,i;switch(this.clearInputErrors(),t=this.element.find("input[name=media_type]:checked").val(),e=this.element.find("#media_"+t),t){case"youtube_url":if(i=this.element.find("#media_youtube_url").val(),!/^https?:\/\/youtu.be\//.test(i))return this.addInputError(e,"is invalid");break;case"vimeo_url":if(i=this.element.find("#media_vimeo_url").val(),!/^https?:\/\/vimeo.com\//.test(i))return this.addInputError(e,"is invalid");break;default:if(!e.val())return this.addInputError(e,"can't be blank")}},submitForm:function(){var e,t,i,n,s,o,r,a;switch(o=this.element.find("input[name=media_type]:checked").val()){case"image_url":return t={src:this.element.find("#media_image_url").val()},(e=this.element.find("#media_image_alignment").val())&&(t.align=e),(n=this.element.find("#media_image_float").val())&&(t.style="float: "+n+";"),Mercury.trigger("action",{action:"insertImage",value:t});case"youtube_url":return r=this.element.find("#media_youtube_url").val(),i=r.replace(/https?:\/\/youtu.be\//,""),s="http",/^https:/.test(r)&&(s="https"),a=jQuery("<iframe>",{width:parseInt(this.element.find("#media_youtube_width").val(),10)||560,height:parseInt(this.element.find("#media_youtube_height").val(),10)||349,src:""+s+"://www.youtube.com/embed/"+i+"?wmode=transparent",frameborder:0,allowfullscreen:"true"}),Mercury.trigger("action",{action:"insertHTML",value:a});case"vimeo_url":return r=this.element.find("#media_vimeo_url").val(),i=r.replace(/^https?:\/\/vimeo.com\//,""),s="http",/^https:/.test(r)&&(s="https"),a=jQuery("<iframe>",{width:parseInt(this.element.find("#media_vimeo_width").val(),10)||400,height:parseInt(this.element.find("#media_vimeo_height").val(),10)||225,src:""+s+"://player.vimeo.com/video/"+i+"?title=1&byline=1&portrait=0&color=ffffff",frameborder:0}),Mercury.trigger("action",{action:"insertHTML",value:a})}}}}.call(this),function(){this.Mercury.modalHandlers.insertSnippet=function(){var e=this;
return this.element.find("form").on("submit",function(t){var i,n;return t.preventDefault(),i=e.element.find("form").serializeObject(),Mercury.snippet?(n=Mercury.snippet,n.setOptions(i),Mercury.snippet=null):n=Mercury.Snippet.create(e.options.snippetName,i),Mercury.trigger("action",{action:"insertSnippet",value:n}),e.hide()})}}.call(this),function(){this.Mercury.modalHandlers.insertTable={initialize:function(){var e=this;return this.table=this.element.find("#table_display table"),this.table.on("click",function(t){return e.onCellClick($(t.target))}),this.element.find("#table_alignment").on("change",function(){return e.setTableAlignment()}),this.element.find("#table_border").on("keyup",function(){return e.setTableBorder()}),this.element.find("#table_spacing").on("keyup",function(){return e.setTableCellSpacing()}),this.element.find("[data-action]").on("click",function(t){return t.preventDefault(),e.onActionClick(jQuery(t.target).data("action"))}),this.selectFirstCell(),this.element.find("form").on("submit",function(t){return t.preventDefault(),e.submitForm(),e.hide()})},selectFirstCell:function(){var e;return e=this.table.find("td, th").first(),e.addClass("selected"),Mercury.tableEditor(this.table,e,"&nbsp;")},onCellClick:function(e){return this.cell=e,this.table=this.cell.closest("table"),this.table.find(".selected").removeAttr("class"),this.cell.addClass("selected"),Mercury.tableEditor(this.table,this.cell,"&nbsp;")},onActionClick:function(e){return e?Mercury.tableEditor[e]():void 0},setTableAlignment:function(){return this.table.attr({align:this.element.find("#table_alignment").val()})},setTableBorder:function(){var e;return e=parseInt(this.element.find("#table_border").val(),10),isNaN(e)?this.table.removeAttr("border"):this.table.attr({border:e})},setTableCellSpacing:function(){var e;return e=parseInt(this.element.find("#table_spacing").val(),10),isNaN(e)?this.table.removeAttr("cellspacing"):this.table.attr({cellspacing:e})},submitForm:function(){var e,t;return this.table.find(".selected").removeAttr("class"),this.table.find("td, th").html("<br/>"),e=jQuery("<div>").html(this.table).html(),t=e.replace(/^\s+|\n/gm,"").replace(/(<\/.*?>|<table.*?>|<tbody>|<tr>)/g,"$1\n"),Mercury.trigger("action",{action:"insertTable",value:t})}}}.call(this),function(){Mercury.onload&&Mercury.onload(),jQuery(window).trigger("mercury:loaded")}.call(this);