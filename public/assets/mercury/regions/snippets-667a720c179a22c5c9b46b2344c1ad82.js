!function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.Mercury.Regions.Snippets=function(e){function i(e,t,r){this.element=e,this.window=t,this.options=null!=r?r:{},Mercury.log("building "+n,this.element,this.options),i.__super__.constructor.apply(this,arguments),this.makeSortable()}var n;return t(i,e),i.supported=document.getElementById,i.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",n="snippets",i.prototype.type=function(){return n},i.prototype.build=function(){var e,t,i,n;for(n=this.element.find("[data-snippet]"),t=0,i=n.length;i>t;t++)e=n[t],jQuery(e).attr("data-version",0);return"0px"===this.element.css("minHeight")?this.element.css({minHeight:20}):void 0},i.prototype.bindEvents=function(){var e=this;return i.__super__.bindEvents.apply(this,arguments),Mercury.on("unfocus:regions",function(){return e.previewing?void 0:Mercury.region===e?(e.element.removeClass("focus"),e.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:e})):void 0}),Mercury.on("focus:window",function(){return e.previewing?void 0:Mercury.region===e?(e.element.removeClass("focus"),e.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:e})):void 0}),this.element.on("mouseup",function(){return e.previewing?void 0:(e.focus(),Mercury.trigger("region:focused",{region:e}))}),this.element.on("dragover",function(t){return e.previewing?void 0:(t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("drop",function(t){return!e.previewing&&Mercury.snippet?(e.focus(),t.preventDefault(),Mercury.Snippet.displayOptionsFor(Mercury.snippet.name,{},Mercury.snippet.hasOptions)):void 0}),jQuery(this.document).on("keydown",function(t){if(!e.previewing&&Mercury.region===e)switch(t.keyCode){case 90:if(!t.metaKey)return;return t.preventDefault(),t.shiftKey?e.execCommand("redo"):e.execCommand("undo")}}),jQuery(this.document).on("keyup",function(){return e.previewing||Mercury.region!==e?void 0:Mercury.changes=!0})},i.prototype.focus=function(){return Mercury.region=this,this.makeSortable(),this.element.addClass("focus")},i.prototype.togglePreview=function(){return this.previewing?this.makeSortable():(this.element.sortable("destroy"),this.element.removeClass("focus")),i.__super__.togglePreview.apply(this,arguments)},i.prototype.execCommand=function(e,t){var n;return null==t&&(t={}),i.__super__.execCommand.apply(this,arguments),(n=Mercury.Regions.Snippets.actions[e])?n.call(this,t):void 0},i.prototype.makeSortable=function(){var e=this;return this.element.sortable("destroy").sortable({document:this.document,scroll:!1,containment:"parent",items:"[data-snippet]",opacity:.4,revert:100,tolerance:"pointer",beforeStop:function(){return Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0}),!0},stop:function(){return setTimeout(function(){return e.pushHistory()},100),!0}})},i.actions={undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},insertSnippet:function(e){var t,i,n=this;return i=e.value,(t=this.element.find("[data-snippet="+i.identity+"]")).length?t.replaceWith(i.getHTML(this.document,function(){return n.pushHistory()})):this.element.append(i.getHTML(this.document,function(){return n.pushHistory()}))},editSnippet:function(){var e;if(this.snippet)return e=Mercury.Snippet.find(this.snippet.data("snippet")),e.displayOptions()},removeSnippet:function(){return this.snippet&&this.snippet.remove(),Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0})}},i}(Mercury.Region)}.call(this);