(function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};this.Mercury.Regions.Snippets=function(t){function i(t,e,s){this.element=t,this.window=e,this.options=null!=s?s:{},Mercury.log("building "+n,this.element,this.options),i.__super__.constructor.apply(this,arguments),this.makeSortable()}var n;return e(i,t),i.supported=document.getElementById,i.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",n="snippets",i.prototype.type=function(){return n},i.prototype.build=function(){var t,e,i,n;for(n=this.element.find("[data-snippet]"),e=0,i=n.length;i>e;e++)t=n[e],jQuery(t).attr("data-version",0);return"0px"===this.element.css("minHeight")?this.element.css({minHeight:20}):void 0},i.prototype.bindEvents=function(){var t=this;return i.__super__.bindEvents.apply(this,arguments),Mercury.on("unfocus:regions",function(){return t.previewing?void 0:Mercury.region===t?(t.element.removeClass("focus"),t.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:t})):void 0}),Mercury.on("focus:window",function(){return t.previewing?void 0:Mercury.region===t?(t.element.removeClass("focus"),t.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:t})):void 0}),this.element.on("mouseup",function(){return t.previewing?void 0:(t.focus(),Mercury.trigger("region:focused",{region:t}))}),this.element.on("dragover",function(e){return t.previewing?void 0:(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("drop",function(e){return!t.previewing&&Mercury.snippet?(t.focus(),e.preventDefault(),Mercury.Snippet.displayOptionsFor(Mercury.snippet.name,{},Mercury.snippet.hasOptions)):void 0}),jQuery(this.document).on("keydown",function(e){if(!t.previewing&&Mercury.region===t)switch(e.keyCode){case 90:if(!e.metaKey)return;return e.preventDefault(),e.shiftKey?t.execCommand("redo"):t.execCommand("undo")}}),jQuery(this.document).on("keyup",function(){return t.previewing||Mercury.region!==t?void 0:Mercury.changes=!0})},i.prototype.focus=function(){return Mercury.region=this,this.makeSortable(),this.element.addClass("focus")},i.prototype.togglePreview=function(){return this.previewing?this.makeSortable():(this.element.sortable("destroy"),this.element.removeClass("focus")),i.__super__.togglePreview.apply(this,arguments)},i.prototype.execCommand=function(t,e){var n;return null==e&&(e={}),i.__super__.execCommand.apply(this,arguments),(n=Mercury.Regions.Snippets.actions[t])?n.call(this,e):void 0},i.prototype.makeSortable=function(){var t=this;return this.element.sortable("destroy").sortable({document:this.document,scroll:!1,containment:"parent",items:"[data-snippet]",opacity:.4,revert:100,tolerance:"pointer",beforeStop:function(){return Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0}),!0},stop:function(){return setTimeout(function(){return t.pushHistory()},100),!0}})},i.actions={undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},insertSnippet:function(t){var e,i,n=this;return i=t.value,(e=this.element.find("[data-snippet="+i.identity+"]")).length?e.replaceWith(i.getHTML(this.document,function(){return n.pushHistory()})):this.element.append(i.getHTML(this.document,function(){return n.pushHistory()}))},editSnippet:function(){var t;if(this.snippet)return t=Mercury.Snippet.find(this.snippet.data("snippet")),t.displayOptions()},removeSnippet:function(){return this.snippet&&this.snippet.remove(),Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0})}},i}(Mercury.Region)}).call(this);