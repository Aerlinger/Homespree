(function(){var t={}.hasOwnProperty;this.Mercury.Toolbar.Button=function(){function e(t,e,i,n,s){return this.name=t,this.title=e,this.summary=null!=i?i:null,this.types=null!=n?n:{},this.options=null!=s?s:{},this.title&&(this.title=Mercury.I18n(this.title)),this.summary&&(this.summary=Mercury.I18n(this.summary)),this.build(),this.bindEvents(),this.element}return e.prototype.build=function(){var e,i,n,s,r,o;this.element=jQuery("<div>",{title:null!=(s=this.summary)?s:this.title,"class":"mercury-button mercury-"+this.name+"-button"}).html("<em>"+this.title+"</em>"),this.element.data("expander",'<div class="mercury-expander-button" data-button="'+this.name+'"><em></em><span>'+this.title+"</span></div>"),this.handled={},r=this.types,o=[];for(n in r)if(t.call(r,n))switch(e=r[n],n){case"preload":o.push(!0);break;case"regions":this.element.addClass("disabled"),o.push(this.handled[n]=jQuery.isFunction(e)?e.call(this,this.name):e);break;case"toggle":o.push(this.handled[n]=!0);break;case"mode":o.push(this.handled[n]=e===!0?this.name:e);break;case"context":o.push(this.handled[n]=jQuery.isFunction(e)?e:Mercury.Toolbar.Button.contexts[this.name]);break;case"palette":this.element.addClass("mercury-button-palette"),i=jQuery.isFunction(e)?e.call(this,this.name):e,o.push(this.handled[n]="string"==typeof i?new Mercury.Palette(i,this.name,this.defaultDialogOptions()):i);break;case"select":this.element.addClass("mercury-button-select").find("em").html(this.title),i=jQuery.isFunction(e)?e.call(this,this.name):e,o.push(this.handled[n]="string"==typeof i?new Mercury.Select(i,this.name,this.defaultDialogOptions()):i);break;case"panel":this.element.addClass("mercury-button-panel"),this.handled.toggle=!0,i=jQuery.isFunction(e)?e.call(this,this.name):e,o.push(this.handled[n]="string"==typeof i?new Mercury.Panel(i,this.name,this.defaultDialogOptions()):i);break;case"modal":o.push(this.handled[n]=jQuery.isFunction(e)?e.call(this,this.name):e);break;case"lightview":o.push(this.handled[n]=jQuery.isFunction(e)?e.call(this,this.name):e);break;default:throw Mercury.I18n('Unknown button type "%s" used for the "%s" button.',n,this.name)}return o},e.prototype.bindEvents=function(){var t=this;return Mercury.on("button",function(e,i){return i.action===t.name?t.element.click():void 0}),Mercury.on("mode",function(e,i){return t.handled.mode===i.mode&&t.handled.toggle?t.togglePressed():void 0}),Mercury.on("region:update",function(e,i){var n;return t.handled.context&&i.region&&"function"===jQuery.type(i.region.currentElement)?(n=i.region.currentElement(),n.length&&t.handled.context.call(t,n,i.region.element)?t.element.addClass("active"):t.element.removeClass("active")):t.element.removeClass("active")}),Mercury.on("region:focused",function(e,i){return t.handled.regions&&i.region&&i.region.type()?t.handled.regions.indexOf(i.region.type())>-1?t.element.removeClass("disabled"):t.element.addClass("disabled"):void 0}),Mercury.on("region:blurred",function(){return t.handled.regions?t.element.addClass("disabled"):void 0}),this.element.on("mousedown",function(){return t.element.addClass("active")}),this.element.on("mouseup",function(){return t.element.removeClass("active")}),this.element.on("click",function(e){return t.element.closest(".disabled").length?void 0:t.handleClick(e)})},e.prototype.handleClick=function(e){var i,n,s,r;i=!1,r=this.handled;for(s in r)if(t.call(r,s))switch(n=r[s],s){case"toggle":this.handled.mode||this.togglePressed();break;case"mode":i=!0,Mercury.trigger("mode",{mode:n});break;case"modal":i=this.handleModal(e);break;case"lightview":i=this.handleLightview(e);break;case"palette":case"select":case"panel":i=this.handleDialog(e,s)}return i||Mercury.trigger("action",{action:this.name}),this.options.regions&&this.options.regions.length?Mercury.trigger("focus:frame"):void 0},e.prototype.handleModal=function(){return Mercury.modal(this.handled.modal,{title:this.summary||this.title,handler:this.name}),!0},e.prototype.handleLightview=function(){return Mercury.lightview(this.handled.lightview,{title:this.summary||this.title,handler:this.name,closeButton:!0}),!0},e.prototype.handleDialog=function(t,e){return t.stopPropagation(),this.handled[e].toggle(),!0},e.prototype.defaultDialogOptions=function(){return{title:this.summary||this.title,preload:this.types.preload,appendTo:this.options.appendDialogsTo||"body",closeButton:!0,"for":this.element}},e.prototype.togglePressed=function(){return this.element.toggleClass("pressed")},e}(),this.Mercury.Toolbar.Button.contexts={backColor:function(t){return this.element.css("background-color",t.css("background-color"))},foreColor:function(t){return this.element.css("background-color",t.css("color"))},bold:function(t){var e;return e=t.css("font-weight"),"bold"===e||e>400},italic:function(t){return"italic"===t.css("font-style")},overline:function(t){var e,i,n,s;if("overline"===t.css("text-decoration"))return!0;for(s=t.parentsUntil(this.element),i=0,n=s.length;n>i;i++)if(e=s[i],"overline"===jQuery(e).css("text-decoration"))return!0;return!1},strikethrough:function(t,e){return"line-through"===t.css("text-decoration")||!!t.closest("strike",e).length},underline:function(t,e){return"underline"===t.css("text-decoration")||!!t.closest("u",e).length},subscript:function(t,e){return!!t.closest("sub",e).length},superscript:function(t,e){return!!t.closest("sup",e).length},justifyLeft:function(t){return t.css("text-align").indexOf("left")>-1},justifyCenter:function(t){return t.css("text-align").indexOf("center")>-1},justifyRight:function(t){return t.css("text-align").indexOf("right")>-1},justifyFull:function(t){return t.css("text-align").indexOf("justify")>-1},insertOrderedList:function(t,e){return!!t.closest("ol",e.element).length},insertUnorderedList:function(t,e){return!!t.closest("ul",e.element).length}}}).call(this);