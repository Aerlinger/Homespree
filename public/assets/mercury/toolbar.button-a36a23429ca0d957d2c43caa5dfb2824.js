!function(){var e={}.hasOwnProperty;this.Mercury.Toolbar.Button=function(){function t(e,t,i,n,r){return this.name=e,this.title=t,this.summary=null!=i?i:null,this.types=null!=n?n:{},this.options=null!=r?r:{},this.title&&(this.title=Mercury.I18n(this.title)),this.summary&&(this.summary=Mercury.I18n(this.summary)),this.build(),this.bindEvents(),this.element}return t.prototype.build=function(){var t,i,n,r,o,s;this.element=jQuery("<div>",{title:null!=(r=this.summary)?r:this.title,"class":"mercury-button mercury-"+this.name+"-button"}).html("<em>"+this.title+"</em>"),this.element.data("expander",'<div class="mercury-expander-button" data-button="'+this.name+'"><em></em><span>'+this.title+"</span></div>"),this.handled={},o=this.types,s=[];for(n in o)if(e.call(o,n))switch(t=o[n],n){case"preload":s.push(!0);break;case"regions":this.element.addClass("disabled"),s.push(this.handled[n]=jQuery.isFunction(t)?t.call(this,this.name):t);break;case"toggle":s.push(this.handled[n]=!0);break;case"mode":s.push(this.handled[n]=t===!0?this.name:t);break;case"context":s.push(this.handled[n]=jQuery.isFunction(t)?t:Mercury.Toolbar.Button.contexts[this.name]);break;case"palette":this.element.addClass("mercury-button-palette"),i=jQuery.isFunction(t)?t.call(this,this.name):t,s.push(this.handled[n]="string"==typeof i?new Mercury.Palette(i,this.name,this.defaultDialogOptions()):i);break;case"select":this.element.addClass("mercury-button-select").find("em").html(this.title),i=jQuery.isFunction(t)?t.call(this,this.name):t,s.push(this.handled[n]="string"==typeof i?new Mercury.Select(i,this.name,this.defaultDialogOptions()):i);break;case"panel":this.element.addClass("mercury-button-panel"),this.handled.toggle=!0,i=jQuery.isFunction(t)?t.call(this,this.name):t,s.push(this.handled[n]="string"==typeof i?new Mercury.Panel(i,this.name,this.defaultDialogOptions()):i);break;case"modal":s.push(this.handled[n]=jQuery.isFunction(t)?t.call(this,this.name):t);break;case"lightview":s.push(this.handled[n]=jQuery.isFunction(t)?t.call(this,this.name):t);break;default:throw Mercury.I18n('Unknown button type "%s" used for the "%s" button.',n,this.name)}return s},t.prototype.bindEvents=function(){var e=this;return Mercury.on("button",function(t,i){return i.action===e.name?e.element.click():void 0}),Mercury.on("mode",function(t,i){return e.handled.mode===i.mode&&e.handled.toggle?e.togglePressed():void 0}),Mercury.on("region:update",function(t,i){var n;return e.handled.context&&i.region&&"function"===jQuery.type(i.region.currentElement)?(n=i.region.currentElement(),n.length&&e.handled.context.call(e,n,i.region.element)?e.element.addClass("active"):e.element.removeClass("active")):e.element.removeClass("active")}),Mercury.on("region:focused",function(t,i){return e.handled.regions&&i.region&&i.region.type()?e.handled.regions.indexOf(i.region.type())>-1?e.element.removeClass("disabled"):e.element.addClass("disabled"):void 0}),Mercury.on("region:blurred",function(){return e.handled.regions?e.element.addClass("disabled"):void 0}),this.element.on("mousedown",function(){return e.element.addClass("active")}),this.element.on("mouseup",function(){return e.element.removeClass("active")}),this.element.on("click",function(t){return e.element.closest(".disabled").length?void 0:e.handleClick(t)})},t.prototype.handleClick=function(t){var i,n,r,o;i=!1,o=this.handled;for(r in o)if(e.call(o,r))switch(n=o[r],r){case"toggle":this.handled.mode||this.togglePressed();break;case"mode":i=!0,Mercury.trigger("mode",{mode:n});break;case"modal":i=this.handleModal(t);break;case"lightview":i=this.handleLightview(t);break;case"palette":case"select":case"panel":i=this.handleDialog(t,r)}return i||Mercury.trigger("action",{action:this.name}),this.options.regions&&this.options.regions.length?Mercury.trigger("focus:frame"):void 0},t.prototype.handleModal=function(){return Mercury.modal(this.handled.modal,{title:this.summary||this.title,handler:this.name}),!0},t.prototype.handleLightview=function(){return Mercury.lightview(this.handled.lightview,{title:this.summary||this.title,handler:this.name,closeButton:!0}),!0},t.prototype.handleDialog=function(e,t){return e.stopPropagation(),this.handled[t].toggle(),!0},t.prototype.defaultDialogOptions=function(){return{title:this.summary||this.title,preload:this.types.preload,appendTo:this.options.appendDialogsTo||"body",closeButton:!0,"for":this.element}},t.prototype.togglePressed=function(){return this.element.toggleClass("pressed")},t}(),this.Mercury.Toolbar.Button.contexts={backColor:function(e){return this.element.css("background-color",e.css("background-color"))},foreColor:function(e){return this.element.css("background-color",e.css("color"))},bold:function(e){var t;return t=e.css("font-weight"),"bold"===t||t>400},italic:function(e){return"italic"===e.css("font-style")},overline:function(e){var t,i,n,r;if("overline"===e.css("text-decoration"))return!0;for(r=e.parentsUntil(this.element),i=0,n=r.length;n>i;i++)if(t=r[i],"overline"===jQuery(t).css("text-decoration"))return!0;return!1},strikethrough:function(e,t){return"line-through"===e.css("text-decoration")||!!e.closest("strike",t).length},underline:function(e,t){return"underline"===e.css("text-decoration")||!!e.closest("u",t).length},subscript:function(e,t){return!!e.closest("sub",t).length},superscript:function(e,t){return!!e.closest("sup",t).length},justifyLeft:function(e){return e.css("text-align").indexOf("left")>-1},justifyCenter:function(e){return e.css("text-align").indexOf("center")>-1},justifyRight:function(e){return e.css("text-align").indexOf("right")>-1},justifyFull:function(e){return e.css("text-align").indexOf("justify")>-1},insertOrderedList:function(e,t){return!!e.closest("ol",t.element).length},insertUnorderedList:function(e,t){return!!e.closest("ul",t.element).length}}}.call(this);