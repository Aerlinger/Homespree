(function(){var e={}.hasOwnProperty;this.Mercury.Toolbar.Button=function(){function t(e,t,n,r,i){return this.name=e,this.title=t,this.summary=n!=null?n:null,this.types=r!=null?r:{},this.options=i!=null?i:{},this.title&&(this.title=Mercury.I18n(this.title)),this.summary&&(this.summary=Mercury.I18n(this.summary)),this.build(),this.bindEvents(),this.element}return t.prototype.build=function(){var t,n,r,i,s,o;this.element=jQuery("<div>",{title:(i=this.summary)!=null?i:this.title,"class":"mercury-button mercury-"+this.name+"-button"}).html("<em>"+this.title+"</em>"),this.element.data("expander",'<div class="mercury-expander-button" data-button="'+this.name+'"><em></em><span>'+this.title+"</span></div>"),this.handled={},s=this.types,o=[];for(r in s){if(!e.call(s,r))continue;t=s[r];switch(r){case"preload":o.push(!0);break;case"regions":this.element.addClass("disabled"),o.push(this.handled[r]=jQuery.isFunction(t)?t.call(this,this.name):t);break;case"toggle":o.push(this.handled[r]=!0);break;case"mode":o.push(this.handled[r]=t===!0?this.name:t);break;case"context":o.push(this.handled[r]=jQuery.isFunction(t)?t:Mercury.Toolbar.Button.contexts[this.name]);break;case"palette":this.element.addClass("mercury-button-palette"),n=jQuery.isFunction(t)?t.call(this,this.name):t,o.push(this.handled[r]=typeof n=="string"?new Mercury.Palette(n,this.name,this.defaultDialogOptions()):n);break;case"select":this.element.addClass("mercury-button-select").find("em").html(this.title),n=jQuery.isFunction(t)?t.call(this,this.name):t,o.push(this.handled[r]=typeof n=="string"?new Mercury.Select(n,this.name,this.defaultDialogOptions()):n);break;case"panel":this.element.addClass("mercury-button-panel"),this.handled.toggle=!0,n=jQuery.isFunction(t)?t.call(this,this.name):t,o.push(this.handled[r]=typeof n=="string"?new Mercury.Panel(n,this.name,this.defaultDialogOptions()):n);break;case"modal":o.push(this.handled[r]=jQuery.isFunction(t)?t.call(this,this.name):t);break;case"lightview":o.push(this.handled[r]=jQuery.isFunction(t)?t.call(this,this.name):t);break;default:throw Mercury.I18n('Unknown button type "%s" used for the "%s" button.',r,this.name)}}return o},t.prototype.bindEvents=function(){var e=this;return Mercury.on("button",function(t,n){if(n.action===e.name)return e.element.click()}),Mercury.on("mode",function(t,n){if(e.handled.mode===n.mode&&e.handled.toggle)return e.togglePressed()}),Mercury.on("region:update",function(t,n){var r;return e.handled.context&&n.region&&jQuery.type(n.region.currentElement)==="function"?(r=n.region.currentElement(),r.length&&e.handled.context.call(e,r,n.region.element)?e.element.addClass("active"):e.element.removeClass("active")):e.element.removeClass("active")}),Mercury.on("region:focused",function(t,n){if(e.handled.regions&&n.region&&n.region.type())return e.handled.regions.indexOf(n.region.type())>-1?e.element.removeClass("disabled"):e.element.addClass("disabled")}),Mercury.on("region:blurred",function(){if(e.handled.regions)return e.element.addClass("disabled")}),this.element.on("mousedown",function(){return e.element.addClass("active")}),this.element.on("mouseup",function(){return e.element.removeClass("active")}),this.element.on("click",function(t){if(e.element.closest(".disabled").length)return;return e.handleClick(t)})},t.prototype.handleClick=function(t){var n,r,i,s;n=!1,s=this.handled;for(i in s){if(!e.call(s,i))continue;r=s[i];switch(i){case"toggle":this.handled.mode||this.togglePressed();break;case"mode":n=!0,Mercury.trigger("mode",{mode:r});break;case"modal":n=this.handleModal(t);break;case"lightview":n=this.handleLightview(t);break;case"palette":case"select":case"panel":n=this.handleDialog(t,i)}}n||Mercury.trigger("action",{action:this.name});if(this.options.regions&&this.options.regions.length)return Mercury.trigger("focus:frame")},t.prototype.handleModal=function(e){return Mercury.modal(this.handled.modal,{title:this.summary||this.title,handler:this.name}),!0},t.prototype.handleLightview=function(e){return Mercury.lightview(this.handled.lightview,{title:this.summary||this.title,handler:this.name,closeButton:!0}),!0},t.prototype.handleDialog=function(e,t){return e.stopPropagation(),this.handled[t].toggle(),!0},t.prototype.defaultDialogOptions=function(){return{title:this.summary||this.title,preload:this.types.preload,appendTo:this.options.appendDialogsTo||"body",closeButton:!0,"for":this.element}},t.prototype.togglePressed=function(){return this.element.toggleClass("pressed")},t}(),this.Mercury.Toolbar.Button.contexts={backColor:function(e){return this.element.css("background-color",e.css("background-color"))},foreColor:function(e){return this.element.css("background-color",e.css("color"))},bold:function(e){var t;return t=e.css("font-weight"),t==="bold"||t>400},italic:function(e){return e.css("font-style")==="italic"},overline:function(e){var t,n,r,i;if(e.css("text-decoration")==="overline")return!0;i=e.parentsUntil(this.element);for(n=0,r=i.length;n<r;n++){t=i[n];if(jQuery(t).css("text-decoration")==="overline")return!0}return!1},strikethrough:function(e,t){return e.css("text-decoration")==="line-through"||!!e.closest("strike",t).length},underline:function(e,t){return e.css("text-decoration")==="underline"||!!e.closest("u",t).length},subscript:function(e,t){return!!e.closest("sub",t).length},superscript:function(e,t){return!!e.closest("sup",t).length},justifyLeft:function(e){return e.css("text-align").indexOf("left")>-1},justifyCenter:function(e){return e.css("text-align").indexOf("center")>-1},justifyRight:function(e){return e.css("text-align").indexOf("right")>-1},justifyFull:function(e){return e.css("text-align").indexOf("justify")>-1},insertOrderedList:function(e,t){return!!e.closest("ol",t.element).length},insertUnorderedList:function(e,t){return!!e.closest("ul",t.element).length}}}).call(this);