!function(){this.Mercury.modalHandlers.insertMedia={initialize:function(){var e=this;return this.element.find(".control-label input").on("click",this.onLabelChecked),this.element.find(".controls .optional, .controls .required").on("focus",function(t){return e.onInputFocused($(t.target))}),this.focus("#media_image_url"),this.initializeForm(),this.element.find("form").on("submit",function(t){return t.preventDefault(),e.validateForm(),e.valid?(e.submitForm(),e.hide()):(e.resize(),void 0)})},initializeForm:function(){var e,t,i,n;if(Mercury.region&&Mercury.region.selection&&(i=Mercury.region.selection(),(t="function"==typeof i.is?i.is("img"):void 0)&&(this.element.find("#media_image_url").val(t.attr("src")),this.element.find("#media_image_alignment").val(t.attr("align")),this.element.find("#media_image_float").val(null!=t.attr("style")?t.css("float"):""),this.focus("#media_image_url")),e="function"==typeof i.is?i.is("iframe"):void 0)){if(n=e.attr("src"),/^https?:\/\/www.youtube.com\//i.test(n))return this.element.find("#media_youtube_url").val(""+n.match(/^https?/)[0]+"://youtu.be/"+n.match(/\/embed\/(\w+)/)[1]),this.element.find("#media_youtube_width").val(e.width()),this.element.find("#media_youtube_height").val(e.height()),this.focus("#media_youtube_url");if(/^https?:\/\/player.vimeo.com\//i.test(n))return this.element.find("#media_vimeo_url").val(""+n.match(/^https?/)[0]+"://vimeo.com/"+n.match(/\/video\/(\w+)/)[1]),this.element.find("#media_vimeo_width").val(e.width()),this.element.find("#media_vimeo_height").val(e.height()),this.focus("#media_vimeo_url")}},focus:function(e){var t=this;return setTimeout(function(){return t.element.find(e).focus()},300)},onLabelChecked:function(){var e;return e=jQuery(this).closest(".control-label").attr("for"),jQuery(this).closest(".control-group").find("#"+e).focus()},onInputFocused:function(e){return e.closest(".control-group").find("input[type=radio]").prop("checked",!0),e.closest(".media-options").length?void 0:(this.element.find(".media-options").hide(),this.element.find("#"+e.attr("id").replace("media_","")+"_options").show(),this.resize(!0))},addInputError:function(e,t){return e.after('<span class="help-inline error-message">'+Mercury.I18n(t)+"</span>").closest(".control-group").addClass("error"),this.valid=!1},clearInputErrors:function(){return this.element.find(".control-group.error").removeClass("error").find(".error-message").remove(),this.valid=!0},validateForm:function(){var e,t,i;switch(this.clearInputErrors(),t=this.element.find("input[name=media_type]:checked").val(),e=this.element.find("#media_"+t),t){case"youtube_url":if(i=this.element.find("#media_youtube_url").val(),!/^https?:\/\/youtu.be\//.test(i))return this.addInputError(e,"is invalid");break;case"vimeo_url":if(i=this.element.find("#media_vimeo_url").val(),!/^https?:\/\/vimeo.com\//.test(i))return this.addInputError(e,"is invalid");break;default:if(!e.val())return this.addInputError(e,"can't be blank")}},submitForm:function(){var e,t,i,n,r,o,s,a;switch(o=this.element.find("input[name=media_type]:checked").val()){case"image_url":return t={src:this.element.find("#media_image_url").val()},(e=this.element.find("#media_image_alignment").val())&&(t.align=e),(n=this.element.find("#media_image_float").val())&&(t.style="float: "+n+";"),Mercury.trigger("action",{action:"insertImage",value:t});case"youtube_url":return s=this.element.find("#media_youtube_url").val(),i=s.replace(/https?:\/\/youtu.be\//,""),r="http",/^https:/.test(s)&&(r="https"),a=jQuery("<iframe>",{width:parseInt(this.element.find("#media_youtube_width").val(),10)||560,height:parseInt(this.element.find("#media_youtube_height").val(),10)||349,src:""+r+"://www.youtube.com/embed/"+i+"?wmode=transparent",frameborder:0,allowfullscreen:"true"}),Mercury.trigger("action",{action:"insertHTML",value:a});case"vimeo_url":return s=this.element.find("#media_vimeo_url").val(),i=s.replace(/^https?:\/\/vimeo.com\//,""),r="http",/^https:/.test(s)&&(r="https"),a=jQuery("<iframe>",{width:parseInt(this.element.find("#media_vimeo_width").val(),10)||400,height:parseInt(this.element.find("#media_vimeo_height").val(),10)||225,src:""+r+"://player.vimeo.com/video/"+i+"?title=1&byline=1&portrait=0&color=ffffff",frameborder:0}),Mercury.trigger("action",{action:"insertHTML",value:a})}}}}.call(this);