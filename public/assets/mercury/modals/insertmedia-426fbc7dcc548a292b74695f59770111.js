(function(){this.Mercury.modalHandlers.insertMedia={initialize:function(){var t=this;return this.element.find(".control-label input").on("click",this.onLabelChecked),this.element.find(".controls .optional, .controls .required").on("focus",function(e){return t.onInputFocused($(e.target))}),this.focus("#media_image_url"),this.initializeForm(),this.element.find("form").on("submit",function(e){return e.preventDefault(),t.validateForm(),t.valid?(t.submitForm(),t.hide()):(t.resize(),void 0)})},initializeForm:function(){var t,e,i,n;if(Mercury.region&&Mercury.region.selection&&(i=Mercury.region.selection(),(e="function"==typeof i.is?i.is("img"):void 0)&&(this.element.find("#media_image_url").val(e.attr("src")),this.element.find("#media_image_alignment").val(e.attr("align")),this.element.find("#media_image_float").val(null!=e.attr("style")?e.css("float"):""),this.focus("#media_image_url")),t="function"==typeof i.is?i.is("iframe"):void 0)){if(n=t.attr("src"),/^https?:\/\/www.youtube.com\//i.test(n))return this.element.find("#media_youtube_url").val(""+n.match(/^https?/)[0]+"://youtu.be/"+n.match(/\/embed\/(\w+)/)[1]),this.element.find("#media_youtube_width").val(t.width()),this.element.find("#media_youtube_height").val(t.height()),this.focus("#media_youtube_url");if(/^https?:\/\/player.vimeo.com\//i.test(n))return this.element.find("#media_vimeo_url").val(""+n.match(/^https?/)[0]+"://vimeo.com/"+n.match(/\/video\/(\w+)/)[1]),this.element.find("#media_vimeo_width").val(t.width()),this.element.find("#media_vimeo_height").val(t.height()),this.focus("#media_vimeo_url")}},focus:function(t){var e=this;return setTimeout(function(){return e.element.find(t).focus()},300)},onLabelChecked:function(){var t;return t=jQuery(this).closest(".control-label").attr("for"),jQuery(this).closest(".control-group").find("#"+t).focus()},onInputFocused:function(t){return t.closest(".control-group").find("input[type=radio]").prop("checked",!0),t.closest(".media-options").length?void 0:(this.element.find(".media-options").hide(),this.element.find("#"+t.attr("id").replace("media_","")+"_options").show(),this.resize(!0))},addInputError:function(t,e){return t.after('<span class="help-inline error-message">'+Mercury.I18n(e)+"</span>").closest(".control-group").addClass("error"),this.valid=!1},clearInputErrors:function(){return this.element.find(".control-group.error").removeClass("error").find(".error-message").remove(),this.valid=!0},validateForm:function(){var t,e,i;switch(this.clearInputErrors(),e=this.element.find("input[name=media_type]:checked").val(),t=this.element.find("#media_"+e),e){case"youtube_url":if(i=this.element.find("#media_youtube_url").val(),!/^https?:\/\/youtu.be\//.test(i))return this.addInputError(t,"is invalid");break;case"vimeo_url":if(i=this.element.find("#media_vimeo_url").val(),!/^https?:\/\/vimeo.com\//.test(i))return this.addInputError(t,"is invalid");break;default:if(!t.val())return this.addInputError(t,"can't be blank")}},submitForm:function(){var t,e,i,n,s,r,o,a;switch(r=this.element.find("input[name=media_type]:checked").val()){case"image_url":return e={src:this.element.find("#media_image_url").val()},(t=this.element.find("#media_image_alignment").val())&&(e.align=t),(n=this.element.find("#media_image_float").val())&&(e.style="float: "+n+";"),Mercury.trigger("action",{action:"insertImage",value:e});case"youtube_url":return o=this.element.find("#media_youtube_url").val(),i=o.replace(/https?:\/\/youtu.be\//,""),s="http",/^https:/.test(o)&&(s="https"),a=jQuery("<iframe>",{width:parseInt(this.element.find("#media_youtube_width").val(),10)||560,height:parseInt(this.element.find("#media_youtube_height").val(),10)||349,src:""+s+"://www.youtube.com/embed/"+i+"?wmode=transparent",frameborder:0,allowfullscreen:"true"}),Mercury.trigger("action",{action:"insertHTML",value:a});case"vimeo_url":return o=this.element.find("#media_vimeo_url").val(),i=o.replace(/^https?:\/\/vimeo.com\//,""),s="http",/^https:/.test(o)&&(s="https"),a=jQuery("<iframe>",{width:parseInt(this.element.find("#media_vimeo_width").val(),10)||400,height:parseInt(this.element.find("#media_vimeo_height").val(),10)||225,src:""+s+"://player.vimeo.com/video/"+i+"?title=1&byline=1&portrait=0&color=ffffff",frameborder:0}),Mercury.trigger("action",{action:"insertHTML",value:a})}}}}).call(this);