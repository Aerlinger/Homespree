(function(t){function e(t,e,i,n){if(!t.tag.isInline&&i.length>0){i.push("\n");for(var s=0;n>s;s++)i.push("	")}}function i(n,s){var o=[],r=0==n.attributes.length,u=0,p=null,f=n.tag.render&&(0==s.allowedTags.length||t.inArray(n.tag.name,s.allowedTags)>-1)&&(0==s.removeTags.length||-1==t.inArray(n.tag.name,s.removeTags));if(!n.isRoot&&f&&(o.push("<"),o.push(n.tag.name),t.each(n.attributes,function(){if(-1==t.inArray(this.name,s.removeAttrs)){var e=new RegExp(/^(['"]?)(.*?)['"]?$/).exec(this.value),i=e[2],r=e[1]||"'";"class"==this.name&&(i=t.grep(i.split(" "),function(e){return t.grep(s.allowedClasses,function(i){return i[0]==e&&(1==i.length||t.inArray(n.tag.name,i[1])>-1)}).length>0}).join(" "),r="'"),null!=i&&(i.length>0||t.inArray(this.name,n.tag.requiredAttributes)>-1)&&(o.push(" "),o.push(this.name),o.push("="),o.push(r),o.push(i),o.push(r))}})),n.tag.isSelfClosing)f&&o.push(" />"),r=!1;else if(n.tag.isNonClosing)r=!1;else{if(!n.isRoot&&f&&o.push(">"),u=s.formatIndent++,n.tag.toProtect)p=t.htmlClean.trim(n.children.join("")).replace(/<br>/gi,"\n"),o.push(p),r=0==p.length,s.formatIndent--;else{p=[];for(var m=0;n.children.length>m;m++){var g=n.children[m],v=t.htmlClean.trim(d(c(g)?g:g.childrenToString()));h(g)&&m>0&&v.length>0&&(a(g)||l(n.children[m-1]))&&p.push(" "),c(g)?v.length>0&&p.push(v):(m!=n.children.length-1||"br"!=g.tag.name)&&(s.format&&e(g,s,p,u),p=p.concat(i(g,s)))}s.formatIndent--,p.length>0&&(s.format&&"\n"!=p[0]&&e(n,s,o,u),o=o.concat(p),r=!1)}!n.isRoot&&f&&(s.format&&e(n,s,o,u-1),o.push("</"),o.push(n.tag.name),o.push(">"))}return!n.tag.allowEmpty&&r?[]:o}function n(e,i,s){return s=s||1,t.inArray(e[e.length-s].tag.name,i)>-1?!0:e.length-(s+1)>0&&n(e,i,s+1)?(e.pop(),!0):!1}function s(t){return t?(this.tag=t,this.isRoot=!1):(this.tag=new r("root"),this.isRoot=!0),this.attributes=[],this.children=[],this.hasAttribute=function(t){for(var e=0;this.attributes.length>e;e++)if(this.attributes[e].name==t)return!0;return!1},this.childrenToString=function(){return this.children.join("")},this}function o(t,e){return this.name=t,this.value=e,this}function r(e,i,n,s){return this.name=e.toLowerCase(),this.isSelfClosing=t.inArray(this.name,y)>-1,this.isNonClosing=t.inArray(this.name,b)>-1,this.isClosing=void 0!=i&&i.length>0,this.isInline=t.inArray(this.name,p)>-1,this.disallowNest=t.inArray(this.name,f)>-1,this.requiredParent=g[t.inArray(this.name,g)+1],this.allowEmpty=t.inArray(this.name,m)>-1,this.toProtect=t.inArray(this.name,v)>-1,this.rawAttributes=n,this.allowedAttributes=_[t.inArray(this.name,_)+1],this.requiredAttributes=w[t.inArray(this.name,w)+1],this.render=s&&-1==t.inArray(this.name,s.notRenderedTags),this}function a(e){for(;u(e)&&e.children.length>0;)e=e.children[0];return c(e)&&e.length>0&&t.htmlClean.isWhitespace(e.charAt(0))}function l(e){for(;u(e)&&e.children.length>0;)e=e.children[e.children.length-1];return c(e)&&e.length>0&&t.htmlClean.isWhitespace(e.charAt(e.length-1))}function c(t){return t.constructor==String}function h(t){return c(t)||t.tag.isInline}function u(t){return t.constructor==s}function d(t){return t.replace(/&nbsp;|\n/g," ").replace(/\s\s+/g," ")}t.fn.htmlClean=function(e){return this.each(function(){this.value?this.value=t.htmlClean(this.value,e):this.innerHTML=t.htmlClean(this.innerHTML,e)})},t.htmlClean=function(e,a){a=t.extend({},t.htmlClean.defaults,a);var l,h=/<(\/)?(\w+:)?([\w]+)([^>]*)>/gi,u=/(\w+)=(".*?"|'.*?'|[^\s>]*)/gi,d=new s,p=[d],f=d;a.bodyOnly&&(l=/<body[^>]*>((\n|.)*)<\/body>/i.exec(e))&&(e=l[1]),e=e.concat("<xxx>");for(var m;l=h.exec(e);){var g=new r(l[3],l[1],l[4],a),v=e.substring(m,l.index);if(v.length>0){var y=f.children[f.children.length-1];f.children.length>0&&c(y=f.children[f.children.length-1])?f.children[f.children.length-1]=y.concat(v):f.children.push(v)}if(m=h.lastIndex,g.isClosing)n(p,[g.name])&&(p.pop(),f=p[p.length-1]);else{for(var b,_=new s(g);b=u.exec(g.rawAttributes);){if("style"==b[1].toLowerCase()&&a.replaceStyles)for(var w=!g.isInline,x=0;a.replaceStyles.length>x;x++)a.replaceStyles[x][0].test(b[2])&&(w||(g.render=!1,w=!0),f.children.push(_),p.push(_),f=_,g=new r(a.replaceStyles[x][1],"","",a),_=new s(g));null!=g.allowedAttributes&&(0==g.allowedAttributes.length||t.inArray(b[1],g.allowedAttributes)>-1)&&_.attributes.push(new o(b[1],b[2]))}t.each(g.requiredAttributes,function(){var t=this.toString();_.hasAttribute(t)||_.attributes.push(new o(t,""))});for(var C=0;a.replace.length>C;C++)for(var k=0;a.replace[C][0].length>k;k++){var T="string"==typeof a.replace[C][0][k];if(T&&a.replace[C][0][k]==g.name||!T&&a.replace[C][0][k].test(l)){g.render=!1,f.children.push(_),p.push(_),f=_,g=new r(a.replace[C][1],l[1],l[4],a),_=new s(g),_.attributes=f.attributes,C=a.replace.length;break}}var D=!0;if(f.isRoot||(f.tag.isInline&&!g.isInline?D=!1:f.tag.disallowNest&&g.disallowNest&&!g.requiredParent?D=!1:g.requiredParent&&(D=n(p,g.requiredParent))&&(f=p[p.length-1])),D)if(f.children.push(_),g.toProtect)for(var S=null;S=h.exec(e);){var E=new r(S[3],S[1],S[4],a);if(E.isClosing&&E.name==g.name){_.children.push(RegExp.leftContext.substring(m)),m=h.lastIndex;break}}else g.isSelfClosing||g.isNonClosing||(p.push(_),f=_)}}return i(d,a).join("")},t.htmlClean.defaults={bodyOnly:!0,allowedTags:[],removeTags:["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"],removeAttrs:[],allowedClasses:[],notRenderedTags:[],format:!1,formatIndent:0,replace:[[["b","big"],"strong"],[["i"],"em"]],replaceStyles:[[/font-weight:\s*bold/i,"strong"],[/font-style:\s*italic/i,"em"],[/vertical-align:\s*super/i,"sup"],[/vertical-align:\s*sub/i,"sub"]]},t.htmlClean.trim=function(e){return t.htmlClean.trimStart(t.htmlClean.trimEnd(e))},t.htmlClean.trimStart=function(e){return e.substring(t.htmlClean.trimStartIndex(e))},t.htmlClean.trimStartIndex=function(e){for(var i=0;e.length-1>i&&t.htmlClean.isWhitespace(e.charAt(i));i++);return i},t.htmlClean.trimEnd=function(e){return e.substring(0,t.htmlClean.trimEndIndex(e))},t.htmlClean.trimEndIndex=function(e){for(var i=e.length-1;i>=0&&t.htmlClean.isWhitespace(e.charAt(i));i--);return i+1},t.htmlClean.isWhitespace=function(e){return-1!=t.inArray(e,x)};var p=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","samp","select","small","span","strong","sub","sup","tt","var"],f=["h1","h2","h3","h4","h5","h6","p","th","td"],m=["th","td"],g=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",["table"],"tfoot",["table"]],v=["script","style","pre","code"],y=["br","hr","img","link","meta"],b=["!doctype","?xml"],_=[["class"],"?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],"form",["accept","action","class","enctype","method","name"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme"],"map",["name"],"optgroup",["class","disabled","label"],"option",["class","disabled","label","selected","value"],"q",["class","cite"],"td",["colspan","rowspan"],"th",["colspan","rowspan"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"style",["type"],"table",["class","summary"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"]],w=[[],"img",["alt"]],x=["Â "," ","	","\n","\r","\f"]})(jQuery);